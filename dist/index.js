// @bun
var u={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]],PAUSE:!0,PAUSE_DELAY:0};import{dlopen as mt,FFIType as r,suffix as go}from"bun:ffi";var a=mt(`user32.${go}`,{SendInput:{args:[r.u32,r.ptr,r.i32],returns:r.u32},MapVirtualKeyW:{args:[r.u32,r.u32],returns:r.u32},GetCursorPos:{args:[r.ptr],returns:r.bool},GetKeyState:{args:[r.i32],returns:r.i16},GetAsyncKeyState:{args:[r.i32],returns:r.i16},SetWindowsHookExW:{args:[r.i32,r.ptr,r.ptr,r.u32],returns:r.ptr},UnhookWindowsHookEx:{args:[r.ptr],returns:r.bool},CallNextHookEx:{args:[r.ptr,r.i32,r.ptr,r.ptr],returns:r.ptr},GetDC:{args:[r.ptr],returns:r.ptr},ReleaseDC:{args:[r.ptr,r.ptr],returns:r.int},GetDesktopWindow:{args:[],returns:r.ptr},GetForegroundWindow:{args:[],returns:r.ptr},GetWindowTextW:{args:[r.ptr,r.ptr,r.int],returns:r.int},GetWindowRect:{args:[r.ptr,r.ptr],returns:r.bool},GetSystemMetrics:{args:[r.int],returns:r.int},SetLayeredWindowAttributes:{args:[r.ptr,r.uint32_t,r.int8_t,r.uint32_t],returns:r.bool},UpdateLayeredWindow:{args:[r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.uint32_t,r.ptr,r.uint32_t],returns:r.bool},GetWindowLongW:{args:[r.ptr,r.int],returns:r.int},CreateWindowExW:{args:[r.uint32_t,r.ptr,r.ptr,r.uint32_t,r.int,r.int,r.int,r.int,r.ptr,r.ptr,r.ptr,r.ptr],returns:r.ptr},ShowWindow:{args:[r.ptr,r.int],returns:r.bool},UpdateWindow:{args:[r.ptr],returns:r.bool},SetWindowPos:{args:[r.ptr,r.ptr,r.int,r.int,r.int,r.int,r.uint32_t],returns:r.bool},FindWindowA:{args:[r.ptr,r.ptr],returns:r.ptr},FillRect:{args:[r.ptr,r.ptr,r.ptr],returns:r.int},IsWindow:{args:[r.ptr],returns:r.bool},SetForegroundWindow:{args:[r.ptr],returns:r.bool},IsWindowVisible:{args:[r.ptr],returns:r.bool},GetWindowThreadProcessId:{args:[r.ptr,r.ptr],returns:r.u32},MoveWindow:{args:[r.ptr,r.int,r.int,r.int,r.int,r.bool],returns:r.bool},GetClientRect:{args:[r.ptr,r.ptr],returns:r.bool},PostMessageA:{args:[r.ptr,r.u32,r.ptr,r.ptr],returns:r.bool},GetClassNameA:{args:[r.ptr,r.ptr,r.int],returns:r.int},SendMessageA:{args:[r.ptr,r.u32,r.ptr,r.ptr],returns:r.ptr},IsIconic:{args:[r.ptr],returns:r.bool},IsZoomed:{args:[r.ptr],returns:r.bool}}),yt=mt("gdi32.dll",{GetPixel:{args:[r.ptr,r.int,r.int],returns:r.uint32_t},CreatePen:{args:[r.int,r.int,r.uint32_t],returns:r.ptr},SelectObject:{args:[r.ptr,r.ptr],returns:r.ptr},MoveToEx:{args:[r.ptr,r.int,r.int,r.ptr],returns:r.bool},LineTo:{args:[r.ptr,r.int,r.int],returns:r.bool},DeleteObject:{args:[r.ptr],returns:r.bool},CreateCompatibleDC:{args:[r.ptr],returns:r.ptr},CreateDIBSection:{args:[r.ptr,r.ptr,r.uint32_t,r.ptr,r.ptr,r.uint32_t],returns:r.ptr},DeleteDC:{args:[r.ptr],returns:r.bool},CreateSolidBrush:{args:[r.uint32_t],returns:r.ptr},CreateCompatibleBitmap:{args:[r.ptr,r.int,r.int],returns:r.ptr},BitBlt:{args:[r.ptr,r.int,r.int,r.int,r.int,r.ptr,r.int,r.int,r.uint32_t],returns:r.bool}});var F=process.arch==="x64"||process.arch==="arm64";class H extends Error{constructor(t){super(t);this.name="FailSafeException"}}var At=F?8:4;function bt(t=0,o=0,e=0,n=0,s=0,f=0n){let E=20+At,i=Buffer.alloc(E);if(i.writeInt32LE(t,0),i.writeInt32LE(o,4),i.writeUInt32LE(e>>>0,8),i.writeUInt32LE(n>>>0,12),i.writeUInt32LE(s>>>0,16),F)i.writeBigUInt64LE(BigInt(f),20);else i.writeUInt32LE(Number(f)>>>0,20);return i}function Ot(t=0,o=0,e=0,n=0,s=0n){let f=12+At,E=Buffer.alloc(f);if(E.writeUInt16LE(t&65535,0),E.writeUInt16LE(o&65535,2),E.writeUInt32LE(e>>>0,4),E.writeUInt32LE(n>>>0,8),F)E.writeBigUInt64LE(BigInt(s),12);else E.writeUInt32LE(Number(s)>>>0,12);return F?Buffer.concat([E,Buffer.alloc(32-E.length)]):E}function R(t,o){let e=F?40:36,n=Buffer.alloc(e);return n.writeUInt32LE(t>>>0,0),o.copy(n,8,0,Math.min(32,o.length)),n}import{ptr as Bo}from"bun:ffi";function O(){if(u.FAILSAFE){let t=A();for(let o of u.FAILSAFE_POINTS)if(t[0]===o[0]&&t[1]===o[1])throw new H("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function M(t){if(t&&u.PAUSE_DELAY>0)Bun.sleepSync(u.PAUSE_DELAY)}function St(t=0,o=0){let[e,n]=Fo(),s=Math.round(t*65535/(e-1)),f=Math.round(o*65535/(n-1)),E=Math.max(0,Math.min(65535,s)),i=Math.max(0,Math.min(65535,f));return[E,i]}function A(t,o){let e=new ArrayBuffer(8),n=new DataView(e);a.symbols.GetCursorPos(Bo(e));let s=n.getInt32(0,!0),f=n.getInt32(4,!0);return[t??s,o??f]}function Fo(){let t=a.symbols.GetSystemMetrics(0),o=a.symbols.GetSystemMetrics(1);return[t,o]}var U={a:{scan:30},b:{scan:48},c:{scan:46},d:{scan:32},e:{scan:18},f:{scan:33},g:{scan:34},h:{scan:35},i:{scan:23},j:{scan:36},k:{scan:37},l:{scan:38},m:{scan:50},n:{scan:49},o:{scan:24},p:{scan:25},q:{scan:16},r:{scan:19},s:{scan:31},t:{scan:20},u:{scan:22},v:{scan:47},w:{scan:17},x:{scan:45},y:{scan:21},z:{scan:44},"0":{scan:11},"1":{scan:2},"2":{scan:3},"3":{scan:4},"4":{scan:5},"5":{scan:6},"6":{scan:7},"7":{scan:8},"8":{scan:9},"9":{scan:10},f1:{scan:59},f2:{scan:60},f3:{scan:61},f4:{scan:62},f5:{scan:63},f6:{scan:64},f7:{scan:65},f8:{scan:66},f9:{scan:67},f10:{scan:68},f11:{scan:87},f12:{scan:88},f13:{scan:100},f14:{scan:101},f15:{scan:102},f16:{scan:103},f17:{scan:104},f18:{scan:105},f19:{scan:106},f20:{scan:107},f21:{scan:108},f22:{scan:109},f23:{scan:110},f24:{scan:118},"-":{scan:12},minus:{scan:12},"=":{scan:13},equal:{scan:13},equals:{scan:13},"[":{scan:26},bracketleft:{scan:26},"]":{scan:27},bracketright:{scan:27},"\\":{scan:43},backslash:{scan:43},";":{scan:39},semicolon:{scan:39},"'":{scan:40},quote:{scan:40},apostrophe:{scan:40},"`":{scan:41},grave:{scan:41},backtick:{scan:41},",":{scan:51},comma:{scan:51},".":{scan:52},period:{scan:52},dot:{scan:52},"/":{scan:53},slash:{scan:53},forwardslash:{scan:53},space:{scan:57},enter:{scan:28},return:{scan:28},tab:{scan:15},backspace:{scan:14},escape:{scan:1},esc:{scan:1},shift:{scan:42},shiftleft:{scan:42},shiftright:{scan:54},ctrl:{scan:29},control:{scan:29},ctrlleft:{scan:29},controlleft:{scan:29},ctrlright:{scan:29,extended:!0},controlright:{scan:29,extended:!0},rctrl:{scan:29,extended:!0},alt:{scan:56},altleft:{scan:56},altright:{scan:56,extended:!0},ralt:{scan:56,extended:!0},altgr:{scan:56,extended:!0},win:{scan:91,extended:!0},winleft:{scan:91,extended:!0},windows:{scan:91,extended:!0},winright:{scan:92,extended:!0},windowsright:{scan:92,extended:!0},apps:{scan:93,extended:!0},menu:{scan:93,extended:!0},contextmenu:{scan:93,extended:!0},capslock:{scan:58},numlock:{scan:69},scrolllock:{scan:70},up:{scan:72,extended:!0},down:{scan:80,extended:!0},left:{scan:75,extended:!0},right:{scan:77,extended:!0},home:{scan:71,extended:!0},end:{scan:79,extended:!0},pageup:{scan:73,extended:!0},pagedown:{scan:81,extended:!0},insert:{scan:82,extended:!0},delete:{scan:83,extended:!0},del:{scan:83,extended:!0},numpad0:{scan:82},numpad1:{scan:79},numpad2:{scan:80},numpad3:{scan:81},numpad4:{scan:75},numpad5:{scan:76},numpad6:{scan:77},numpad7:{scan:71},numpad8:{scan:72},numpad9:{scan:73},numpaddecimal:{scan:83},numpadperiod:{scan:83},numpaddivide:{scan:53,extended:!0},numpadmultiply:{scan:55},numpadsubtract:{scan:74},numpadadd:{scan:78},numpadenter:{scan:28,extended:!0},volumeup:{scan:48,extended:!0},volumedown:{scan:46,extended:!0},volumemute:{scan:32,extended:!0},mute:{scan:32,extended:!0},playpause:{scan:34,extended:!0},stop:{scan:36,extended:!0},nexttrack:{scan:25,extended:!0},previoustrack:{scan:16,extended:!0},medianext:{scan:25,extended:!0},mediaprevious:{scan:16,extended:!0},mediaplaypause:{scan:34,extended:!0},mediastop:{scan:36,extended:!0},browserhome:{scan:50,extended:!0},browserback:{scan:106,extended:!0},browserforward:{scan:105,extended:!0},browserrefresh:{scan:103,extended:!0},browserstop:{scan:104,extended:!0},browsersearch:{scan:101,extended:!0},browserfavorites:{scan:102,extended:!0},mail:{scan:108,extended:!0},calculator:{scan:33,extended:!0},mycomputer:{scan:107,extended:!0},computer:{scan:107,extended:!0},printscreen:{scan:55,extended:!0},prtsc:{scan:55,extended:!0},pause:{scan:69,extended:!0},break:{scan:70},intl1:{scan:115},intl2:{scan:112},intl3:{scan:125},intl4:{scan:121},intl5:{scan:123},intl6:{scan:92},lang1:{scan:114},lang2:{scan:113},power:{scan:94,extended:!0},sleep:{scan:95,extended:!0},wake:{scan:99,extended:!0},help:{scan:59,extended:!0},undo:{scan:8,extended:!0},redo:{scan:7,extended:!0},cut:{scan:45,extended:!0},copy:{scan:46,extended:!0},paste:{scan:47,extended:!0},find:{scan:33,extended:!0},select:{scan:41,extended:!0},clear:{scan:76},num0:{scan:82},num1:{scan:79},num2:{scan:80},num3:{scan:81},num4:{scan:75},num5:{scan:76},num6:{scan:77},num7:{scan:71},num8:{scan:72},num9:{scan:73}},j=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]);var w=1,Nt=32768,$=2,Q=4;var q=8,z=16;var Z=32,J=64;var h=128,tt=256,Pt=1,Ut=2,Kt=1,_t=2,ot=8;function Tt(t,o,e,n=0){let s=e|(o?Kt:0),f=Ot(0,t,s,n,0n),E=R(1,f);a.symbols.SendInput(1,E,40)}function N(t,o=u.PAUSE){let{scan:e,extended:n}=U[t];if(Tt(e,!!n,ot),o)M(o);return b}function S(t,o=u.PAUSE){let{scan:e,extended:n}=U[t],s=ot|_t;if(Tt(e,!!n,s),o)M(o);return b}function g(t,o=u.PAUSE){return N(t,o),S(t,o),b}function Dt(t,o=1,e=0,n=u.PAUSE){for(let s=0;s<o;s++)if(N(t,n),S(t,n),e>0)Bun.sleepSync(e);return b}function gt(t,o=0,e=u.PAUSE){for(let n of t){if(n>="A"&&n<="Z"){let s=n.toLowerCase();N("shift",e),g(s,e),S("shift",e)}else if(j.has(n)){let s=j.get(n);N("shift",e),g(s,e),S("shift",e)}else g(n,e);if(o>0)Bun.sleepSync(o)}return b}function K(t){let{scan:o}=U[t],e;if(o>1024){let s=o-1024;e=a.symbols.MapVirtualKeyW(s,1)}else e=a.symbols.MapVirtualKeyW(o,1);return(a.symbols.GetAsyncKeyState(e)&32768)!==0}function Bt(t){return t.some((o)=>K(o))}function Ft(t){return t.every((o)=>K(o))}function Vt(t,o=u.PAUSE){for(let e of t)N(e,o);for(let e=t.length-1;e>=0;e--)S(t[e],o);return b}function Gt(t,o,e=u.PAUSE){if(N(t,!1),Bun.sleepSync(o),S(t,!1),e)M(e);return b}function kt(t,o){return new Promise((e)=>{let s=0,f=setInterval(()=>{if(K(t)){clearInterval(f),e(!0);return}if(o){if(s+=8,s>=o)clearInterval(f),e(!1)}},8)})}function Lt(t,o){return new Promise((e)=>{let s=0,f=setInterval(()=>{if(!K(t)){clearInterval(f),e(!0);return}if(o){if(s+=8,s>=o)clearInterval(f),e(!1)}},8)})}function Rt(t,o=u.PAUSE){return g(t,o),b}function Yt(t){let{scan:o}=U[t],e;if(o>1024){let f=o-1024;e=a.symbols.MapVirtualKeyW(f,1)}else e=a.symbols.MapVirtualKeyW(o,1);let n=a.symbols.GetAsyncKeyState(e),s=a.symbols.GetKeyState(e);return{isPressed:(n&32768)!==0,isToggled:(s&1)!==0}}function Ct(t=u.PAUSE){let o=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],e="abcdefghijklmnopqrstuvwxyz".split("");o.push(...e);for(let n of o)if(K(n))S(n,t);return b}class V{listeners=new Map;isRunning=!1;startPromise=null;on(t,o){if(!this.listeners.has(t))this.listeners.set(t,new Set);this.listeners.get(t).add(o)}off(t,o){this.listeners.get(t)?.delete(o)}once(t,o){let e=(n)=>{try{o(n)}finally{this.off(t,e)}};this.on(t,e)}_emit(t,o){this.listeners.get(t)?.forEach((e)=>{try{e(o)}catch(n){console.error(`Listener error [${String(t)}]:`,n)}})}async start(t=8){if(this.isRunning)return console.warn("Listener already running"),this.startPromise??Promise.resolve();return this.isRunning=!0,this.startPromise=(async()=>{try{await this.run(t)}catch(o){console.error("Listener run error:",o)}finally{this.isRunning=!1,this.startPromise=null}})(),this.startPromise}async stop(){if(this.isRunning=!1,this.startPromise)await this.startPromise}}var vt={};for(let[t,o]of Object.entries(U))vt[o.scan&4095]=t;var Go=new Set([1,2,4,5,6]),ko={112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",13:"enter",16:"shift",17:"ctrl",18:"alt",9:"tab",20:"capslock",27:"escape",32:"space"};class rt extends V{async run(t=8){console.log("Keyboard listener started.");let o=Array(256).fill(!1),e=Array.from({length:256},(n,s)=>s);while(this.isRunning){for(let n of e){if(Go.has(n))continue;let s=a.symbols.GetAsyncKeyState(n),f=(s&32768)!==0,E=(s&1)!==0,i=ko[n];if(!i){let l=a.symbols.MapVirtualKeyW(n,0);i=vt[l]}if(!i)if(n>=48&&n<=57)i=String.fromCharCode(n);else if(n>=65&&n<=90)i=String.fromCharCode(n).toLowerCase();else continue;if(f!==o[n]){o[n]=f;let l={event:f?"down":"up",name:i,vk_code:n,isKeyDown:f};this._emit(f?"down":"up",l)}else if(!f&&E&&!o[n]){let l={event:"down",name:i,vk_code:n,isKeyDown:!0},p={event:"up",name:i,vk_code:n,isKeyDown:!1};this._emit("down",l),this._emit("up",p)}}await Bun.sleep(t)}console.log("Keyboard listener stopped.")}}class Wt{press=N;release=S;tap=g;repeatTap=Dt;write=gt;isPressed=K;hotkey=Vt;hold=Gt;isAnyPressed=Bt;areAllPressed=Ft;waitForPress=kt;waitForRelease=Lt;toggleKey=Rt;getKeyState=Yt;releaseAll=Ct;listener=new rt}var b=new Wt;var y="left",Y="right",G="middle",et="x1",nt="x2";var Lo=2048,Ro=4096,Yo=120,Co={[y]:{down:$,up:Q,data:0},[G]:{down:Z,up:J,data:0},[Y]:{down:q,up:z,data:0},[et]:{down:h,up:tt,data:Pt},[nt]:{down:h,up:tt,data:Ut}};function Xt(t,o){let e=Co[t];if(!e)throw Error(`Invalid button: ${t}`);return{event:e[o],mouseData:e.data}}function vo(t,o){if(t!==void 0){if(!Number.isFinite(t))throw Error(`Invalid x coordinate: ${t}`);if(t<0)throw Error(`x coordinate must be non-negative: ${t}`)}if(o!==void 0){if(!Number.isFinite(o))throw Error(`Invalid y coordinate: ${o}`);if(o<0)throw Error(`y coordinate must be non-negative: ${o}`)}}function _(t,o,e,n,s=0){let f=bt(t,o,e,n,s,0n),E=R(0,f);a.symbols.SendInput(1,E,40)}function C(t=y,o=u.PAUSE){try{let{event:e,mouseData:n}=Xt(t,"down");if(_(0,0,n,e,0),o)M(o);return m}catch(e){throw console.error("[Mouse Press Error]",e),e}}function v(t=y,o=u.PAUSE){try{let{event:e,mouseData:n}=Xt(t,"up");if(_(0,0,n,e,0),o)M(o);return m}catch(e){throw console.error("[Mouse Release Error]",e),e}}function st(t=y,o=1,e=0,n=u.PAUSE){if([y,G,Y].includes(t)){let s=0,f=0;if(t===y)s=$,f=Q;else if(t===G)s=Z,f=J;else s=q,f=z;for(let E=0;E<o;E++)if(O(),_(0,0,0,s,0),_(0,0,0,f,0),e>0)Bun.sleepSync(Math.round(e*1000))}if(n)M(n);return m}function P(t,o,e=!1,n=u.PAUSE){try{if(O(),vo(t,o),!e){let[s,f]=A(t,o),[E,i]=St(s,f);if(_(E,i,0,w|Nt,0),n)M(n)}else ft(t??0,o??0,!0,n);return m}catch(s){throw console.error("[Mouse MoveTo Error]",s),s}}function ft(t=0,o=0,e=!1,n=u.PAUSE){if(O(),!e){let[s,f]=A();P(s+t,f+o,!1,n)}else if(_(t,o,0,w,0),n)M(n);return m}function W(t){let o;if(t===y)o=1;else if(t===Y)o=2;else if(t===G)o=4;else if(t===et)o=5;else if(t===nt)o=6;else throw Error(`Invalid button: ${t}`);return(a.symbols.GetAsyncKeyState(o)&32768)!==0}function at(t,o,e=y,n=0.5,s=u.PAUSE){O();let[f,E]=A();if(C(e,s),n<=0)P(t,o,!1,s);else{let i=Math.max(10,Math.floor(n*100)),l=n/i;for(let p=1;p<=i;p++){let x=p/i,T=Math.round(f+(t-f)*x),D=Math.round(E+(o-E)*x);P(T,D,!1,!1),Bun.sleepSync(Math.round(l*1000))}}return v(e,s),m}function dt(t,o,e=y,n=0.5,s=u.PAUSE){let[f,E]=A();return at(f+t,E+o,e,n,s)}function Ht(t,o="vertical",e=u.PAUSE){O();let n=t*Yo;if(_(0,0,n,o==="vertical"?Lo:Ro,0),e)M(e);return m}var Wo={linear:(t)=>t,easeInQuad:(t)=>t*t,easeOutQuad:(t)=>t*(2-t),easeInOutQuad:(t)=>t<0.5?2*t*t:-1+(4-2*t)*t,easeInCubic:(t)=>t*t*t,easeOutCubic:(t)=>--t*t*t+1,easeInOutCubic:(t)=>t<0.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1};async function jt(t,o,e=0.5,n="easeOutQuad",s=u.PAUSE){O();let[f,E]=A(),i=Wo[n];if(e<=0)return P(t,o,!1,s),m;let l=Math.max(10,Math.floor(e*100)),p=e/l;for(let x=1;x<=l;x++){let T=x/l,D=i(T),To=Math.round(f+(t-f)*D),Do=Math.round(E+(o-E)*D);P(To,Do,!1,!1),Bun.sleepSync(Math.round(p*1000))}if(s)M(s);return m}function wt(t,o,e=u.PAUSE){if(O(),C(t,!1),Bun.sleepSync(Math.round(o*1000)),v(t,!1),e)M(e);return m}function $t(t,o,e=y,n=u.PAUSE){return O(),P(t,o,!1,n),st(e,1,0,n),m}function Et(t,o,e=0){let[n,s]=A(),f=Math.abs(n-t),E=Math.abs(s-o);return f<=e&&E<=e}function Qt(t,o,e,n=0){return new Promise((s)=>{let E=0,i=setInterval(()=>{if(Et(t,o,n)){clearInterval(i),s(!0);return}if(e!==void 0){if(E+=8,E>=e)clearInterval(i),s(!1)}},8)})}async function qt(t,o){return new Promise((e)=>{let s=0,f=setInterval(()=>{if(W(t)){clearInterval(f),e(!0);return}if(o!==void 0){if(s+=8,s>=o)clearInterval(f),e(!1)}},8)})}async function zt(t,o){return new Promise((e)=>{let s=0,f=setInterval(()=>{if(!W(t)){clearInterval(f),e(!0);return}if(o!==void 0){if(s+=8,s>=o)clearInterval(f),e(!1)}},8)})}import{ptr as Ho}from"bun:ffi";class it extends V{async run(t=8){console.log("Mouse listener started.");let o=new ArrayBuffer(8),e=new DataView(o),n={x:0,y:0},s={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){a.symbols.GetCursorPos(Ho(o));let f=e.getInt32(0,!0),E=e.getInt32(4,!0);if(f!==n.x||E!==n.y){let p={event:"move",x:f,y:E,lastX:n.x,lastY:n.y,deltaX:f-n.x,deltaY:E-n.y};this._emit("move",p),n.x=f,n.y=E}let i={left:a.symbols.GetAsyncKeyState(1),right:a.symbols.GetAsyncKeyState(2),middle:a.symbols.GetAsyncKeyState(4),x1:a.symbols.GetAsyncKeyState(5),x2:a.symbols.GetAsyncKeyState(6)},l=Object.fromEntries(Object.entries(i).map(([p,x])=>[p,(x&32768)!==0]));for(let p of Object.keys(s))if(l[p]!==s[p]){s[p]=l[p];let x={event:l[p]?"down":"up",button:p,x:n.x,y:n.y};this._emit(l[p]?"down":"up",x)}await Bun.sleep(t)}console.log("Mouse listener stopped.")}}class Zt{get position(){let t=A();return{x:t[0],y:t[1]}}press=C;release=v;click=st;moveTo=P;moveRel=ft;isPressed=W;dragTo=at;dragRel=dt;scroll=Ht;smoothMoveTo=jt;hold=wt;clickAt=$t;isAtPosition=Et;waitForPosition=Qt;waitForPress=qt;waitForRelease=zt;listener=new it}var m=new Zt;import{ptr as I}from"bun:ffi";var jo=6,wo=3,$o=9,Qo=0,qo=5,zo=16,Zo=-16;var ut=new TextDecoder("utf-16le");function c(t){return I(new Uint8Array(new BigInt64Array([BigInt(t)]).buffer))}var B=null,Jt=0;function Jo(){if(B&&Date.now()-Jt<1000)return B;if(B)a.symbols.ReleaseDC(null,B);return B=a.symbols.GetDC(null),Jt=Date.now(),B}function X(){return{width:a.symbols.GetSystemMetrics(0),height:a.symbols.GetSystemMetrics(1)}}function k(t,o){let e=Jo();if(!e)return null;let n=yt.symbols.GetPixel(e,t,o);return{r:n&255,g:n>>8&255,b:n>>16&255}}function ht(t,o){let e=k(t,o);if(!e)return null;let n=(s)=>s.toString(16).padStart(2,"0");return`#${n(e.r)}${n(e.g)}${n(e.b)}`.toUpperCase()}function L(t,o,e,n=0){let s=k(t,o);if(!s)return!1;return Math.abs(s.r-e.r)<=n&&Math.abs(s.g-e.g)<=n&&Math.abs(s.b-e.b)<=n}function to(t,o,e,n=0,s){return new Promise((f)=>{let E=0,i=setInterval(()=>{if(L(t,o,e,n)){clearInterval(i),f(!0);return}if(s&&(E+=50)>=s)clearInterval(i),f(!1)},50)})}function pt(){let t=a.symbols.GetForegroundWindow();if(!t)return null;let o=new Uint16Array(256),e=a.symbols.GetWindowTextW(t,I(o),256),n=e>0?ut.decode(o.subarray(0,e)):"",s=new Int32Array(4);if(!a.symbols.GetWindowRect(t,I(s)))return null;let f={left:s[0],top:s[1],right:s[2],bottom:s[3]},E=X(),i=f.left===0&&f.top===0&&f.right-f.left===E.width&&f.bottom-f.top===E.height&&(a.symbols.GetWindowLongW(t,-16)&12845056)===0;return{hwnd:Number(t),title:n,rect:f,isFullscreen:i}}function oo(t){let o=t!==void 0?c(t):a.symbols.GetForegroundWindow();if(!o)return"";let e=new Uint16Array(256),n=a.symbols.GetWindowTextW(o,I(e),256);return n>0?ut.decode(e.subarray(0,n)):""}function lt(t){let o=new Int32Array(4);if(!a.symbols.GetWindowRect(c(t),I(o)))return null;return{left:o[0],top:o[1],right:o[2],bottom:o[3]}}function ro(t){return a.symbols.IsWindowVisible(c(t))}function ct(t){return a.symbols.SetForegroundWindow(c(t))}function xt(t){let o=new TextEncoder().encode(t+"\x00"),e=a.symbols.FindWindowA(null,I(o));return e?Number(e):null}function eo(t,o){return new Promise((e)=>{let n=0,s=setInterval(()=>{let f=xt(t);if(f){clearInterval(s),e(f);return}if(o&&(n+=100)>=o)clearInterval(s),e(null)},100)})}function no(t){let o=(e)=>e.toString(16).padStart(2,"0");return`#${o(t.r)}${o(t.g)}${o(t.b)}`.toUpperCase()}function so(t){let o=t.replace("#","");return{r:parseInt(o.substring(0,2),16),g:parseInt(o.substring(2,4),16),b:parseInt(o.substring(4,6),16)}}function fo(t,o){return Math.sqrt(Math.pow(t.r-o.r,2)+Math.pow(t.g-o.g,2)+Math.pow(t.b-o.b,2))}function Mt(t){return new Promise((o)=>setTimeout(o,t))}function ao(t){return t.map((o)=>k(o.x,o.y))}function Eo(t){return t.every((o)=>L(o.x,o.y,o.target,o.tolerance??0))}function io(t,o){return new Promise((e)=>{let n=0,s=setInterval(()=>{for(let f=0;f<t.length;f++){let E=t[f];if(L(E.x,E.y,E.target,E.tolerance??0)){clearInterval(s),e(f);return}}if(o&&(n+=50)>=o)clearInterval(s),e(-1)},50)})}function uo(t){let o=new Uint32Array(1);return a.symbols.GetWindowThreadProcessId(c(t),I(o)),o[0]}var po=new TextDecoder("ascii");function lo(t){let o=new Uint8Array(256),e=a.symbols.GetClassNameA(c(t),I(o),256);return e>0?po.decode(o.subarray(0,e)):""}function co(t){return a.symbols.IsIconic(c(t))}function xo(t){return a.symbols.IsZoomed(c(t))}function Mo(t){return a.symbols.ShowWindow(c(t),jo)}function Io(t){return a.symbols.ShowWindow(c(t),wo)}function mo(t){return a.symbols.ShowWindow(c(t),$o)}function yo(t){return a.symbols.ShowWindow(c(t),qo)}function Ao(t){return a.symbols.ShowWindow(c(t),Qo)}function bo(t){return a.symbols.PostMessageA(c(t),zo,null,null)}function Oo(t,o,e,n,s,f=!0){return a.symbols.MoveWindow(c(t),o,e,n,s,f)}function It(t){let o=new Int32Array(4);if(!a.symbols.GetClientRect(c(t),I(o)))return null;return{left:o[0],top:o[1],right:o[2],bottom:o[3]}}function So(t){let o=lt(t);if(!o)return null;return{width:o.right-o.left,height:o.bottom-o.top}}function No(t){let o=It(t);if(!o)return null;return{width:o.right-o.left,height:o.bottom-o.top}}function d(t){return a.symbols.IsWindow(c(t))}function Po(t){if(!d(t))return null;let o=c(t),e=new Uint16Array(256),n=a.symbols.GetWindowTextW(o,I(e),256),s=n>0?ut.decode(e.subarray(0,n)):"",f=new Int32Array(4);if(!a.symbols.GetWindowRect(o,I(f)))return null;let E={left:f[0],top:f[1],right:f[2],bottom:f[3]},i=X(),l=E.left===0&&E.top===0&&E.right-E.left===i.width&&E.bottom-E.top===i.height&&(a.symbols.GetWindowLongW(o,Zo)&12845056)===0,p=new Uint32Array(1);a.symbols.GetWindowThreadProcessId(o,I(p));let x=new Uint8Array(256),T=a.symbols.GetClassNameA(o,I(x),256),D=T>0?po.decode(x.subarray(0,T)):"";return{hwnd:t,title:s,rect:E,isFullscreen:l,processId:p[0],isVisible:a.symbols.IsWindowVisible(o),isMinimized:a.symbols.IsIconic(o),isMaximized:a.symbols.IsZoomed(o),className:D}}function Uo(t,o){return new Promise((e)=>{let n=0,s=setInterval(()=>{if(!d(t)){clearInterval(s),e(!0);return}if(o&&(n+=100)>=o)clearInterval(s),e(!1)},100)})}async function Ko(t,o=1000){ct(t);let e=0;while(e<o){let n=pt();if(n&&n.hwnd===t)return!0;await Mt(50),e+=50}return!1}class _o{screen={getScreenSize:X,getPixel:k,getPixelHex:ht,checkPixel:L,waitForPixel:to,getMultiplePixels:ao,checkMultiplePixels:Eo,waitForAnyPixel:io};window={getActiveWindow:pt,getWindowTitle:oo,getWindowRect:lt,getClientRect:It,getWindowSize:So,getClientSize:No,isWindowVisible:ro,isWindowMinimized:co,isWindowMaximized:xo,isWindow:d,setForeground:ct,focusWindow:Ko,findWindow:xt,waitForWindow:eo,waitForWindowClose:Uo,getWindowProcessId:uo,getClassName:lo,getExtendedWindowInfo:Po,minimizeWindow:Mo,maximizeWindow:Io,restoreWindow:mo,showWindow:yo,hideWindow:Ao,closeWindow:bo,moveWindow:Oo};utils={rgbToHex:no,hexToRgb:so,colorDistance:fo,sleep:Mt}}var hr=new _o;export{hr as windows,m as mouse,b as keyboard,u as config};
