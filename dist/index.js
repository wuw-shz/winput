// @bun
var i={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]],PAUSE:!1,PAUSE_DELAY:10};import{dlopen as De,FFIType as f,suffix as Fe}from"bun:ffi";var c=De(`user32.${Fe}`,{SendInput:{args:[f.u32,f.ptr,f.i32],returns:f.u32},MapVirtualKeyW:{args:[f.u32,f.u32],returns:f.u32},GetCursorPos:{args:[f.ptr],returns:f.bool},GetSystemMetrics:{args:[f.i32],returns:f.i32},GetKeyState:{args:[f.i32],returns:f.i16},GetAsyncKeyState:{args:[f.i32],returns:f.i16},SetWindowsHookExW:{args:[f.i32,f.ptr,f.ptr,f.u32],returns:f.ptr},UnhookWindowsHookEx:{args:[f.ptr],returns:f.bool},CallNextHookEx:{args:[f.ptr,f.i32,f.ptr,f.ptr],returns:f.ptr}});var O=process.arch==="x64"||process.arch==="arm64";class R extends Error{constructor(e){super(e);this.name="FailSafeException"}}var oe=O?8:4;function re(e=0,t=0,s=0,n=0,o=0,r=0n){let a=20+oe,u=Buffer.alloc(a);if(u.writeInt32LE(e,0),u.writeInt32LE(t,4),u.writeUInt32LE(s>>>0,8),u.writeUInt32LE(n>>>0,12),u.writeUInt32LE(o>>>0,16),O)u.writeBigUInt64LE(BigInt(r),20);else u.writeUInt32LE(Number(r)>>>0,20);return u}function ae(e=0,t=0,s=0,n=0,o=0n){let r=12+oe,a=Buffer.alloc(r);if(a.writeUInt16LE(e&65535,0),a.writeUInt16LE(t&65535,2),a.writeUInt32LE(s>>>0,4),a.writeUInt32LE(n>>>0,8),O)a.writeBigUInt64LE(BigInt(o),12);else a.writeUInt32LE(Number(o)>>>0,12);return O?Buffer.concat([a,Buffer.alloc(32-a.length)]):a}function B(e,t){let s=O?40:36,n=Buffer.alloc(s);return n.writeUInt32LE(e>>>0,0),t.copy(n,8,0,Math.min(32,t.length)),n}import{ptr as _e}from"bun:ffi";function P(){if(i.FAILSAFE){let e=y();for(let t of i.FAILSAFE_POINTS)if(e[0]===t[0]&&e[1]===t[1])throw new R("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function x(e){if(e&&i.PAUSE_DELAY>0)Bun.sleepSync(i.PAUSE_DELAY)}function ce(e=0,t=0){let[s,n]=Re(),o=Math.round(e*65535/(s-1)),r=Math.round(t*65535/(n-1)),a=Math.max(0,Math.min(65535,o)),u=Math.max(0,Math.min(65535,r));return[a,u]}function y(e,t){let s=new ArrayBuffer(8),n=new DataView(s);c.symbols.GetCursorPos(_e(s));let o=n.getInt32(0,!0),r=n.getInt32(4,!0);return[e??o,t??r]}function Re(){let e=c.symbols.GetSystemMetrics(0),t=c.symbols.GetSystemMetrics(1);return[e,t]}var v={a:{scan:30},b:{scan:48},c:{scan:46},d:{scan:32},e:{scan:18},f:{scan:33},g:{scan:34},h:{scan:35},i:{scan:23},j:{scan:36},k:{scan:37},l:{scan:38},m:{scan:50},n:{scan:49},o:{scan:24},p:{scan:25},q:{scan:16},r:{scan:19},s:{scan:31},t:{scan:20},u:{scan:22},v:{scan:47},w:{scan:17},x:{scan:45},y:{scan:21},z:{scan:44},"0":{scan:11},"1":{scan:2},"2":{scan:3},"3":{scan:4},"4":{scan:5},"5":{scan:6},"6":{scan:7},"7":{scan:8},"8":{scan:9},"9":{scan:10},enter:{scan:28},numEnter:{scan:28,extended:!0},space:{scan:57},tab:{scan:15},escape:{scan:1},backspace:{scan:14},capslock:{scan:58},shift:{scan:42},ctrl:{scan:29},rctrl:{scan:29,extended:!0},alt:{scan:56},ralt:{scan:56,extended:!0},up:{scan:72,extended:!0},down:{scan:80,extended:!0},left:{scan:75,extended:!0},right:{scan:77,extended:!0},insert:{scan:82,extended:!0},delete:{scan:83,extended:!0},home:{scan:71,extended:!0},end:{scan:79,extended:!0},pageup:{scan:73,extended:!0},pagedown:{scan:81,extended:!0},f1:{scan:59},f2:{scan:60},f3:{scan:61},f4:{scan:62},f5:{scan:63},f6:{scan:64},f7:{scan:65},f8:{scan:66},f9:{scan:67},f10:{scan:68},f11:{scan:87},f12:{scan:88}},L=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]);var V=1,ie=32768,G=2,Y=4;var C=8,X=16;var W=32,H=64;var $=128,j=256,z=1,Q=2,fe=1,le=2,q=8;function ue(e,t,s,n=0){let o=s|(t?fe:0),r=ae(0,e,o,n,0n),a=B(1,r);c.symbols.SendInput(1,a,40)}function b(e,t=i.PAUSE){let{scan:s,extended:n}=v[e];if(ue(s,!!n,q),t)x(t);return M}function I(e,t=i.PAUSE){let{scan:s,extended:n}=v[e],o=q|le;if(ue(s,!!n,o),t)x(t);return M}function K(e,t=i.PAUSE){if(b(e),I(e),t)x(t);return M}function Ee(e,t=1,s=0,n=i.PAUSE){for(let o=0;o<t;o++)if(b(e),I(e),s>0)Bun.sleepSync(s);if(n)x(n);return M}function xe(e,t=0,s=i.PAUSE){for(let n of e){if(n>="A"&&n<="Z"){let o=n.toLowerCase();b("shift"),K(o),I("shift")}else if(L.has(n)){let o=L.get(n);b("shift"),K(o),I("shift")}else K(n);if(t>0)Bun.sleepSync(Math.round(t*1000))}if(s)x(s);return M}function S(e){let{scan:t}=v[e],s;if(t>1024){let o=t-1024;s=c.symbols.MapVirtualKeyW(o,1)}else s=c.symbols.MapVirtualKeyW(t,1);return(c.symbols.GetAsyncKeyState(s)&32768)!==0}function pe(e){return e.some((t)=>S(t))}function me(e){return e.every((t)=>S(t))}function de(e,t=i.PAUSE){for(let s of e)b(s);for(let s=e.length-1;s>=0;s--)I(e[s]);if(t)x(t);return M}function ye(e,t,s=i.PAUSE){if(b(e,!1),Bun.sleepSync(t),I(e,!1),s)x(s);return M}function Me(e,t){return new Promise((s)=>{let o=0,r=setInterval(()=>{if(S(e)){clearInterval(r),s(!0);return}if(t){if(o+=8,o>=t)clearInterval(r),s(!1)}},8)})}function Pe(e,t){return new Promise((s)=>{let o=0,r=setInterval(()=>{if(!S(e)){clearInterval(r),s(!0);return}if(t){if(o+=8,o>=t)clearInterval(r),s(!1)}},8)})}function Ie(e,t=i.PAUSE){if(K(e,!1),t)x(t);return M}function be(e){let{scan:t}=v[e],s;if(t>1024){let r=t-1024;s=c.symbols.MapVirtualKeyW(r,1)}else s=c.symbols.MapVirtualKeyW(t,1);let n=c.symbols.GetAsyncKeyState(s),o=c.symbols.GetKeyState(s);return{isPressed:(n&32768)!==0,isToggled:(o&1)!==0}}function Ae(e=i.PAUSE){let t=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],s="abcdefghijklmnopqrstuvwxyz".split("");t.push(...s);for(let n of t)if(S(n))I(n,!1);if(e)x(e);return M}class N{listeners=new Map;isRunning=!1;on(e,t){if(!this.listeners.has(e))this.listeners.set(e,new Set);this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}once(e,t){let s=(n)=>{try{t(n)}finally{this.off(e,s)}};this.on(e,s)}_emit(e,t){this.listeners.get(e)?.forEach((s)=>{try{s(t)}catch(n){console.error(`Listener error [${String(e)}]:`,n)}})}async start(e=8){if(this.isRunning)return;this.isRunning=!0;try{await this.run(e)}catch(t){console.error("Listener run error:",t)}finally{this.isRunning=!1}}stop(){this.isRunning=!1}}var ve={};for(let[e,t]of Object.entries(v))ve[t.scan&4095]=e;var Ve=new Set([1,2,4,5,6]);class Z extends N{async run(e=8){console.log("Keyboard listener started.");let t=Array(256).fill(!1),s=Array.from({length:256},(n,o)=>o);while(this.isRunning){for(let n of s){if(Ve.has(n))continue;let o=c.symbols.GetAsyncKeyState(n),r=(o&32768)!==0,a=(o&1)!==0,u=c.symbols.MapVirtualKeyW(n,0),l=ve[u];if(!l)if(n>=48&&n<=57)l=String.fromCharCode(n);else if(n>=65&&n<=90)l=String.fromCharCode(n).toLowerCase();else if(n===13)l="enter";else if(n===16)l="shift";else if(n===17)l="ctrl";else if(n===18)l="alt";else if(n===9)l="tab";else if(n===20)l="capslock";else if(n===27)l="escape";else if(n===32)l="space";else if(n>=112&&n<=123)l=`f${n-111}`;else continue;if(r!==t[n]){t[n]=r;let E={event:r?"down":"up",name:l,vk_code:n,isKeyDown:r};this._emit(r?"down":"up",E)}else if(!r&&a&&!t[n]){let E={event:"down",name:l,vk_code:n,isKeyDown:!0},p={event:"up",name:l,vk_code:n,isKeyDown:!1};this._emit("down",E),this._emit("up",p)}}await Bun.sleep(e)}console.log("Keyboard listener stopped.")}}class Se{press=b;release=I;tap=K;repeatTap=Ee;write=xe;isPressed=S;hotkey=de;hold=ye;isAnyPressed=pe;areAllPressed=me;waitForPress=Me;waitForRelease=Pe;toggleKey=Ie;getKeyState=be;releaseAll=Ae;listener=new Z}var M=new Se;var m="left",U="right",T="middle",k="x1",w="x2";var Ge=2048,Ye=4096,Ce=120;function h(e,t,s,n,o=0){let r=re(e,t,s,n,o,0n),a=B(0,r);c.symbols.SendInput(1,a,40)}function D(e=m,t=i.PAUSE){let s,n=0;if(e===m)s=G;else if(e===T)s=W;else if(e===U)s=C;else if(e===k)s=$,n=z;else if(e===w)s=$,n=Q;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);if(h(0,0,n,s,0),t)x(t);return d}function F(e=m,t=i.PAUSE){let s,n=0;if(e===m)s=Y;else if(e===T)s=H;else if(e===U)s=X;else if(e===k)s=j,n=z;else if(e===w)s=j,n=Q;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);if(h(0,0,n,s,0),t)x(t);return d}function J(e=m,t=1,s=0,n=i.PAUSE){if([m,T,U].includes(e)){let o=0,r=0;if(e===m)o=G,r=Y;else if(e===T)o=W,r=H;else o=C,r=X;for(let a=0;a<t;a++)if(P(),h(0,0,0,o,0),h(0,0,0,r,0),s>0)Bun.sleepSync(Math.round(s*1000))}if(n)x(n);return d}function A(e,t,s=!1,n=i.PAUSE){if(P(),e!==void 0&&!Number.isFinite(e))throw Error(`Invalid x coordinate: ${e}`);if(t!==void 0&&!Number.isFinite(t))throw Error(`Invalid y coordinate: ${t}`);if(!s){let[o,r]=y(e,t),[a,u]=ce(o,r);h(a,u,0,V|ie,0)}else ee(e??0,t??0,!0,n);if(n)x(n);return d}function ee(e=0,t=0,s=!1,n=i.PAUSE){if(P(),!s){let[o,r]=y();A(o+e,r+t,!1,n)}else if(h(e,t,0,V,0),n)x(n);return d}function he(e){let t;if(e===m)t=1;else if(e===U)t=2;else if(e===T)t=4;else if(e===k)t=5;else if(e===w)t=6;else throw Error(`Invalid button: ${e}`);return(c.symbols.GetAsyncKeyState(t)&32768)!==0}function te(e,t,s=m,n=0.5,o=i.PAUSE){P();let[r,a]=y();if(D(s,!1),n<=0)A(e,t,!1,!1);else{let u=Math.max(10,Math.floor(n*100)),l=n/u;for(let E=1;E<=u;E++){let p=E/u,_=Math.round(r+(e-r)*p),g=Math.round(a+(t-a)*p);A(_,g,!1,!1),Bun.sleepSync(Math.round(l*1000))}}if(F(s,!1),o)x(o);return d}function Ke(e,t,s=m,n=0.5,o=i.PAUSE){let[r,a]=y();return te(r+e,a+t,s,n,o)}function Te(e,t="vertical",s=i.PAUSE){P();let n=e*Ce;if(h(0,0,n,t==="vertical"?Ge:Ye,0),s)x(s);return d}var Xe={linear:(e)=>e,easeInQuad:(e)=>e*e,easeOutQuad:(e)=>e*(2-e),easeInOutQuad:(e)=>e<0.5?2*e*e:-1+(4-2*e)*e,easeInCubic:(e)=>e*e*e,easeOutCubic:(e)=>--e*e*e+1,easeInOutCubic:(e)=>e<0.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};async function Oe(e,t,s=0.5,n="easeOutQuad",o=i.PAUSE){P();let[r,a]=y(),u=Xe[n];if(s<=0)return A(e,t,!1,o),d;let l=Math.max(10,Math.floor(s*100)),E=s/l;for(let p=1;p<=l;p++){let _=p/l,g=u(_),ke=Math.round(r+(e-r)*g),we=Math.round(a+(t-a)*g);A(ke,we,!1,!1),Bun.sleepSync(Math.round(E*1000))}if(o)x(o);return d}function Ne(e,t,s=i.PAUSE){if(P(),D(e,!1),Bun.sleepSync(Math.round(t*1000)),F(e,!1),s)x(s);return d}function Ue(e,t,s=m,n=i.PAUSE){if(P(),A(e,t,!1,!0),J(s,1,0,!1),n)x(n);return d}function ne(e,t,s=0){let[n,o]=y(),r=Math.abs(n-e),a=Math.abs(o-t);return r<=s&&a<=s}function ge(e,t,s,n=0){return new Promise((o)=>{let a=0,u=setInterval(()=>{if(ne(e,t,n)){clearInterval(u),o(!0);return}if(s!==void 0){if(a+=8,a>=s)clearInterval(u),o(!1)}},8)})}import{ptr as He}from"bun:ffi";class se extends N{async run(e=8){console.log("Mouse listener started.");let t=new ArrayBuffer(8),s=new DataView(t),n={x:0,y:0},o={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){c.symbols.GetCursorPos(He(t));let r=s.getInt32(0,!0),a=s.getInt32(4,!0);if(r!==n.x||a!==n.y){let E={event:"move",x:r,y:a,lastX:n.x,lastY:n.y,deltaX:r-n.x,deltaY:a-n.y};this._emit("move",E),n.x=r,n.y=a}let u={left:c.symbols.GetAsyncKeyState(1),right:c.symbols.GetAsyncKeyState(2),middle:c.symbols.GetAsyncKeyState(4),x1:c.symbols.GetAsyncKeyState(5),x2:c.symbols.GetAsyncKeyState(6)},l=Object.fromEntries(Object.entries(u).map(([E,p])=>[E,(p&32768)!==0]));for(let E of Object.keys(o))if(l[E]!==o[E]){o[E]=l[E];let p={event:l[E]?"down":"up",button:E,x:n.x,y:n.y};this._emit(l[E]?"down":"up",p)}await Bun.sleep(e)}console.log("Mouse listener stopped.")}}class Be{get position(){let e=y();return{x:e[0],y:e[1]}}press=D;release=F;click=J;moveTo=A;moveRel=ee;isPressed=he;dragTo=te;dragRel=Ke;scroll=Te;smoothMoveTo=Oe;hold=Ne;clickAt=Ue;isAtPosition=ne;waitForPosition=ge;listener=new se}var d=new Be;export{d as mouse,M as keyboard,i as config};
