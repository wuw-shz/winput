// @bun
var At={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]]};import{dlopen as at,FFIType as r,suffix as fn}from"bun:ffi";var l=at(`user32.${fn}`,{SendInput:{args:[r.u32,r.ptr,r.i32],returns:r.u32},MapVirtualKeyW:{args:[r.u32,r.u32],returns:r.u32},GetCursorPos:{args:[r.ptr],returns:r.bool},GetKeyState:{args:[r.i32],returns:r.i16},GetAsyncKeyState:{args:[r.i32],returns:r.i16},SetWindowsHookExW:{args:[r.i32,r.ptr,r.ptr,r.u32],returns:r.ptr},UnhookWindowsHookEx:{args:[r.ptr],returns:r.bool},CallNextHookEx:{args:[r.ptr,r.i32,r.ptr,r.ptr],returns:r.ptr},GetDC:{args:[r.ptr],returns:r.u64},ReleaseDC:{args:[r.u64,r.u64],returns:r.int},GetDesktopWindow:{args:[],returns:r.ptr},GetForegroundWindow:{args:[],returns:r.u64},GetWindowTextW:{args:[r.u64,r.ptr,r.int],returns:r.int},GetWindowRect:{args:[r.u64,r.ptr],returns:r.bool},GetSystemMetrics:{args:[r.int],returns:r.int},SetLayeredWindowAttributes:{args:[r.u64,r.uint32_t,r.int8_t,r.uint32_t],returns:r.bool},UpdateLayeredWindow:{args:[r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.uint32_t,r.ptr,r.uint32_t],returns:r.bool},GetWindowLongW:{args:[r.u64,r.int],returns:r.int},SetWindowLongW:{args:[r.u64,r.int,r.int],returns:r.int},CreateWindowExW:{args:[r.uint32_t,r.ptr,r.ptr,r.uint32_t,r.int,r.int,r.int,r.int,r.ptr,r.ptr,r.ptr,r.ptr],returns:r.ptr},ShowWindow:{args:[r.u64,r.int],returns:r.bool},UpdateWindow:{args:[r.u64],returns:r.bool},SetWindowPos:{args:[r.u64,r.u64,r.int,r.int,r.int,r.int,r.uint32_t],returns:r.bool},FindWindowA:{args:[r.ptr,r.ptr],returns:r.u64},FillRect:{args:[r.ptr,r.ptr,r.ptr],returns:r.int},IsWindow:{args:[r.u64],returns:r.bool},SetForegroundWindow:{args:[r.u64],returns:r.bool},IsWindowVisible:{args:[r.u64],returns:r.bool},GetWindowThreadProcessId:{args:[r.u64,r.ptr],returns:r.u32},MoveWindow:{args:[r.u64,r.int,r.int,r.int,r.int,r.bool],returns:r.bool},GetClientRect:{args:[r.u64,r.ptr],returns:r.bool},PostMessageA:{args:[r.u64,r.u32,r.u64,r.u64],returns:r.bool},GetClassNameA:{args:[r.u64,r.ptr,r.int],returns:r.int},SetWindowTextW:{args:[r.u64,r.ptr],returns:r.bool},EnableWindow:{args:[r.u64,r.bool],returns:r.bool},RedrawWindow:{args:[r.u64,r.ptr,r.u64,r.u32],returns:r.bool},ClientToScreen:{args:[r.u64,r.ptr],returns:r.bool},ScreenToClient:{args:[r.u64,r.ptr],returns:r.bool},SendMessageA:{args:[r.u64,r.u32,r.u64,r.u64],returns:r.ptr},IsIconic:{args:[r.u64],returns:r.bool},IsZoomed:{args:[r.u64],returns:r.bool},EnumWindows:{args:[r.function,r.i64],returns:r.bool},EnumChildWindows:{args:[r.u64,r.function,r.i64],returns:r.bool},FlashWindow:{args:[r.u64,r.bool],returns:r.bool},PrintWindow:{args:[r.u64,r.u64,r.u32],returns:r.bool},GetWindowDC:{args:[r.u64],returns:r.u64},LoadImageW:{args:[r.u64,r.ptr,r.uint32_t,r.int,r.int,r.uint32_t],returns:r.u64},SetWindowRgn:{args:[r.u64,r.u64,r.bool],returns:r.int},EnumDisplayMonitors:{args:[r.ptr,r.ptr,r.function,r.ptr],returns:r.bool},GetMonitorInfoW:{args:[r.ptr,r.ptr],returns:r.bool}}),D=at("gdi32.dll",{GetPixel:{args:[r.u64,r.int,r.int],returns:r.uint32_t},CreatePen:{args:[r.int,r.int,r.uint32_t],returns:r.u64},SelectObject:{args:[r.u64,r.u64],returns:r.u64},MoveToEx:{args:[r.u64,r.int,r.int,r.ptr],returns:r.bool},LineTo:{args:[r.u64,r.int,r.int],returns:r.bool},DeleteObject:{args:[r.u64],returns:r.bool},CreateCompatibleDC:{args:[r.u64],returns:r.u64},CreateDIBSection:{args:[r.ptr,r.ptr,r.uint32_t,r.ptr,r.ptr,r.uint32_t],returns:r.ptr},DeleteDC:{args:[r.u64],returns:r.bool},CreateSolidBrush:{args:[r.uint32_t],returns:r.u64},CreateCompatibleBitmap:{args:[r.u64,r.int,r.int],returns:r.u64},BitBlt:{args:[r.u64,r.int,r.int,r.int,r.int,r.u64,r.int,r.int,r.uint32_t],returns:r.bool},GetDIBits:{args:[r.u64,r.u64,r.u32,r.u32,r.ptr,r.ptr,r.u32],returns:r.int},GetObjectA:{args:[r.ptr,r.int,r.ptr],returns:r.int},CreateRectRgn:{args:[r.int,r.int,r.int,r.int],returns:r.u64},CreateEllipticRgn:{args:[r.int,r.int,r.int,r.int],returns:r.u64},CreateRoundRectRgn:{args:[r.int,r.int,r.int,r.int,r.int,r.int],returns:r.u64},CreatePolygonRgn:{args:[r.ptr,r.int,r.int],returns:r.u64}}),P=at(`kernel32.${fn}`,{GetLastError:{args:[],returns:r.u32},OpenProcess:{args:[r.u32,r.bool,r.u32],returns:r.u64},CloseHandle:{args:[r.u64],returns:r.bool},QueryFullProcessImageNameW:{args:[r.u64,r.u32,r.ptr,r.ptr],returns:r.bool},TerminateProcess:{args:[r.u64,r.u32],returns:r.bool},RtlMoveMemory:{args:[r.ptr,r.u64,r.u64],returns:r.void}}),R=at("gdiplus.dll",{GdiplusStartup:{args:[r.ptr,r.ptr,r.ptr],returns:r.int},GdiplusShutdown:{args:[r.u64],returns:r.void},GdipCreateBitmapFromFile:{args:[r.ptr,r.ptr],returns:r.int},GdipGetImageWidth:{args:[r.u64,r.ptr],returns:r.int},GdipGetImageHeight:{args:[r.u64,r.ptr],returns:r.int},GdipBitmapLockBits:{args:[r.u64,r.ptr,r.uint32_t,r.int,r.ptr],returns:r.int},GdipBitmapUnlockBits:{args:[r.u64,r.ptr],returns:r.int},GdipDisposeImage:{args:[r.u64],returns:r.int},GdipCreateBitmapFromScan0:{args:[r.int,r.int,r.int,r.int,r.ptr,r.ptr],returns:r.int},GdipSaveImageToFile:{args:[r.u64,r.ptr,r.ptr,r.ptr],returns:r.int},GdipGetImageEncodersSize:{args:[r.ptr,r.ptr],returns:r.int},GdipGetImageEncoders:{args:[r.u32,r.u32,r.ptr],returns:r.int}});var Z=process.arch==="x64"||process.arch==="arm64";class Ot extends Error{constructor(t){super(t);this.name="FailSafeException"}}var En=Z?8:4;function pn(t=0,n=0,e=0,a=0,s=0,u=0n){let o=20+En,x=Buffer.alloc(o);if(x.writeInt32LE(t,0),x.writeInt32LE(n,4),x.writeUInt32LE(e>>>0,8),x.writeUInt32LE(a>>>0,12),x.writeUInt32LE(s>>>0,16),Z)x.writeBigUInt64LE(BigInt(u),20);else x.writeUInt32LE(Number(u)>>>0,20);return x}function Dt(t=0,n=0,e=0,a=0,s=0n){let u=12+En,o=Buffer.alloc(u);if(o.writeUInt16LE(t&65535,0),o.writeUInt16LE(n&65535,2),o.writeUInt32LE(e>>>0,4),o.writeUInt32LE(a>>>0,8),Z)o.writeBigUInt64LE(BigInt(s),12);else o.writeUInt32LE(Number(s)>>>0,12);return Z?Buffer.concat([o,Buffer.alloc(32-o.length)]):o}function J(t,n){let e=Z?40:36,a=Buffer.alloc(e);return a.writeUInt32LE(t>>>0,0),n.copy(a,8,0,Math.min(32,n.length)),a}var c={LBUTTON:1,RBUTTON:2,MBUTTON:4,XBUTTON1:5,XBUTTON2:6,BACK:8,TAB:9,RETURN:13,SHIFT:16,CONTROL:17,MENU:18,PAUSE:19,CAPITAL:20,ESCAPE:27,SPACE:32,PRIOR:33,NEXT:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,LWIN:91,RWIN:92,APPS:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SEPARATOR:108,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NUMLOCK:144,SCROLL:145,LSHIFT:160,RSHIFT:161,LCONTROL:162,RCONTROL:163,LMENU:164,RMENU:165,BROWSER_BACK:166,BROWSER_FORWARD:167,BROWSER_REFRESH:168,BROWSER_STOP:169,BROWSER_SEARCH:170,BROWSER_FAVORITES:171,BROWSER_HOME:172,VOLUME_MUTE:173,VOLUME_DOWN:174,VOLUME_UP:175,MEDIA_NEXT_TRACK:176,MEDIA_PREV_TRACK:177,MEDIA_STOP:178,MEDIA_PLAY_PAUSE:179,LAUNCH_MAIL:180,LAUNCH_MEDIA_SELECT:181,LAUNCH_APP1:182,LAUNCH_APP2:183,OEM_1:186,OEM_PLUS:187,OEM_COMMA:188,OEM_MINUS:189,OEM_PERIOD:190,OEM_2:191,OEM_3:192,OEM_4:219,OEM_5:220,OEM_6:221,OEM_7:222,SNAPSHOT:44,SLEEP:95},X={a:{scan:30,vk:c.KEY_A},b:{scan:48,vk:c.KEY_B},c:{scan:46,vk:c.KEY_C},d:{scan:32,vk:c.KEY_D},e:{scan:18,vk:c.KEY_E},f:{scan:33,vk:c.KEY_F},g:{scan:34,vk:c.KEY_G},h:{scan:35,vk:c.KEY_H},i:{scan:23,vk:c.KEY_I},j:{scan:36,vk:c.KEY_J},k:{scan:37,vk:c.KEY_K},l:{scan:38,vk:c.KEY_L},m:{scan:50,vk:c.KEY_M},n:{scan:49,vk:c.KEY_N},o:{scan:24,vk:c.KEY_O},p:{scan:25,vk:c.KEY_P},q:{scan:16,vk:c.KEY_Q},r:{scan:19,vk:c.KEY_R},s:{scan:31,vk:c.KEY_S},t:{scan:20,vk:c.KEY_T},u:{scan:22,vk:c.KEY_U},v:{scan:47,vk:c.KEY_V},w:{scan:17,vk:c.KEY_W},x:{scan:45,vk:c.KEY_X},y:{scan:21,vk:c.KEY_Y},z:{scan:44,vk:c.KEY_Z},"0":{scan:11,vk:c.KEY_0},"1":{scan:2,vk:c.KEY_1},"2":{scan:3,vk:c.KEY_2},"3":{scan:4,vk:c.KEY_3},"4":{scan:5,vk:c.KEY_4},"5":{scan:6,vk:c.KEY_5},"6":{scan:7,vk:c.KEY_6},"7":{scan:8,vk:c.KEY_7},"8":{scan:9,vk:c.KEY_8},"9":{scan:10,vk:c.KEY_9},f1:{scan:59,vk:c.F1},f2:{scan:60,vk:c.F2},f3:{scan:61,vk:c.F3},f4:{scan:62,vk:c.F4},f5:{scan:63,vk:c.F5},f6:{scan:64,vk:c.F6},f7:{scan:65,vk:c.F7},f8:{scan:66,vk:c.F8},f9:{scan:67,vk:c.F9},f10:{scan:68,vk:c.F10},f11:{scan:87,vk:c.F11},f12:{scan:88,vk:c.F12},f13:{scan:100,vk:c.F13},f14:{scan:101,vk:c.F14},f15:{scan:102,vk:c.F15},f16:{scan:103,vk:c.F16},f17:{scan:104,vk:c.F17},f18:{scan:105,vk:c.F18},f19:{scan:106,vk:c.F19},f20:{scan:107,vk:c.F20},f21:{scan:108,vk:c.F21},f22:{scan:109,vk:c.F22},f23:{scan:110,vk:c.F23},f24:{scan:118,vk:c.F24},"-":{scan:12,vk:c.OEM_MINUS},minus:{scan:12,vk:c.OEM_MINUS},"=":{scan:13,vk:c.OEM_PLUS},equal:{scan:13,vk:c.OEM_PLUS},equals:{scan:13,vk:c.OEM_PLUS},"[":{scan:26,vk:c.OEM_4},bracketleft:{scan:26,vk:c.OEM_4},"]":{scan:27,vk:c.OEM_6},bracketright:{scan:27,vk:c.OEM_6},"\\":{scan:43,vk:c.OEM_5},backslash:{scan:43,vk:c.OEM_5},";":{scan:39,vk:c.OEM_1},semicolon:{scan:39,vk:c.OEM_1},"'":{scan:40,vk:c.OEM_7},quote:{scan:40,vk:c.OEM_7},apostrophe:{scan:40,vk:c.OEM_7},"`":{scan:41,vk:c.OEM_3},grave:{scan:41,vk:c.OEM_3},backtick:{scan:41,vk:c.OEM_3},",":{scan:51,vk:c.OEM_COMMA},comma:{scan:51,vk:c.OEM_COMMA},".":{scan:52,vk:c.OEM_PERIOD},period:{scan:52,vk:c.OEM_PERIOD},dot:{scan:52,vk:c.OEM_PERIOD},"/":{scan:53,vk:c.OEM_2},slash:{scan:53,vk:c.OEM_2},forwardslash:{scan:53,vk:c.OEM_2},space:{scan:57,vk:c.SPACE},enter:{scan:28,vk:c.RETURN},return:{scan:28,vk:c.RETURN},tab:{scan:15,vk:c.TAB},backspace:{scan:14,vk:c.BACK},escape:{scan:1,vk:c.ESCAPE},esc:{scan:1,vk:c.ESCAPE},shift:{scan:42,vk:c.SHIFT},shiftleft:{scan:42,vk:c.LSHIFT},shiftright:{scan:54,vk:c.RSHIFT},ctrl:{scan:29,vk:c.CONTROL},control:{scan:29,vk:c.CONTROL},ctrlleft:{scan:29,vk:c.LCONTROL},controlleft:{scan:29,vk:c.LCONTROL},ctrlright:{scan:29,extended:!0,vk:c.RCONTROL},controlright:{scan:29,extended:!0,vk:c.RCONTROL},rctrl:{scan:29,extended:!0,vk:c.RCONTROL},alt:{scan:56,vk:c.MENU},altleft:{scan:56,vk:c.LMENU},altright:{scan:56,extended:!0,vk:c.RMENU},ralt:{scan:56,extended:!0,vk:c.RMENU},altgr:{scan:56,extended:!0,vk:c.RMENU},win:{scan:91,extended:!0,vk:c.LWIN},winleft:{scan:91,extended:!0,vk:c.LWIN},windows:{scan:91,extended:!0,vk:c.LWIN},winright:{scan:92,extended:!0,vk:c.RWIN},windowsright:{scan:92,extended:!0,vk:c.RWIN},apps:{scan:93,extended:!0,vk:c.APPS},menu:{scan:93,extended:!0,vk:c.APPS},contextmenu:{scan:93,extended:!0,vk:c.APPS},capslock:{scan:58,vk:c.CAPITAL},numlock:{scan:69,vk:c.NUMLOCK},scrolllock:{scan:70,vk:c.SCROLL},up:{scan:72,extended:!0,vk:c.UP},down:{scan:80,extended:!0,vk:c.DOWN},left:{scan:75,extended:!0,vk:c.LEFT},right:{scan:77,extended:!0,vk:c.RIGHT},home:{scan:71,extended:!0,vk:c.HOME},end:{scan:79,extended:!0,vk:c.END},pageup:{scan:73,extended:!0,vk:c.PRIOR},pagedown:{scan:81,extended:!0,vk:c.NEXT},insert:{scan:82,extended:!0,vk:c.INSERT},delete:{scan:83,extended:!0,vk:c.DELETE},del:{scan:83,extended:!0,vk:c.DELETE},numpad0:{scan:82,vk:c.NUMPAD0},numpad1:{scan:79,vk:c.NUMPAD1},numpad2:{scan:80,vk:c.NUMPAD2},numpad3:{scan:81,vk:c.NUMPAD3},numpad4:{scan:75,vk:c.NUMPAD4},numpad5:{scan:76,vk:c.NUMPAD5},numpad6:{scan:77,vk:c.NUMPAD6},numpad7:{scan:71,vk:c.NUMPAD7},numpad8:{scan:72,vk:c.NUMPAD8},numpad9:{scan:73,vk:c.NUMPAD9},numpaddecimal:{scan:83,vk:c.DECIMAL},numpadperiod:{scan:83,vk:c.DECIMAL},numpaddivide:{scan:53,extended:!0,vk:c.DIVIDE},numpadmultiply:{scan:55,vk:c.MULTIPLY},numpadsubtract:{scan:74,vk:c.SUBTRACT},numpadadd:{scan:78,vk:c.ADD},numpadenter:{scan:28,extended:!0,vk:c.RETURN},num0:{scan:82,vk:c.NUMPAD0},num1:{scan:79,vk:c.NUMPAD1},num2:{scan:80,vk:c.NUMPAD2},num3:{scan:81,vk:c.NUMPAD3},num4:{scan:75,vk:c.NUMPAD4},num5:{scan:76,vk:c.NUMPAD5},num6:{scan:77,vk:c.NUMPAD6},num7:{scan:71,vk:c.NUMPAD7},num8:{scan:72,vk:c.NUMPAD8},num9:{scan:73,vk:c.NUMPAD9},volumeup:{scan:0,vk:c.VOLUME_UP},volumedown:{scan:0,vk:c.VOLUME_DOWN},volumemute:{scan:0,vk:c.VOLUME_MUTE},mute:{scan:0,vk:c.VOLUME_MUTE},playpause:{scan:0,vk:c.MEDIA_PLAY_PAUSE},stop:{scan:0,vk:c.MEDIA_STOP},nexttrack:{scan:0,vk:c.MEDIA_NEXT_TRACK},previoustrack:{scan:0,vk:c.MEDIA_PREV_TRACK},medianext:{scan:0,vk:c.MEDIA_NEXT_TRACK},mediaprevious:{scan:0,vk:c.MEDIA_PREV_TRACK},mediaplaypause:{scan:0,vk:c.MEDIA_PLAY_PAUSE},mediastop:{scan:0,vk:c.MEDIA_STOP},browserhome:{scan:0,vk:c.BROWSER_HOME},browserback:{scan:0,vk:c.BROWSER_BACK},browserforward:{scan:0,vk:c.BROWSER_FORWARD},browserrefresh:{scan:0,vk:c.BROWSER_REFRESH},browserstop:{scan:0,vk:c.BROWSER_STOP},browsersearch:{scan:0,vk:c.BROWSER_SEARCH},browserfavorites:{scan:0,vk:c.BROWSER_FAVORITES},mail:{scan:0,vk:c.LAUNCH_MAIL},calculator:{scan:0,vk:c.LAUNCH_APP2},mycomputer:{scan:0,vk:c.LAUNCH_APP1},computer:{scan:0,vk:c.LAUNCH_APP1},printscreen:{scan:55,extended:!0,vk:c.SNAPSHOT},prtsc:{scan:55,extended:!0,vk:c.SNAPSHOT},pause:{scan:69,vk:c.PAUSE},break:{scan:70,vk:c.PAUSE},sleep:{scan:0,vk:c.SLEEP},intl1:{scan:115},intl2:{scan:112},intl3:{scan:125},intl4:{scan:121},intl5:{scan:123},intl6:{scan:92},lang1:{scan:114},lang2:{scan:113}},Nt=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]),z={};for(let[t,n]of Object.entries(X)){let e=n;if(e.vk&&!z[e.vk])z[e.vk]=t}var mn={},ln={};for(let[t,n]of Object.entries(X)){let e=n;if(e.scan>0){if(e.extended){if(!ln[e.scan])ln[e.scan]=t}else if(!mn[e.scan])mn[e.scan]=t}}var Kt=1,bn=32768,Tt=2,gt=4;var yt=8,Rt=16;var St=32,Pt=64;var Bt=128,Ft=256,Mn=1,_n=2,Un=1,ht=2,Yt=8;var Tr=0;function kn(t,n,e,a=0){let s=e|(n?Un:0),u=Dt(0,t,s,a,0n),o=J(1,u);l.symbols.SendInput(1,o,40)}function vn(t,n,e=0){let s=Dt(t,0,n?ht:Tr,e,0n),u=J(1,s);l.symbols.SendInput(1,u,40)}function ut(t){let n=X[t];if(!n)throw Error(`Invalid key name: "${t}"`);return n}function G(t){let n=ut(t);if(n.scan===0&&n.vk)vn(n.vk,!1);else{let e=Yt;kn(n.scan,!!n.extended,e)}return B}function Y(t){let n=ut(t);if(n.scan===0&&n.vk)vn(n.vk,!0);else{let e=Yt|ht;kn(n.scan,!!n.extended,e)}return B}function j(t){return G(t),Y(t),B}function In(t,n=1,e=0){if(n<1)throw Error(`repeat must be >= 1, got: ${n}`);if(e<0)throw Error(`delay must be >= 0, got: ${e}`);for(let a=0;a<n;a++)if(G(t),Y(t),e>0)Bun.sleepSync(e);return B}function dn(t,n=0){if(n<0)throw Error(`delay must be >= 0, got: ${n}`);for(let e of t){if(e>="A"&&e<="Z"){let a=e.toLowerCase();G("shift"),j(a),Y("shift")}else if(Nt.has(e)){let a=Nt.get(e);G("shift"),j(a),Y("shift")}else j(e);if(n>0)Bun.sleepSync(n)}return B}function $(t){let n=ut(t);if(n.vk)return(l.symbols.GetAsyncKeyState(n.vk)&32768)!==0;let e=l.symbols.MapVirtualKeyW(n.scan,1);return(l.symbols.GetAsyncKeyState(e)&32768)!==0}function An(t){return t.some((n)=>$(n))}function On(t){return t.every((n)=>$(n))}function Dn(t){for(let n of t)G(n);for(let n=t.length-1;n>=0;n--)Y(t[n]);return B}function Nn(t,n){if(n<0)throw Error(`duration must be >= 0, got: ${n}`);return G(t),Bun.sleepSync(n),Y(t),B}function Kn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if($(t)){clearInterval(u),e(!0);return}if(n){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}function Tn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(!$(t)){clearInterval(u),e(!0);return}if(n){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}function gn(t){return j(t),B}function yn(t){let n=ut(t),e;if(n.vk)e=n.vk;else e=l.symbols.MapVirtualKeyW(n.scan,1);let a=l.symbols.GetAsyncKeyState(e),s=l.symbols.GetKeyState(e);return{isPressed:(a&32768)!==0,isToggled:(s&1)!==0}}function Rn(){let t=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],n="abcdefghijklmnopqrstuvwxyz".split("");t.push(...n);for(let e of t)if($(e))Y(e);return B}class tt{listeners=new Map;isRunning=!1;startPromise=null;_onProxy=null;_offProxy=null;_onceProxy=null;_listenProxy=null;get on(){if(!this._onProxy)this._onProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._on(n,e)}}});return this._onProxy}get off(){if(!this._offProxy)this._offProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._off(n,e)}}});return this._offProxy}get once(){if(!this._onceProxy)this._onceProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._once(n,e)}}});return this._onceProxy}get listen(){if(!this._listenProxy)this._listenProxy=(t)=>{this._on("*",t)};return this._listenProxy}unlisten(t){this._off("*",t)}_on(t,n){if(!this.listeners.has(t))this.listeners.set(t,new Set);this.listeners.get(t).add(n)}_off(t,n){this.listeners.get(t)?.delete(n)}_once(t,n){let e=(a)=>{try{n(a)}finally{this._off(t,e)}};this._on(t,e)}async start(t=8){if(this.isRunning)return console.warn("Listener already running"),this.startPromise??Promise.resolve();return this.isRunning=!0,this.startPromise=(async()=>{try{await this.run(t)}catch(n){console.error("Listener run error:",n)}finally{this.isRunning=!1,this.startPromise=null}})(),this.startPromise}async stop(){if(this.isRunning=!1,this.startPromise)await this.startPromise}_emit(t,n){this.listeners.get(t)?.forEach((e)=>{try{e(n)}catch(a){console.error(`Listener error [${String(t)}]:`,a)}}),this.listeners.get("*")?.forEach((e)=>{try{e(n)}catch(a){console.error("Listener error [*]:",a)}})}}var yr=new Set([c.LBUTTON,c.RBUTTON,c.MBUTTON,c.XBUTTON1,c.XBUTTON2]);function Rr(t){if(z[t])return z[t];if(t>=48&&t<=57)return String.fromCharCode(t);if(t>=65&&t<=90)return String.fromCharCode(t).toLowerCase();return}var Sr=Object.values(c);class Lt extends tt{async run(t=8){if(t<1||t>1000)console.warn(`Keyboard listener interval out of recommended range (1-1000ms): ${t}ms`);let n=new Map;while(this.isRunning){for(let e of Sr){if(yr.has(e))continue;let s=(l.symbols.GetAsyncKeyState(e)&32768)!==0,u=n.get(e);if(u!==s){if(n.set(e,s),u!==void 0){let o=Rr(e);if(!o)continue;let x=X[o].scan,f={event:s?"down":"up",key:o,vk_code:e,scan_code:x};this._emit(s?"down":"up",f)}}}await Bun.sleep(t)}}}class Sn{press=G;release=Y;tap=j;repeatTap=In;write=dn;isPressed=$;hotkey=Dn;hold=Nn;isAnyPressed=An;areAllPressed=On;waitForPress=Kn;waitForRelease=Tn;toggleKey=gn;getKeyState=yn;releaseAll=Rn;listener=new Lt}var B=new Sn;import{ptr as Pr}from"bun:ffi";function L(){if(At.FAILSAFE){let t=F();for(let n of At.FAILSAFE_POINTS)if(t[0]===n[0]&&t[1]===n[1])throw new Ot("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function Pn(t=0,n=0){let[e,a]=[l.symbols.GetSystemMetrics(0),l.symbols.GetSystemMetrics(1)],s=Math.round(t*65535/(e-1)),u=Math.round(n*65535/(a-1)),o=Math.max(0,Math.min(65535,s)),x=Math.max(0,Math.min(65535,u));return[o,x]}function F(t,n){let e=new ArrayBuffer(8),a=new DataView(e);l.symbols.GetCursorPos(Pr(e));let s=a.getInt32(0,!0),u=a.getInt32(4,!0);return[t??s,n??u]}var S="left",ct="right",nt="middle",Ct="x1",Gt="x2";var Br=2048,Fr=4096,hr=120,Yr={[S]:{down:Tt,up:gt,data:0},[nt]:{down:St,up:Pt,data:0},[ct]:{down:yt,up:Rt,data:0},[Ct]:{down:Bt,up:Ft,data:Mn},[Gt]:{down:Bt,up:Ft,data:_n}};function Bn(t,n){let e=Yr[t];if(!e)throw Error(`Invalid button: ${t}`);return{event:e[n],mouseData:e.data}}function Lr(t,n){if(t!==void 0){if(!Number.isFinite(t))throw Error(`Invalid x coordinate: ${t}`);if(t<0)throw Error(`x coordinate must be non-negative: ${t}`)}if(n!==void 0){if(!Number.isFinite(n))throw Error(`Invalid y coordinate: ${n}`);if(n<0)throw Error(`y coordinate must be non-negative: ${n}`)}}function H(t,n,e,a,s=0){let u=pn(t,n,e,a,s,0n),o=J(0,u);l.symbols.SendInput(1,o,40)}function xt(t=S){try{let{event:n,mouseData:e}=Bn(t,"down");return H(0,0,e,n,0),y}catch(n){throw console.error("[Mouse Press Error]",n),n}}function ft(t=S){try{let{event:n,mouseData:e}=Bn(t,"up");return H(0,0,e,n,0),y}catch(n){throw console.error("[Mouse Release Error]",n),n}}function Vt(t=S,n=1,e=0){if(n<1)throw Error(`repeat must be >= 1, got: ${n}`);if(e<0)throw Error(`delay must be >= 0, got: ${e}`);if([S,nt,ct].includes(t)){let a=0,s=0;if(t===S)a=Tt,s=gt;else if(t===nt)a=St,s=Pt;else a=yt,s=Rt;for(let u=0;u<n;u++)if(L(),H(0,0,0,a,0),H(0,0,0,s,0),e>0)Bun.sleepSync(Math.round(e*1000))}return y}function V(t,n,e=!1){try{if(L(),Lr(t,n),!e){let[a,s]=F(t,n),[u,o]=Pn(a,s);H(u,o,0,Kt|bn,0)}else wt(t??0,n??0,!0);return y}catch(a){throw console.error("[Mouse MoveTo Error]",a),a}}function wt(t=0,n=0,e=!1){if(L(),!e){let[a,s]=F();V(a+t,s+n,!1)}else H(t,n,0,Kt,0);return y}function it(t){let n;if(t===S)n=1;else if(t===ct)n=2;else if(t===nt)n=4;else if(t===Ct)n=5;else if(t===Gt)n=6;else throw Error(`Invalid button: ${t}`);return(l.symbols.GetAsyncKeyState(n)&32768)!==0}function Xt(t,n,e=S,a=0.5){if(a<0)throw Error(`duration must be >= 0, got: ${a}`);L();let[s,u]=F();if(xt(e),a<=0)V(t,n,!1);else{let o=Math.max(10,Math.floor(a*100)),x=a/o;for(let f=1;f<=o;f++){let i=f/o,E=Math.round(s+(t-s)*i),b=Math.round(u+(n-u)*i);V(E,b,!1),Bun.sleepSync(Math.round(x*1000))}}return ft(e),y}function Fn(t,n,e=S,a=0.5){let[s,u]=F();return Xt(s+t,u+n,e,a)}function hn(t,n="vertical"){L();let e=t*hr;return H(0,0,e,n==="vertical"?Br:Fr,0),y}var Cr={linear:(t)=>t,easeInQuad:(t)=>t*t,easeOutQuad:(t)=>t*(2-t),easeInOutQuad:(t)=>t<0.5?2*t*t:-1+(4-2*t)*t,easeInCubic:(t)=>t*t*t,easeOutCubic:(t)=>--t*t*t+1,easeInOutCubic:(t)=>t<0.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1};async function Yn(t,n,e=0.5,a="easeOutQuad"){if(e<0)throw Error(`duration must be >= 0, got: ${e}`);L();let[s,u]=F(),o=Cr[a];if(e<=0)return V(t,n,!1),y;let x=Math.max(10,Math.floor(e*100)),f=e/x;for(let i=1;i<=x;i++){let E=i/x,b=o(E),_=Math.round(s+(t-s)*b),p=Math.round(u+(n-u)*b);V(_,p,!1),Bun.sleepSync(Math.round(f*1000))}return y}function Ln(t,n){if(n<0)throw Error(`duration must be >= 0, got: ${n}`);return L(),xt(t),Bun.sleepSync(Math.round(n*1000)),ft(t),y}function Cn(t,n,e=S){return L(),V(t,n,!1),Vt(e,1,0),y}function $t(t,n,e=0){if(e<0)throw Error(`tolerance must be >= 0, got: ${e}`);let[a,s]=F(),u=Math.abs(a-t),o=Math.abs(s-n);return u<=e&&o<=e}function Gn(t,n,e,a=0){if(e!==void 0&&e<0)throw Error(`timeout must be >= 0, got: ${e}`);if(a<0)throw Error(`tolerance must be >= 0, got: ${a}`);return new Promise((s)=>{let o=0,x=setInterval(()=>{if($t(t,n,a)){clearInterval(x),s(!0);return}if(e!==void 0){if(o+=8,o>=e)clearInterval(x),s(!1)}},8)})}async function Vn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(it(t)){clearInterval(u),e(!0);return}if(n!==void 0){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}async function wn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(!it(t)){clearInterval(u),e(!0);return}if(n!==void 0){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}import{ptr as Vr}from"bun:ffi";class Ht extends tt{async run(t=8){if(t<1||t>1000)console.warn(`Mouse listener interval out of recommended range (1-1000ms): ${t}ms`);let n=new ArrayBuffer(8),e=new DataView(n),a={x:0,y:0},s={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){l.symbols.GetCursorPos(Vr(n));let u=e.getInt32(0,!0),o=e.getInt32(4,!0);if(u!==a.x||o!==a.y){let i={event:"move",x:u,y:o,lastX:a.x,lastY:a.y,deltaX:u-a.x,deltaY:o-a.y};this._emit("move",i),a.x=u,a.y=o}let x={left:l.symbols.GetAsyncKeyState(1),right:l.symbols.GetAsyncKeyState(2),middle:l.symbols.GetAsyncKeyState(4),x1:l.symbols.GetAsyncKeyState(5),x2:l.symbols.GetAsyncKeyState(6)},f=Object.fromEntries(Object.entries(x).map(([i,E])=>[i,(E&32768)!==0]));for(let i of Object.keys(s))if(f[i]!==s[i]){s[i]=f[i];let E={event:f[i]?"down":"up",button:i,x:a.x,y:a.y};this._emit(f[i]?"down":"up",E)}await Bun.sleep(t)}}}class Xn{get position(){let t=F();return{x:t[0],y:t[1]}}press=xt;release=ft;click=Vt;moveTo=V;moveRel=wt;isPressed=it;dragTo=Xt;dragRel=Fn;scroll=hn;smoothMoveTo=Yn;hold=Ln;clickAt=Cn;isAtPosition=$t;waitForPosition=Gn;waitForPress=Vn;waitForRelease=wn;listener=new Ht}var y=new Xn;import{ptr as T}from"bun:ffi";var Wt;((p)=>{p[p.png=0]="png";p[p.jpg=1]="jpg";p[p.jpeg=2]="jpeg";p[p.bmp=3]="bmp";p[p.webp=4]="webp";p[p.gif=5]="gif";p[p.tiff=6]="tiff";p[p.ico=7]="ico";p[p.heic=8]="heic";p[p.heif=9]="heif";p[p.avif=10]="avif";p[p.svg=11]="svg";p[p.raw=12]="raw"})(Wt||={});import{extname as $n}from"path";var Hn=null;function Wn(){if(Hn)return;let t=new Uint8Array(24);new DataView(t.buffer).setUint32(0,1,!0);let e=new BigUint64Array(1),a=R.symbols.GdiplusStartup(T(e),T(t),null);if(a!==0)throw Error(`GDI+ Startup failed: ${a}`);Hn=e[0]}async function Et(t){try{Wn();let n=Buffer.from(t+"\x00","utf16le"),e=new BigUint64Array(1),a=R.symbols.GdipCreateBitmapFromFile(T(n),T(e));if(a!==0)return console.error(`GDI+ Load Image failed: ${a} for ${t}`),null;let s=e[0];try{let u=new Uint32Array(1),o=new Uint32Array(1);R.symbols.GdipGetImageWidth(s,T(u)),R.symbols.GdipGetImageHeight(s,T(o));let x=u[0],f=o[0],i=2498570,E=new Uint32Array([0,0,x,f]),b=new Uint8Array(40),_=R.symbols.GdipBitmapLockBits(s,T(E),1,i,T(b));if(_!==0)return console.error(`GDI+ Load Image LockBits failed: ${_}`),null;try{let p=new DataView(b.buffer),M=p.getBigUint64(16,!0),m=p.getInt32(8,!0),U=x*f*4,k=new Uint8Array(U);if(m===x*4)P.symbols.RtlMoveMemory(T(k),M,BigInt(U));else for(let d=0;d<f;d++){let v=M+BigInt(d*m),I=T(k)+d*x*4;P.symbols.RtlMoveMemory(I,v,BigInt(x*4))}return new w({path:t,width:x,height:f,buffer:k})}finally{R.symbols.GdipBitmapUnlockBits(s,T(b))}}finally{R.symbols.GdipDisposeImage(s)}}catch(n){return console.error(`GDI+ Load Image Error: ${n}`),null}}function wr(t){let n=new Uint8Array(16),e=new DataView(n.buffer);switch(t){case"png":e.setUint32(0,1434252294,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"jpg":e.setUint32(0,1434252289,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"jpeg":e.setUint32(0,1434252289,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"bmp":e.setUint32(0,1434252288,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"webp":e.setUint32(0,1434252290,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"gif":e.setUint32(0,1434252291,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"tiff":e.setUint32(0,1434252292,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"ico":e.setUint32(0,1434252293,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"heic":e.setUint32(0,1434252294,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"heif":e.setUint32(0,1434252295,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"avif":e.setUint32(0,1434252296,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"svg":e.setUint32(0,1434252297,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"raw":e.setUint32(0,1434252298,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;default:throw Error(`Unsupported format: ${t}`)}return n}async function jt(t,n){try{Wn();let{width:e,height:a,buffer:s}=t,u=e*4,o=2498570,x=new BigUint64Array(1),f=R.symbols.GdipCreateBitmapFromScan0(e,a,u,o,T(s),T(x));if(f!==0)return console.error(`GDI+ Create Bitmap From Scan0 failed: ${f}`),!1;let i=x[0];try{let E=n||t?.path||`screen_${Date.now()}.png`;if(!$n(E))return console.error(`Invalid path: "${E}" required file extension: ${Object.keys(Wt).join(", ")}`),!1;let b=wr($n(E).replace(".","")),_=Buffer.from(E+"\x00","utf16le"),p=R.symbols.GdipSaveImageToFile(i,T(_),T(b),null);if(p!==0)return console.error(`GDI+ Save Image To File failed: ${p}`),!1;return!0}finally{R.symbols.GdipDisposeImage(i)}}catch(e){return console.error(`GDI+ Save Image Error: ${e}`),!1}}function jn(t){let n=(e)=>e.toString(16).padStart(2,"0");return`#${n(t.r)}${n(t.g)}${n(t.b)}`.toUpperCase()}function qn(t){let n=t.replace("#","");return{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16)}}function qt(t,n){return Math.sqrt(Math.pow(t.r-n.r,2)+Math.pow(t.g-n.g,2)+Math.pow(t.b-n.b,2))}function Qn(t,n,e){return qt(t,n)<=e}function Zn(t,n){return t.x>=n.left&&t.x<=n.right&&t.y>=n.top&&t.y<=n.bottom}function Jn(t,n,e){t/=255,n/=255,e/=255;let a=Math.max(t,n,e),s=Math.min(t,n,e),u=a-s,o=0;if(u!==0){if(a===t)o=(n-e)/u%6;else if(a===n)o=(e-t)/u+2;else o=(t-n)/u+4;if(o*=60,o<0)o+=360}let x=a===0?0:u/a;return[o,x,a]}function zn(t,n,e){let a=e*n,s=a*(1-Math.abs(t/60%2-1)),u=e-a,o=0,x=0,f=0;if(t<60)o=a,x=s,f=0;else if(t<120)o=s,x=a,f=0;else if(t<180)o=0,x=a,f=s;else if(t<240)o=0,x=s,f=a;else if(t<300)o=s,x=0,f=a;else o=a,x=0,f=s;return[Math.round((o+u)*255),Math.round((x+u)*255),Math.round((f+u)*255)]}class te{rgbToHex=jn;hexToRgb=qn;rgbToHsv=Jn;hsvToRgb=zn;colorDistance=qt;isColorSimilar=Qn;pointInRect=Zn}var C=new te;function ne(t){return{path:t.path,width:t.width,height:t.height,buffer:new Uint8Array(t.buffer)}}function et(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4){let x=s[o],f=s[o+1],i=s[o+2],E=s[o+3],b=0.2126*i+0.7152*f+0.0722*x,_=Math.min(255,Math.max(0,b));u[o]=_,u[o+1]=_,u[o+2]=_,u[o+3]=E}return{path:n,width:e,height:a,buffer:u}}function ee(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length),x=n*255;for(let f=0;f<u.length;f+=4){for(let i=0;i<3;i++)o[f+i]=Math.min(255,Math.max(0,u[f+i]+x));o[f+3]=u[f+3]}return{path:e,width:a,height:s,buffer:o}}function re(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let x=0;x<u.length;x+=4){for(let f=0;f<3;f++){let i=u[x+f],E=n*(i-128)+128;o[x+f]=Math.min(255,Math.max(0,E))}o[x+3]=u[x+3]}return{path:e,width:a,height:s,buffer:o}}function Qt(t,n,e){let{path:a,width:s,height:u,buffer:o}=t,x=new Uint8Array(o.length),f=Math.floor(e/2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0,p=0;for(let m=0;m<e;m++)for(let U=0;U<e;U++){let k=Math.min(s-1,Math.max(0,E+U-f)),v=(Math.min(u-1,Math.max(0,i+m-f))*s+k)*4,I=n[m*e+U];p+=o[v]*I,_+=o[v+1]*I,b+=o[v+2]*I}let M=(i*s+E)*4;x[M]=Math.min(255,Math.max(0,p)),x[M+1]=Math.min(255,Math.max(0,_)),x[M+2]=Math.min(255,Math.max(0,b)),x[M+3]=o[M+3]}return{path:a,width:s,height:u,buffer:x}}function se(t,n=1){if(n===1)return Qt(t,[0.0625,0.125,0.0625,0.125,0.25,0.125,0.0625,0.125,0.0625],3);let e=[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,16,26,16,4,1,4,7,4,1].map((a)=>a/273);return Qt(t,e,5)}function oe(t){return Qt(t,[0,-1,0,-1,5,-1,0,-1,0],3)}function ae(t){let n=et(t),{path:e,width:a,height:s,buffer:u}=n,o=new Uint8Array(u.length),x=[-1,0,1,-2,0,2,-1,0,1],f=[-1,-2,-1,0,0,0,1,2,1];for(let i=1;i<s-1;i++)for(let E=1;E<a-1;E++){let b=0,_=0;for(let U=-1;U<=1;U++)for(let k=-1;k<=1;k++){let d=((i+U)*a+(E+k))*4,v=u[d+1];b+=v*x[(U+1)*3+(k+1)],_+=v*f[(U+1)*3+(k+1)]}let p=Math.sqrt(b*b+_*_),M=Math.min(255,Math.max(0,p)),m=(i*a+E)*4;o[m]=M,o[m+1]=M,o[m+2]=M,o[m+3]=255}return{path:e,width:a,height:s,buffer:o}}function pt(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let x=3;x<u.length;x+=4)o[x]=u[x];for(let x=0;x<s;x++)for(let f=0;f<a;f++){let i=0,E=0,b=0;for(let p=-n;p<=n;p++)for(let M=-n;M<=n;M++){let m=x+p,U=f+M;if(m>=0&&m<s&&U>=0&&U<a){let k=(m*a+U)*4;b=Math.max(b,u[k]),E=Math.max(E,u[k+1]),i=Math.max(i,u[k+2])}}let _=(x*a+f)*4;o[_]=b,o[_+1]=E,o[_+2]=i}return{path:e,width:a,height:s,buffer:o}}function mt(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let x=3;x<u.length;x+=4)o[x]=u[x];for(let x=0;x<s;x++)for(let f=0;f<a;f++){let i=255,E=255,b=255;for(let p=-n;p<=n;p++)for(let M=-n;M<=n;M++){let m=x+p,U=f+M;if(m>=0&&m<s&&U>=0&&U<a){let k=(m*a+U)*4;b=Math.min(b,u[k]),E=Math.min(E,u[k+1]),i=Math.min(i,u[k+2])}}let _=(x*a+f)*4;o[_]=b,o[_+1]=E,o[_+2]=i}return{path:e,width:a,height:s,buffer:o}}function ue(t,n=1){return pt(mt(t,n),n)}function ce(t,n=1){return mt(pt(t,n),n)}function xe(t){let{buffer:n}=t,e=[];for(let a=0;a<n.length;a+=4)e.push([n[a+2],n[a+1],n[a],n[a+3]]);return e}function fe(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4)u[o]=255-s[o],u[o+1]=255-s[o+1],u[o+2]=255-s[o+2],u[o+3]=s[o+3];return{path:n,width:e,height:a,buffer:u}}function ie(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4){let x=s[o],f=s[o+1],i=s[o+2];u[o]=Math.min(255,i*0.272+f*0.534+x*0.131),u[o+1]=Math.min(255,i*0.349+f*0.686+x*0.168),u[o+2]=Math.min(255,i*0.393+f*0.769+x*0.189),u[o+3]=s[o+3]}return{path:n,width:e,height:a,buffer:u}}function Ee(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let x=0;x<u.length;x+=4){let f=u[x],i=u[x+1],E=u[x+2],[b,_,p]=C.rgbToHsv(E,i,f),M=(b+n)%360,[m,U,k]=C.hsvToRgb(M<0?M+360:M,_,p);o[x]=k,o[x+1]=U,o[x+2]=m,o[x+3]=u[x+3]}return{path:e,width:a,height:s,buffer:o}}function pe(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let x=0;x<u.length;x+=4){let f=u[x],i=u[x+1],E=u[x+2],[b,_,p]=C.rgbToHsv(E,i,f),M=Math.min(1,Math.max(0,_*n)),[m,U,k]=C.hsvToRgb(b,M,p);o[x]=k,o[x+1]=U,o[x+2]=m,o[x+3]=u[x+3]}return{path:e,width:a,height:s,buffer:o}}function me(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=n*Math.PI/180,x=Math.cos(o),f=Math.sin(o),i=Math.ceil(Math.abs(a*x)+Math.abs(s*f)),E=Math.ceil(Math.abs(a*f)+Math.abs(s*x)),b=new Uint8Array(i*E*4),_=a/2,p=s/2,M=i/2,m=E/2;for(let U=0;U<E;U++)for(let k=0;k<i;k++){let d=(k-M)*x+(U-m)*f+_,v=-(k-M)*f+(U-m)*x+p;if(d>=0&&d<a&&v>=0&&v<s){let I=(Math.floor(v)*a+Math.floor(d))*4,A=(U*i+k)*4;b[A]=u[I],b[A+1]=u[I+1],b[A+2]=u[I+2],b[A+3]=u[I+3]}}return{path:e,width:i,height:E,buffer:b}}function le(t,n=!1,e=!1){let{path:a,width:s,height:u,buffer:o}=t,x=new Uint8Array(o.length);for(let f=0;f<u;f++)for(let i=0;i<s;i++){let E=n?s-1-i:i,_=((e?u-1-f:f)*s+E)*4,p=(f*s+i)*4;x[p]=o[_],x[p+1]=o[_+1],x[p+2]=o[_+2],x[p+3]=o[_+3]}return{path:a,width:s,height:u,buffer:x}}function be(t,n,e,a,s){let{path:u,width:o,height:x,buffer:f}=t,i=Math.max(0,Math.min(o,n)),E=Math.max(0,Math.min(x,e)),b=Math.max(0,Math.min(o,n+a)),_=Math.max(0,Math.min(x,e+s)),p=b-i,M=_-E,m=new Uint8Array(p*M*4);for(let U=0;U<M;U++)for(let k=0;k<p;k++){let d=((E+U)*o+(i+k))*4,v=(U*p+k)*4;m[v]=f[d],m[v+1]=f[d+1],m[v+2]=f[d+2],m[v+3]=f[d+3]}return{path:u,width:p,height:M,buffer:m}}function Me(t,n,e,a="bilinear"){let{path:s,width:u,height:o,buffer:x}=t,f=new Uint8Array(n*e*4);if(a==="nearest"){let i=u/n,E=o/e;for(let b=0;b<e;b++)for(let _=0;_<n;_++){let p=Math.floor(_*i),m=(Math.floor(b*E)*u+p)*4,U=(b*n+_)*4;f[U]=x[m],f[U+1]=x[m+1],f[U+2]=x[m+2],f[U+3]=x[m+3]}}else{let i=(u-1)/n,E=(o-1)/e;for(let b=0;b<e;b++)for(let _=0;_<n;_++){let p=_*i,M=b*E,m=Math.floor(p),U=Math.floor(M),k=Math.min(u-1,m+1),d=Math.min(o-1,U+1),v=p-m,I=M-U;for(let A=0;A<4;A++){let N=x[(U*u+m)*4+A],K=x[(U*u+k)*4+A],g=x[(d*u+m)*4+A],h=x[(d*u+k)*4+A],W=N*(1-v)*(1-I)+K*v*(1-I)+g*(1-v)*I+h*v*I;f[(b*n+_)*4+A]=Math.round(W)}}}return{path:s,width:n,height:e,buffer:f}}function _e(t,n=128){let e=et(t),{path:a,width:s,height:u,buffer:o}=e,x=new Uint8Array(o.length);for(let f=0;f<o.length;f+=4){let i=o[f+1]>=n?255:0;x[f]=i,x[f+1]=i,x[f+2]=i,x[f+3]=o[f+3]}return{path:a,width:s,height:u,buffer:x}}function Ue(t,n=11){let e=et(t),{path:a,width:s,height:u,buffer:o}=e,x=new Uint8Array(o.length),f=Math.floor(n/2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0;for(let U=-f;U<=f;U++)for(let k=-f;k<=f;k++){let d=Math.min(s-1,Math.max(0,E+k)),v=Math.min(u-1,Math.max(0,i+U));b+=o[(v*s+d)*4+1],_++}let p=b/_,M=(i*s+E)*4,m=o[M+1]>=p?255:0;x[M]=m,x[M+1]=m,x[M+2]=m,x[M+3]=o[M+3]}return{path:a,width:s,height:u,buffer:x}}function ke(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length),x=n*2+1;for(let f=0;f<s;f++)for(let i=0;i<a;i++){let E=[[],[],[]];for(let p=-n;p<=n;p++)for(let M=-n;M<=n;M++){let m=Math.min(a-1,Math.max(0,i+M)),k=(Math.min(s-1,Math.max(0,f+p))*a+m)*4;E[0].push(u[k]),E[1].push(u[k+1]),E[2].push(u[k+2])}for(let p=0;p<3;p++)E[p].sort((M,m)=>M-m);let b=Math.floor(x*x/2),_=(f*a+i)*4;o[_]=E[0][b],o[_+1]=E[1][b],o[_+2]=E[2][b],o[_+3]=u[_+3]}return{path:e,width:a,height:s,buffer:o}}function ve(t,n=3,e=50){let{path:a,width:s,height:u,buffer:o}=t,x=new Uint8Array(o.length),f=Math.ceil(n*2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0,p=0,M=0,m=(i*s+E)*4,U=o[m],k=o[m+1],d=o[m+2];for(let v=-f;v<=f;v++)for(let I=-f;I<=f;I++){let A=Math.min(s-1,Math.max(0,E+I)),K=(Math.min(u-1,Math.max(0,i+v))*s+A)*4,g=I*I+v*v,h=Math.pow(o[K]-U,2)+Math.pow(o[K+1]-k,2)+Math.pow(o[K+2]-d,2),W=Math.exp(-g/(2*n*n)-h/(2*e*e));b+=o[K]*W,_+=o[K+1]*W,p+=o[K+2]*W,M+=W}x[m]=Math.round(b/M),x[m+1]=Math.round(_/M),x[m+2]=Math.round(p/M),x[m+3]=o[m+3]}return{path:a,width:s,height:u,buffer:x}}function Ie(t){let{buffer:n}=t,e=Array(256).fill(0),a=Array(256).fill(0),s=Array(256).fill(0);for(let u=0;u<n.length;u+=4)s[n[u]]++,a[n[u+1]]++,e[n[u+2]]++;return{r:e,g:a,b:s}}function de(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length),o=255,x=0,f=255,i=0,E=255,b=0;for(let m=0;m<s.length;m+=4)E=Math.min(E,s[m]),b=Math.max(b,s[m]),f=Math.min(f,s[m+1]),i=Math.max(i,s[m+1]),o=Math.min(o,s[m+2]),x=Math.max(x,s[m+2]);let _=b-E||1,p=i-f||1,M=x-o||1;for(let m=0;m<s.length;m+=4)u[m]=(s[m]-E)*255/_,u[m+1]=(s[m+1]-f)*255/p,u[m+2]=(s[m+2]-o)*255/M,u[m+3]=s[m+3];return{path:n,width:e,height:a,buffer:u}}function Ae(t,n,e=0,a=0,s=1){let{path:u,width:o,height:x,buffer:f}=t,i=new Uint8Array(f);for(let E=0;E<n.height;E++)for(let b=0;b<n.width;b++){let _=e+b,p=a+E;if(_>=0&&_<o&&p>=0&&p<x){let M=(E*n.width+b)*4,m=(p*o+_)*4,U=n.buffer[M+3]/255*s;for(let k=0;k<3;k++)i[m+k]=Math.round(n.buffer[M+k]*U+i[m+k]*(1-U))}}return{path:u,width:o,height:x,buffer:i}}function Oe(t,n,e="multiply"){let{path:a,width:s,height:u,buffer:o}=t,x=new Uint8Array(o.length),f=Math.min(s,n.width),i=Math.min(u,n.height);for(let E=0;E<i;E++)for(let b=0;b<f;b++){let _=(E*s+b)*4,p=(E*n.width+b)*4;for(let M=0;M<3;M++){let m=o[_+M]/255,U=n.buffer[p+M]/255,k=0;switch(e){case"multiply":k=m*U;break;case"screen":k=1-(1-m)*(1-U);break;case"overlay":k=m<0.5?2*m*U:1-2*(1-m)*(1-U);break;case"add":k=Math.min(1,m+U);break;case"subtract":k=Math.max(0,m-U);break}x[_+M]=Math.round(k*255)}x[_+3]=o[_+3]}for(let E=i*s*4;E<o.length;E++)x[E]=o[E];return{path:a,width:s,height:u,buffer:x}}class w{img;path;width;height;buffer;constructor(t){this.img=t;this.path=t.path,this.width=t.width,this.height=t.height,this.buffer=t.buffer}sync(){this.path=this.img.path,this.width=this.img.width,this.height=this.img.height,this.buffer=this.img.buffer}clone(){return new w(ne(this.img))}grayscale(){return this.img=et(this.img),this.sync(),this}brightness(t){return this.img=ee(this.img,t),this.sync(),this}contrast(t){return this.img=re(this.img,t),this.sync(),this}blur(t=1){return this.img=se(this.img,t),this.sync(),this}sharpen(){return this.img=oe(this.img),this.sync(),this}edges(){return this.img=ae(this.img),this.sync(),this}dilate(t=1){return this.img=pt(this.img,t),this.sync(),this}erode(t=1){return this.img=mt(this.img,t),this.sync(),this}erode2dilate(t=1){return this.img=ue(this.img,t),this.sync(),this}dilate2erode(t=1){return this.img=ce(this.img,t),this.sync(),this}async save(t){return jt(this,t)}toPixels(){return xe(this.img)}invert(){return this.img=fe(this.img),this.sync(),this}sepia(){return this.img=ie(this.img),this.sync(),this}hue(t){return this.img=Ee(this.img,t),this.sync(),this}saturate(t){return this.img=pe(this.img,t),this.sync(),this}rotate(t){return this.img=me(this.img,t),this.sync(),this}flip(t=!1,n=!1){return this.img=le(this.img,t,n),this.sync(),this}crop(t,n,e,a){return this.img=be(this.img,t,n,e,a),this.sync(),this}resize(t,n,e="bilinear"){return this.img=Me(this.img,t,n,e),this.sync(),this}threshold(t=128){return this.img=_e(this.img,t),this.sync(),this}adaptiveThreshold(t=11){return this.img=Ue(this.img,t),this.sync(),this}medianFilter(t=1){return this.img=ke(this.img,t),this.sync(),this}bilateralFilter(t=3,n=50){return this.img=ve(this.img,t,n),this.sync(),this}histogram(){return Ie(this.img)}autoLevel(){return this.img=de(this.img),this.sync(),this}overlay(t,n=0,e=0,a=1){return this.img=Ae(this.img,t,n,e,a),this.sync(),this}blend(t,n="multiply"){return this.img=Oe(this.img,t,n),this.sync(),this}}class De{load=Et;save=jt;process(t){if(t instanceof w)return t;return new w(t)}}var Mo=new De;import{ptr as O,JSCallback as Jt}from"bun:ffi";import{ptr as Zt,JSCallback as Wr}from"bun:ffi";var q=null,Ne=0;function jr(){if(q&&Date.now()-Ne<1000)return q;if(q)l.symbols.ReleaseDC(null,q);return q=l.symbols.GetDC(null),Ne=Date.now(),q}function Q(){return{width:l.symbols.GetSystemMetrics(0),height:l.symbols.GetSystemMetrics(1)}}function rt(t,n){let e=jr();if(!e)return null;let a=D.symbols.GetPixel(e,t,n);return{r:a&255,g:a>>8&255,b:a>>16&255}}function Ke(t,n){let e=rt(t,n);if(!e)return null;return C.rgbToHex(e)}function st(t,n,e,a=0){let s=rt(t,n);if(!s)return!1;return C.isColorSimilar(s,e,a)}function Te(t,n,e,a=0,s){return new Promise((u)=>{let o=0,x=setInterval(()=>{if(st(t,n,e,a)){clearInterval(x),u(!0);return}if(s&&(o+=50)>=s)clearInterval(x),u(!1)},50)})}function ge(t){return t.map((n)=>rt(n.x,n.y))}function ye(t){return t.every((n)=>st(n.x,n.y,n.target,n.tolerance??0))}function Re(t,n){return new Promise((e)=>{let a=0,s=setInterval(()=>{for(let u=0;u<t.length;u++){let o=t[u];if(st(o.x,o.y,o.target,o.tolerance??0)){clearInterval(s),e(u);return}}if(n&&(a+=50)>=n)clearInterval(s),e(-1)},50)})}function Se(t,n,e,a,s,u=0){let o=Math.min(t,e),x=Math.min(n,a),f=Math.max(t,e),i=Math.max(n,a),E=f-o+1,b=i-x+1,_=lt(o,x,E,b);if(!_)return null;let p;if(typeof s==="string")p=C.hexToRgb(s);else if(typeof s==="number")p={r:s>>16&255,g:s>>8&255,b:s&255};else p=s;for(let M=0;M<b;M++)for(let m=0;m<E;m++){let U=(M*E+m)*4,k=_.buffer[U],d=_.buffer[U+1],v=_.buffer[U+2];if(u===0){if(v===p.r&&d===p.g&&k===p.b)return{x:o+m,y:x+M}}else if(Math.abs(v-p.r)<=u&&Math.abs(d-p.g)<=u&&Math.abs(k-p.b)<=u)return{x:o+m,y:x+M}}return null}async function Pe(t,n,e,a,s,u=0){let o;if(typeof s==="string"){let v=await Et(s);if(!v)return null;o=v}else o=s;let x=Math.min(t,e),f=Math.min(n,a),i=Math.max(t,e),E=Math.max(n,a),b=i-x+1,_=E-f+1,p=lt(x,f,b,_);if(!p)return null;let{width:M,height:m}=o,U=b,k=_;if(M>U||m>k)return null;let d=(v,I,A,N,K,g)=>{if(u===0)return v===N&&I===K&&A===g;return Math.abs(v-N)<=u&&Math.abs(I-K)<=u&&Math.abs(A-g)<=u};for(let v=0;v<=k-m;v++)for(let I=0;I<=U-M;I++){let A=(v*U+I)*4,N=0;if(!d(p.buffer[A+2],p.buffer[A+1],p.buffer[A],o.buffer[N+2],o.buffer[N+1],o.buffer[N]))continue;let K=!0;for(let g=0;g<m;g++){for(let h=0;h<M;h++){if(g===0&&h===0)continue;if(A=((v+g)*U+(I+h))*4,N=(g*M+h)*4,!d(p.buffer[A+2],p.buffer[A+1],p.buffer[A],o.buffer[N+2],o.buffer[N+1],o.buffer[N])){K=!1;break}}if(!K)break}if(K)return{x:x+I,y:f+v}}return null}function lt(t=0,n=0,e,a){let s=e||l.symbols.GetSystemMetrics(0),u=a||l.symbols.GetSystemMetrics(1),o=l.symbols.GetDC(null);if(!o)return null;let x=D.symbols.CreateCompatibleDC(o);if(!x)return l.symbols.ReleaseDC(null,o),null;let f=D.symbols.CreateCompatibleBitmap(o,s,u);if(!f)return l.symbols.ReleaseDC(null,o),D.symbols.DeleteDC(x),null;let i=D.symbols.SelectObject(x,f),E=D.symbols.BitBlt(x,0,0,s,u,o,t,n,13369376),b=null;if(E){let _=s*u*4;b=new Uint8Array(_);let p=new Uint8Array(40),M=new DataView(p.buffer);if(M.setInt32(0,40,!0),M.setInt32(4,s,!0),M.setInt32(8,-u,!0),M.setInt16(12,1,!0),M.setInt16(14,32,!0),M.setInt32(16,0,!0),D.symbols.GetDIBits(x,f,0,u,Zt(b),Zt(p),0)===0)b=null}if(i)D.symbols.SelectObject(x,i);if(D.symbols.DeleteObject(f),D.symbols.DeleteDC(x),l.symbols.ReleaseDC(null,o),!b)return null;return new w({width:s,height:u,buffer:b})}function Be(){let t=[],n=1,e=32,a=new Wr((s,u,o,x)=>{let i=new Uint8Array(104),E=new DataView(i.buffer);if(E.setUint32(0,104,!0),l.symbols.GetMonitorInfoW(s,Zt(i))){let b=E.getInt32(4,!0),_=E.getInt32(8,!0),p=E.getInt32(12,!0),M=E.getInt32(16,!0),m=E.getInt32(20,!0),U=E.getInt32(24,!0),k=E.getInt32(28,!0),d=E.getInt32(32,!0),I=(E.getUint32(36,!0)&1)!==0,A=i.slice(40,104),N=new TextDecoder("utf-16le").decode(A).replace(/\0.*$/,"");t.push({handle:s,rect:{left:b,top:_,right:p,bottom:M},workArea:{left:m,top:U,right:k,bottom:d},isPrimary:I,deviceName:N})}return!0},{args:["ptr","ptr","ptr","ptr"],returns:"bool"});return l.symbols.EnumDisplayMonitors(null,null,a.ptr,0),a.close(),t}var Fe=6,Qr=1,Zr=0,Jr=1,zr=4,ts=256,ns=4096,es=3,rs=9,ss=0,os=5,as=16,zt=-16,bt=-20,us=524288;var cs=2,xs=-1,fs=-2,tn=2,nn=1;var _t=new TextDecoder("utf-16le"),he=new TextDecoder("ascii");function ot(){let t=l.symbols.GetForegroundWindow();if(!t)return null;let n=new Uint16Array(256),e=l.symbols.GetWindowTextW(t,O(n),256),a=e>0?_t.decode(n.subarray(0,e)):"",s=new Int32Array(4);if(!l.symbols.GetWindowRect(t,O(s)))return null;let u={left:s[0],top:s[1],right:s[2],bottom:s[3]},o=Q(),x=u.left===0&&u.top===0&&u.right-u.left===o.width&&u.bottom-u.top===o.height&&(l.symbols.GetWindowLongW(t,-16)&12845056)===0;return{hwnd:t,title:a,rect:u,isFullscreen:x}}function Mt(t){let n=t!==void 0?BigInt(t):l.symbols.GetForegroundWindow();if(!n)return"";let e=new Uint16Array(256),a=l.symbols.GetWindowTextW(n,O(e),256);return a>0?_t.decode(e.subarray(0,a)):""}function Ut(t){let n=new Int32Array(4);if(!l.symbols.GetWindowRect(BigInt(t),O(n)))return null;return{left:n[0],top:n[1],right:n[2],bottom:n[3]}}function Ye(t){return l.symbols.IsWindowVisible(BigInt(t))}function kt(t){return l.symbols.SetForegroundWindow(BigInt(t))}function en(t){let n=new TextEncoder().encode(t+"\x00"),e=l.symbols.FindWindowA(null,O(n));return e?e:null}function Le(t,n){return new Promise((e)=>{let a=0,s=setInterval(()=>{let u=en(t);if(u){clearInterval(s),e(u);return}if(n&&(a+=100)>=n)clearInterval(s),e(null)},100)})}function vt(t){let n=new Uint32Array(1);return l.symbols.GetWindowThreadProcessId(BigInt(t),O(n)),n[0]}function Ce(t){let n=new Uint8Array(256),e=l.symbols.GetClassNameA(BigInt(t),O(n),256);return e>0?he.decode(n.subarray(0,e)):""}function rn(t){return l.symbols.IsIconic(BigInt(t))}function Ge(t){return l.symbols.IsZoomed(BigInt(t))}function Ve(t){return l.symbols.ShowWindow(BigInt(t),Fe)}function we(t){return l.symbols.ShowWindow(BigInt(t),es)}function sn(t){return l.symbols.ShowWindow(BigInt(t),rs)}function Xe(t){return l.symbols.ShowWindow(BigInt(t),os)}function $e(t){return l.symbols.ShowWindow(BigInt(t),ss)}function He(t){return l.symbols.PostMessageA(BigInt(t),as,null,null)}function on(t,n,e,a,s,u=!0){return l.symbols.MoveWindow(BigInt(t),n,e,a,s,u)}function We(t){let n=Ut(t);if(!n)return!1;let e=n.right-n.left,a=n.bottom-n.top,s=Q(),u=Math.floor((s.width-e)/2),o=Math.floor((s.height-a)/2);return on(t,u,o,e,a,!0)}function an(t){let n=new Int32Array(4);if(!l.symbols.GetClientRect(BigInt(t),O(n)))return null;return{left:n[0],top:n[1],right:n[2],bottom:n[3]}}function je(t){let n=Ut(t);if(!n)return null;return{width:n.right-n.left,height:n.bottom-n.top}}function qe(t){let n=an(t);if(!n)return null;return{width:n.right-n.left,height:n.bottom-n.top}}function It(t){return l.symbols.IsWindow(BigInt(t))}function un(t){if(!It(t))return null;let n=BigInt(t),e=new Uint16Array(256),a=l.symbols.GetWindowTextW(n,O(e),256),s=a>0?_t.decode(e.subarray(0,a)):"",u=new Int32Array(4);if(!l.symbols.GetWindowRect(n,O(u)))return null;let o={left:u[0],top:u[1],right:u[2],bottom:u[3]},x=Q(),f=o.left===0&&o.top===0&&o.right-o.left===x.width&&o.bottom-o.top===x.height&&(l.symbols.GetWindowLongW(n,zt)&12845056)===0,i=new Uint32Array(1);l.symbols.GetWindowThreadProcessId(n,O(i));let E=new Uint8Array(256),b=l.symbols.GetClassNameA(n,O(E),256),_=b>0?he.decode(E.subarray(0,b)):"";return{hwnd:n,title:s,rect:o,isFullscreen:f,processId:i[0],isVisible:l.symbols.IsWindowVisible(n),isMinimized:l.symbols.IsIconic(n),isMaximized:l.symbols.IsZoomed(n),className:_}}function Qe(t,n){return new Promise((e)=>{let a=0,s=setInterval(()=>{if(!It(t)){clearInterval(s),e(!0);return}if(n&&(a+=100)>=n)clearInterval(s),e(!1)},100)})}async function Ze(t,n=1000){kt(t);let e=0;while(e<n){let a=ot();if(a&&a.hwnd===BigInt(t))return!0;await Bun.sleep(50),e+=50}return!1}function Je(){let t=[],n=new Jt((e,a)=>{let s=un(e);if(s&&s.isVisible&&s.title)t.push(s);return!0},{args:["u64","i64"],returns:"bool"});return l.symbols.EnumWindows(n.ptr,0),n.close(),t}function cn(t){let n=[],e=new Jt((a,s)=>{return n.push(a),!0},{args:["u64","i64"],returns:"bool"});return l.symbols.EnumChildWindows(BigInt(t),e.ptr,0),e.close(),n}function ze(t,n=!0){return l.symbols.FlashWindow(BigInt(t),n)}function tr(t,n){let e=BigInt(t),a=l.symbols.GetWindowLongW(e,bt);l.symbols.SetWindowLongW(e,bt,a|us);let s=Math.max(0,Math.min(255,Math.floor(n*255)));return l.symbols.SetLayeredWindowAttributes(e,0,s,cs)}function nr(t,n){return l.symbols.SetWindowPos(BigInt(t),BigInt(n?xs:fs),0,0,0,0,tn|nn)}function er(t,n){let e=new Uint16Array(n.length+1),a=new TextEncoder().encodeInto(n,new Uint8Array(e.buffer)),s=Buffer.from(n+"\x00","utf16le");return l.symbols.SetWindowTextW(BigInt(t),O(s))}function rr(t,n){return l.symbols.EnableWindow(BigInt(t),n)}function sr(t){return l.symbols.RedrawWindow(BigInt(t),null,0n,Jr|zr|ts)}function or(t){return l.symbols.SetWindowPos(BigInt(t),BigInt(Qr),0,0,0,0,tn|nn)}function ar(t){return l.symbols.SetWindowPos(BigInt(t),BigInt(Zr),0,0,0,0,tn|nn)}function xn(t){let n=vt(t);if(!n)return"";let e=P.symbols.OpenProcess(ns,!1,n);if(!e)return"";try{let a=new Uint16Array(1024),s=new Uint32Array([1024]);if(P.symbols.QueryFullProcessImageNameW(e,0,O(a),O(s)))return _t.decode(a.subarray(0,s[0]));return""}finally{P.symbols.CloseHandle(e)}}function ur(t,n,e){let a=new Int32Array([n,e]);if(l.symbols.ClientToScreen(BigInt(t),O(a)))return{x:a[0],y:a[1]};return null}function cr(t,n,e){let a=new Int32Array([n,e]);if(l.symbols.ScreenToClient(BigInt(t),O(a)))return{x:a[0],y:a[1]};return null}function xr(t){let n=BigInt(t);if(rn(n))sn(n);return kt(n)}async function fr(t,n){let e=BigInt(t);return new Promise((a)=>{let s=0,u=setInterval(()=>{let o=ot();if(o&&o.hwnd===e){clearInterval(u),a(!0);return}if(n&&(s+=100)>=n)clearInterval(u),a(!1)},100)})}async function ir(t,n){let e=BigInt(t);return new Promise((a)=>{let s=0,u=setInterval(()=>{let o=ot();if(!o||o.hwnd!==e){clearInterval(u),a(!0);return}if(n&&(s+=100)>=n)clearInterval(u),a(!1)},100)})}function Er(t){let n=BigInt(t),e=vt(n);if(!e)return!1;let a=1,s=P.symbols.OpenProcess(a,!1,e);if(!s)return!1;try{return P.symbols.TerminateProcess(s,1)}finally{P.symbols.CloseHandle(s)}}var is={WS_OVERLAPPED:0,WS_POPUP:2147483648,WS_CHILD:1073741824,WS_MINIMIZE:536870912,WS_VISIBLE:268435456,WS_DISABLED:134217728,WS_CLIPSIBLINGS:67108864,WS_CLIPCHILDREN:33554432,WS_MAXIMIZE:16777216,WS_CAPTION:12582912,WS_BORDER:8388608,WS_DLGFRAME:4194304,WS_VSCROLL:2097152,WS_HSCROLL:1048576,WS_SYSMENU:524288,WS_THICKFRAME:262144,WS_GROUP:131072,WS_TABSTOP:65536,WS_MINIMIZEBOX:131072,WS_MAXIMIZEBOX:65536};function pr(t){return l.symbols.GetWindowLongW(BigInt(t),zt)}function mr(t,n){return l.symbols.SetWindowLongW(BigInt(t),zt,is[n])}var Es={WS_EX_DLGMODALFRAME:1,WS_EX_NOPARENTNOTIFY:4,WS_EX_TOPMOST:8,WS_EX_ACCEPTFILES:16,WS_EX_TRANSPARENT:32,WS_EX_MDICHILD:64,WS_EX_TOOLWINDOW:128,WS_EX_WINDOWEDGE:256,WS_EX_CLIENTEDGE:512,WS_EX_CONTEXTHELP:1024,WS_EX_RIGHT:4096,WS_EX_LEFT:0,WS_EX_RTLREADING:8192,WS_EX_LTRREADING:0,WS_EX_LEFTSCROLLBAR:16384,WS_EX_RIGHTSCROLLBAR:0,WS_EX_CONTROLPARENT:65536,WS_EX_STATICEDGE:131072,WS_EX_APPWINDOW:262144,WS_EX_LAYERED:524288,WS_EX_NOINHERITLAYOUT:1048576,WS_EX_NOREDIRECTIONBITMAP:2097152,WS_EX_LAYOUTRTL:4194304,WS_EX_COMPOSITED:33554432,WS_EX_NOACTIVATE:134217728};function lr(t){return l.symbols.GetWindowLongW(BigInt(t),bt)}function br(t,n){return l.symbols.SetWindowLongW(BigInt(t),bt,Es[n])}function Mr(t){let n=BigInt(t);if(l.symbols.IsIconic(n))return-1;if(l.symbols.IsZoomed(n))return 1;return 0}function dt(){let t=[],n=new Jt((e,a)=>{if(l.symbols.IsWindowVisible(e))t.push(e);return!0},{args:["u64","i64"],returns:"bool"});return l.symbols.EnumWindows(n.ptr,0),n.close(),t}function _r(){return dt().length}function Ur(){let t=dt();for(let n of t)l.symbols.ShowWindow(n,Fe)}function kr(t){let n=xn(t);if(!n)return"";let e=n.split("\\");return e[e.length-1]}function vr(t){let n=Mt(t),e=cn(t);for(let a of e){let s=Mt(a);if(s)n+=`\r
`+s}return n}function Ir(t,n,e,a,s,u=!0){let o=D.symbols.CreateRectRgn(n,e,n+a,e+s);if(!o)return!1;return l.symbols.SetWindowRgn(BigInt(t),o,u)!==0}function dr(t,n,e,a,s,u=!0){let o=D.symbols.CreateEllipticRgn(n,e,n+a,e+s);if(!o)return!1;return l.symbols.SetWindowRgn(BigInt(t),o,u)!==0}function Ar(t,n,e,a,s,u,o,x=!0){let f=D.symbols.CreateRoundRectRgn(n,e,n+a,e+s,u,o);if(!f)return!1;return l.symbols.SetWindowRgn(BigInt(t),f,x)!==0}function Or(t,n,e=1,a=!0){let s=new Int32Array(n.length*2);for(let o=0;o<n.length;o++)s[o*2]=n[o].x,s[o*2+1]=n[o].y;let u=D.symbols.CreatePolygonRgn(O(s),n.length,e);if(!u)return!1;return l.symbols.SetWindowRgn(BigInt(t),u,a)!==0}function Dr(t,n=!0){return l.symbols.SetWindowRgn(BigInt(t),0,n)!==0}class Nr{getActiveWindow=ot;getWindowTitle=Mt;getWindowRect=Ut;getClientRect=an;getWindowSize=je;getClientSize=qe;isWindowVisible=Ye;isWindowMinimized=rn;isWindowMaximized=Ge;isWindow=It;setForeground=kt;focusWindow=Ze;findWindow=en;waitForWindow=Le;waitForWindowClose=Qe;getWindowProcessId=vt;getClassName=Ce;getExtendedWindowInfo=un;minimizeWindow=Ve;maximizeWindow=we;restoreWindow=sn;showWindow=Xe;hideWindow=$e;closeWindow=He;moveWindow=on;enumWindows=Je;enumChildWindows=cn;flashWindow=ze;setOpacity=tr;setTopmost=nr;center=We;setTitle=er;setEnabled=rr;redraw=sr;moveToBottom=or;moveToTop=ar;getProcessPath=xn;clientToScreen=ur;screenToClient=cr;activate=xr;waitActive=fr;waitNotActive=ir;kill=Er;getStyle=pr;setStyle=mr;getExStyle=lr;setExStyle=br;getMinMax=Mr;getList=dt;getCount=_r;minimizeAll=Ur;getProcessName=kr;getText=vr;setRegion={rect:Ir,ellipse:dr,round:Ar,polygon:Or,reset:Dr}}var yo=new Nr;class Kr{getScreenSize=Q;getMonitors=Be;capture=lt;getPixel=rt;getPixelHex=Ke;checkPixel=st;waitForPixel=Te;getMultiplePixels=ge;checkMultiplePixels=ye;waitForAnyPixel=Re;pixelSearch=Se;imageSearch=Pe}var Bo=new Kr;export{yo as window,C as utils,Bo as screen,y as mouse,B as keyboard,Mo as image,At as config,c as VK_CODES,X as KEYBOARD_MAPPING,w as Image};
