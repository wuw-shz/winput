// @bun
var u={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]],PAUSE:!1,PAUSE_DELAY:10};import{ptr as te}from"bun:ffi";import{dlopen as xe,FFIType as f,suffix as ue}from"bun:ffi";var i=xe(`user32.${ue}`,{SendInput:{args:[f.u32,f.ptr,f.i32],returns:f.u32},MapVirtualKeyW:{args:[f.u32,f.u32],returns:f.u32},GetCursorPos:{args:[f.ptr],returns:f.bool},GetSystemMetrics:{args:[f.i32],returns:f.i32},GetKeyState:{args:[f.i32],returns:f.i16},GetAsyncKeyState:{args:[f.i32],returns:f.i16},SetWindowsHookExW:{args:[f.i32,f.ptr,f.ptr,f.u32],returns:f.ptr},UnhookWindowsHookEx:{args:[f.ptr],returns:f.bool},CallNextHookEx:{args:[f.ptr,f.i32,f.ptr,f.ptr],returns:f.ptr}});class d{buffer;view;constructor(e=0,o=0,s=0,t=0,n=0,r=0n){this.buffer=new ArrayBuffer(32),this.view=new DataView(this.buffer),this.view.setInt32(0,e,!0),this.view.setInt32(4,o,!0),this.view.setUint32(8,s,!0),this.view.setUint32(12,t,!0),this.view.setUint32(16,n,!0),this.view.setBigUint64(20,BigInt(r),!0)}}class I{buffer;view;constructor(e=0,o=0,s=0,t=0,n=0n){this.buffer=new ArrayBuffer(32),this.view=new DataView(this.buffer),this.view.setUint16(0,e,!0),this.view.setUint16(2,o,!0),this.view.setUint32(4,s,!0),this.view.setUint32(8,t,!0),this.view.setBigUint64(12,BigInt(n),!0)}}class p{buffer;view;constructor(e,o){this.buffer=new ArrayBuffer(40),this.view=new DataView(this.buffer),this.view.setUint32(0,e,!0);let s=new Uint8Array(o.buffer);new Uint8Array(this.buffer).set(s,8)}}class N extends Error{constructor(e){super(e);this.name="FailSafeException"}}import{ptr as Ee}from"bun:ffi";function l(){if(u.FAILSAFE){let e=w();for(let o of u.FAILSAFE_POINTS)if(e[0]===o[0]&&e[1]===o[1])throw new N("DirectInput fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function c(e){if(e&&u.PAUSE_DELAY>0)Bun.sleepSync(u.PAUSE_DELAY)}function Q(e=0,o=0){let[s,t]=pe(),n=Math.round(e*65535/(s-1)),r=Math.round(o*65535/(t-1)),E=Math.max(0,Math.min(65535,n)),a=Math.max(0,Math.min(65535,r));return[E,a]}function w(e,o){let s=new ArrayBuffer(8),t=new DataView(s);i.symbols.GetCursorPos(Ee(s));let n=t.getInt32(0,!0),r=t.getInt32(4,!0);return[e??n,o??r]}function pe(){let e=i.symbols.GetSystemMetrics(0),o=i.symbols.GetSystemMetrics(1);return[e,o]}var g=1,Z=32768,_=2,F=4;var V=8,P=16;var L=32,k=64;var B=128,C=256,R=1,G=2,Y=1,ee=2,X=8;var M=0;var S={escape:1,esc:1,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,printscreen:183,prntscrn:183,prtsc:183,prtscr:183,scrolllock:70,pause:197,"`":41,"1":2,"2":3,"3":4,"4":5,"5":6,"6":7,"7":8,"8":9,"9":10,"0":11,"-":12,"=":13,backspace:14,insert:1234,home:1223,pageup:1225,pagedown:1233,del:1235,delete:1235,end:1231,numlock:69,divide:1205,multiply:55,subtract:74,add:78,decimal:83,numpad0:82,numpad1:79,numpad2:80,numpad3:81,numpad4:75,numpad5:76,numpad6:77,numpad7:71,numpad8:72,numpad9:73,numpadenter:1180,tab:15,q:16,w:17,e:18,r:19,t:20,y:21,u:22,i:23,o:24,p:25,"[":26,"]":27,"\\":43,capslock:58,a:30,s:31,d:32,f:33,g:34,h:35,j:36,k:37,l:38,";":39,"'":40,enter:28,return:28,shift:42,shiftleft:42,z:44,x:45,c:46,v:47,b:48,n:49,m:50,",":51,".":52,"/":53,shiftright:54,ctrl:29,ctrlleft:29,win:1243,winleft:1243,alt:56,altleft:56," ":57,space:57,altright:1208,winright:1244,apps:1245,ctrlright:1181,up:i.symbols.MapVirtualKeyW(38,M),left:i.symbols.MapVirtualKeyW(37,M),down:i.symbols.MapVirtualKeyW(40,M),right:i.symbols.MapVirtualKeyW(39,M)},W=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]);function b(e,o=u.PAUSE){l();let s=X;if(["up","left","down","right"].includes(e))s|=Y;let t=S[e],n=new I(0,t,s,0),r=new p(1,n);if(i.symbols.SendInput(1,te(r.buffer),40),o)c(o);return A}function T(e,o=u.PAUSE){l();let s=X|ee;if(["up","left","down","right"].includes(e))s|=Y;let t=S[e],n=new I(0,t,s,0),r=new p(1,n);if(i.symbols.SendInput(1,te(r.buffer),40),o)c(o);return A}function K(e,o=u.PAUSE){if(l(),b(e,!1),T(e,!1),o)c(o);return A}function oe(e,o=0,s=u.PAUSE){for(let t of e){if(l(),t!==t.toLowerCase()){let n=t.toLowerCase();b("shift"),K(n),T("shift")}else if(W.has(t)){let n=W.get(t);b("shift"),K(n),T("shift")}else K(t);if(o>0)Bun.sleepSync(o)}if(s)c(s);return A}var se={};for(let[e,o]of Object.entries(S))se[o&4095]=e;var le=new Set([1,2,4,5,6]);class H{listeners=new Map;isRunning=!1;on(e,o){if(!this.listeners.has(e))this.listeners.set(e,new Set);this.listeners.get(e).add(o)}off(e,o){this.listeners.get(e)?.delete(o)}once(e,o){let s=(t)=>{o(t),this.off(e,s)};this.on(e,s)}listen(e){this.on("keydown",e),this.on("keyup",e)}_emit(e,o){this.listeners.get(e)?.forEach((s)=>{try{s(o)}catch(t){console.error(`Keyboard event error [${e}]:`,t)}})}async startListener(e=8){if(this.isRunning)return;this.isRunning=!0,console.log("Keyboard listener started.");let o=Array(256).fill(!1),s=Array.from({length:256},(t,n)=>n);while(this.isRunning){for(let t of s){if(le.has(t))continue;let n=i.symbols.GetAsyncKeyState(t),r=(n&32768)!==0,E=(n&1)!==0,a,m=i.symbols.MapVirtualKeyW(t,0);if(a=se[m],!a)if(t>=48&&t<=90)a=String.fromCharCode(t).toLowerCase();else if(t===13)a="enter";else if(t===16)a="shift";else if(t===17)a="ctrl";else if(t===18)a="alt";else if(t===9)a="tab";else if(t===20)a="capslock";else if(t===27)a="escape";else if(t===32)a="space";else if(t>=112&&t<=123)a=`f${t-111}`;else a=`vk_${t.toString(16).padStart(2,"0")}`;if(r!==o[t]){o[t]=r;let x={event:r?"down":"up",name:a,vk_code:t,isKeyDown:r};this._emit(r?"keydown":"keyup",x)}else if(!r&&E&&!o[t]){let x={event:"down",name:a,vk_code:t,isKeyDown:!0};this._emit("keydown",x),this._emit("keyup",{...x,event:"up",isKeyDown:!1})}}await Bun.sleep(e)}console.log("Keyboard listener stopped.")}stopListener(){this.isRunning=!1}}class ne{down=b;up=T;tap=K;write=oe;listener=new H}var A=new ne;import{ptr as v}from"bun:ffi";var y="left",U="right",D="middle",$="x1",j="x2";function re(e=y,o=u.PAUSE){let s,t=0;if(e===y)s=_;else if(e===D)s=L;else if(e===U)s=V;else if(e===$)s=B,t=R;else if(e===j)s=B,t=G;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);let n=new d(0,0,t,s,0),r=new p(0,n);if(i.symbols.SendInput(1,v(r.buffer),40),o)c(o);return h}function ie(e=y,o=u.PAUSE){let s,t=0;if(e===y)s=F;else if(e===D)s=k;else if(e===U)s=P;else if(e===$)s=C,t=R;else if(e===j)s=C,t=G;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);let n=new d(0,0,t,s,0),r=new p(0,n);if(i.symbols.SendInput(1,v(r.buffer),40),o)c(o);return h}function fe(e=y,o=1,s=0,t=u.PAUSE){if([y,D,U].includes(e)){let n=0,r=0;if(e===y)n=_,r=F;else if(e===D)n=L,r=k;else n=V,r=P;for(let E=0;E<o;E++)if(l(),i.symbols.SendInput(1,v(new p(0,new d(0,0,0,n,0)).buffer),40),i.symbols.SendInput(1,v(new p(0,new d(0,0,0,r,0)).buffer),40),s>0)Bun.sleepSync(s*1000)}if(t)c(t);return h}function z(e,o,s=!1,t=u.PAUSE){if(l(),!s){let[n,r]=w(e,o),[E,a]=Q(n,r),m=new d(E,a,0,g|Z,0),x=new p(0,m);i.symbols.SendInput(1,v(x.buffer),40)}else{let[n,r]=w();q((e??n)-n,(o??r)-r,t,!0)}if(t)c(t);return h}function q(e=0,o=0,s=!1,t=u.PAUSE){if(l(),!s){let[n,r]=w();z(n+e,r+o,t)}else{let n=new d(e,o,0,g,0),r=new p(0,n);if(i.symbols.SendInput(1,v(r.buffer),40),t)c(t)}return h}import{ptr as de}from"bun:ffi";class J{listeners=new Map;isRunning=!1;on(e,o){if(!this.listeners.has(e))this.listeners.set(e,new Set);this.listeners.get(e).add(o)}off(e,o){this.listeners.get(e)?.delete(o)}once(e,o){let s=(t)=>{o(t),this.off(e,s)};this.on(e,s)}listen(e){this.on("move",e),this.on("down",e),this.on("up",e)}_emit(e,o){this.listeners.get(e)?.forEach((s)=>{try{s(o)}catch(t){console.error(`Mouse event error [${e}]:`,t)}})}async startListener(e=8){if(this.isRunning)return;this.isRunning=!0,console.log("Mouse listener started.");let o=new ArrayBuffer(8),s=new DataView(o),t={x:0,y:0},n={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){i.symbols.GetCursorPos(de(o));let r=s.getInt32(0,!0),E=s.getInt32(4,!0);if(r!==t.x||E!==t.y){let x={event:"move",x:r,y:E,lastX:t.x,lastY:t.y,deltaX:r-t.x,deltaY:E-t.y};this._emit("move",x),t.x=r,t.y=E}let a={left:i.symbols.GetAsyncKeyState(1),right:i.symbols.GetAsyncKeyState(2),middle:i.symbols.GetAsyncKeyState(4),x1:i.symbols.GetAsyncKeyState(5),x2:i.symbols.GetAsyncKeyState(6)},m=Object.fromEntries(Object.entries(a).map(([x,O])=>[x,(O&32768)!==0]));for(let x of Object.keys(n))if(m[x]!==n[x]){n[x]=m[x];let O={event:m[x]?"down":"up",button:x,x:t.x,y:t.y};this._emit(m[x]?"down":"up",O)}await Bun.sleep(e)}console.log("Mouse listener stopped.")}stopListener(){this.isRunning=!1}}class ae{get position(){let e=w();return{x:e[0],y:e[1]}}down=re;up=ie;click=fe;moveTo=z;moveRel=q;listener=new J}var h=new ae;export{h as mouse,A as keyboard,u as config};
