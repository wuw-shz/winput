// @bun
var Ot={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]]};import{dlopen as ot,FFIType as r,suffix as En}from"bun:ffi";var M=ot(`user32.${En}`,{SendInput:{args:[r.u32,r.ptr,r.i32],returns:r.u32},MapVirtualKeyW:{args:[r.u32,r.u32],returns:r.u32},GetCursorPos:{args:[r.ptr],returns:r.bool},GetKeyState:{args:[r.i32],returns:r.i16},GetAsyncKeyState:{args:[r.i32],returns:r.i16},SetWindowsHookExW:{args:[r.i32,r.ptr,r.ptr,r.u32],returns:r.ptr},UnhookWindowsHookEx:{args:[r.ptr],returns:r.bool},CallNextHookEx:{args:[r.ptr,r.i32,r.ptr,r.ptr],returns:r.ptr},GetDC:{args:[r.ptr],returns:r.u64},ReleaseDC:{args:[r.u64,r.u64],returns:r.int},GetDesktopWindow:{args:[],returns:r.ptr},GetForegroundWindow:{args:[],returns:r.u64},GetWindowTextW:{args:[r.u64,r.ptr,r.int],returns:r.int},GetWindowRect:{args:[r.u64,r.ptr],returns:r.bool},GetSystemMetrics:{args:[r.int],returns:r.int},SetLayeredWindowAttributes:{args:[r.u64,r.uint32_t,r.int8_t,r.uint32_t],returns:r.bool},UpdateLayeredWindow:{args:[r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.ptr,r.uint32_t,r.ptr,r.uint32_t],returns:r.bool},GetWindowLongW:{args:[r.u64,r.int],returns:r.int},SetWindowLongW:{args:[r.u64,r.int,r.int],returns:r.int},CreateWindowExW:{args:[r.uint32_t,r.ptr,r.ptr,r.uint32_t,r.int,r.int,r.int,r.int,r.ptr,r.ptr,r.ptr,r.ptr],returns:r.ptr},ShowWindow:{args:[r.u64,r.int],returns:r.bool},UpdateWindow:{args:[r.u64],returns:r.bool},SetWindowPos:{args:[r.u64,r.u64,r.int,r.int,r.int,r.int,r.uint32_t],returns:r.bool},FindWindowA:{args:[r.ptr,r.ptr],returns:r.u64},FillRect:{args:[r.ptr,r.ptr,r.ptr],returns:r.int},IsWindow:{args:[r.u64],returns:r.bool},SetForegroundWindow:{args:[r.u64],returns:r.bool},IsWindowVisible:{args:[r.u64],returns:r.bool},GetWindowThreadProcessId:{args:[r.u64,r.ptr],returns:r.u32},MoveWindow:{args:[r.u64,r.int,r.int,r.int,r.int,r.bool],returns:r.bool},GetClientRect:{args:[r.u64,r.ptr],returns:r.bool},PostMessageA:{args:[r.u64,r.u32,r.u64,r.u64],returns:r.bool},GetClassNameA:{args:[r.u64,r.ptr,r.int],returns:r.int},SetWindowTextW:{args:[r.u64,r.ptr],returns:r.bool},EnableWindow:{args:[r.u64,r.bool],returns:r.bool},RedrawWindow:{args:[r.u64,r.ptr,r.u64,r.u32],returns:r.bool},ClientToScreen:{args:[r.u64,r.ptr],returns:r.bool},ScreenToClient:{args:[r.u64,r.ptr],returns:r.bool},SendMessageA:{args:[r.u64,r.u32,r.u64,r.u64],returns:r.ptr},IsIconic:{args:[r.u64],returns:r.bool},IsZoomed:{args:[r.u64],returns:r.bool},EnumWindows:{args:[r.function,r.i64],returns:r.bool},EnumChildWindows:{args:[r.u64,r.function,r.i64],returns:r.bool},FlashWindow:{args:[r.u64,r.bool],returns:r.bool},PrintWindow:{args:[r.u64,r.u64,r.u32],returns:r.bool},GetWindowDC:{args:[r.u64],returns:r.u64},LoadImageW:{args:[r.u64,r.ptr,r.uint32_t,r.int,r.int,r.uint32_t],returns:r.u64},SetWindowRgn:{args:[r.u64,r.u64,r.bool],returns:r.int},EnumDisplayMonitors:{args:[r.ptr,r.ptr,r.function,r.ptr],returns:r.bool},GetMonitorInfoW:{args:[r.ptr,r.ptr],returns:r.bool}}),D=ot("gdi32.dll",{GetPixel:{args:[r.u64,r.int,r.int],returns:r.uint32_t},CreatePen:{args:[r.int,r.int,r.uint32_t],returns:r.u64},SelectObject:{args:[r.u64,r.u64],returns:r.u64},MoveToEx:{args:[r.u64,r.int,r.int,r.ptr],returns:r.bool},LineTo:{args:[r.u64,r.int,r.int],returns:r.bool},DeleteObject:{args:[r.u64],returns:r.bool},CreateCompatibleDC:{args:[r.u64],returns:r.u64},CreateDIBSection:{args:[r.ptr,r.ptr,r.uint32_t,r.ptr,r.ptr,r.uint32_t],returns:r.ptr},DeleteDC:{args:[r.u64],returns:r.bool},CreateSolidBrush:{args:[r.uint32_t],returns:r.u64},CreateCompatibleBitmap:{args:[r.u64,r.int,r.int],returns:r.u64},BitBlt:{args:[r.u64,r.int,r.int,r.int,r.int,r.u64,r.int,r.int,r.uint32_t],returns:r.bool},GetDIBits:{args:[r.u64,r.u64,r.u32,r.u32,r.ptr,r.ptr,r.u32],returns:r.int},GetObjectA:{args:[r.ptr,r.int,r.ptr],returns:r.int},CreateRectRgn:{args:[r.int,r.int,r.int,r.int],returns:r.u64},CreateEllipticRgn:{args:[r.int,r.int,r.int,r.int],returns:r.u64},CreateRoundRectRgn:{args:[r.int,r.int,r.int,r.int,r.int,r.int],returns:r.u64},CreatePolygonRgn:{args:[r.ptr,r.int,r.int],returns:r.u64}}),P=ot(`kernel32.${En}`,{GetLastError:{args:[],returns:r.u32},OpenProcess:{args:[r.u32,r.bool,r.u32],returns:r.u64},CloseHandle:{args:[r.u64],returns:r.bool},QueryFullProcessImageNameW:{args:[r.u64,r.u32,r.ptr,r.ptr],returns:r.bool},TerminateProcess:{args:[r.u64,r.u32],returns:r.bool},RtlMoveMemory:{args:[r.ptr,r.u64,r.u64],returns:r.void}}),g=ot("gdiplus.dll",{GdiplusStartup:{args:[r.ptr,r.ptr,r.ptr],returns:r.int},GdiplusShutdown:{args:[r.u64],returns:r.void},GdipCreateBitmapFromFile:{args:[r.ptr,r.ptr],returns:r.int},GdipGetImageWidth:{args:[r.u64,r.ptr],returns:r.int},GdipGetImageHeight:{args:[r.u64,r.ptr],returns:r.int},GdipBitmapLockBits:{args:[r.u64,r.ptr,r.uint32_t,r.int,r.ptr],returns:r.int},GdipBitmapUnlockBits:{args:[r.u64,r.ptr],returns:r.int},GdipDisposeImage:{args:[r.u64],returns:r.int},GdipCreateBitmapFromScan0:{args:[r.int,r.int,r.int,r.int,r.ptr,r.ptr],returns:r.int},GdipSaveImageToFile:{args:[r.u64,r.ptr,r.ptr,r.ptr],returns:r.int},GdipGetImageEncodersSize:{args:[r.ptr,r.ptr],returns:r.int},GdipGetImageEncoders:{args:[r.u32,r.u32,r.ptr],returns:r.int}});var Z=process.arch==="x64"||process.arch==="arm64";class Dt extends Error{constructor(t){super(t);this.name="FailSafeException"}}var pn=Z?8:4;function mn(t=0,n=0,e=0,a=0,s=0,u=0n){let o=20+pn,c=Buffer.alloc(o);if(c.writeInt32LE(t,0),c.writeInt32LE(n,4),c.writeUInt32LE(e>>>0,8),c.writeUInt32LE(a>>>0,12),c.writeUInt32LE(s>>>0,16),Z)c.writeBigUInt64LE(BigInt(u),20);else c.writeUInt32LE(Number(u)>>>0,20);return c}function Nt(t=0,n=0,e=0,a=0,s=0n){let u=12+pn,o=Buffer.alloc(u);if(o.writeUInt16LE(t&65535,0),o.writeUInt16LE(n&65535,2),o.writeUInt32LE(e>>>0,4),o.writeUInt32LE(a>>>0,8),Z)o.writeBigUInt64LE(BigInt(s),12);else o.writeUInt32LE(Number(s)>>>0,12);return Z?Buffer.concat([o,Buffer.alloc(32-o.length)]):o}function J(t,n){let e=Z?40:36,a=Buffer.alloc(e);return a.writeUInt32LE(t>>>0,0),n.copy(a,8,0,Math.min(32,n.length)),a}var x={LBUTTON:1,RBUTTON:2,MBUTTON:4,XBUTTON1:5,XBUTTON2:6,BACK:8,TAB:9,RETURN:13,SHIFT:16,CONTROL:17,MENU:18,PAUSE:19,CAPITAL:20,ESCAPE:27,SPACE:32,PRIOR:33,NEXT:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,LWIN:91,RWIN:92,APPS:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SEPARATOR:108,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NUMLOCK:144,SCROLL:145,LSHIFT:160,RSHIFT:161,LCONTROL:162,RCONTROL:163,LMENU:164,RMENU:165,BROWSER_BACK:166,BROWSER_FORWARD:167,BROWSER_REFRESH:168,BROWSER_STOP:169,BROWSER_SEARCH:170,BROWSER_FAVORITES:171,BROWSER_HOME:172,VOLUME_MUTE:173,VOLUME_DOWN:174,VOLUME_UP:175,MEDIA_NEXT_TRACK:176,MEDIA_PREV_TRACK:177,MEDIA_STOP:178,MEDIA_PLAY_PAUSE:179,LAUNCH_MAIL:180,LAUNCH_MEDIA_SELECT:181,LAUNCH_APP1:182,LAUNCH_APP2:183,OEM_1:186,OEM_PLUS:187,OEM_COMMA:188,OEM_MINUS:189,OEM_PERIOD:190,OEM_2:191,OEM_3:192,OEM_4:219,OEM_5:220,OEM_6:221,OEM_7:222,SNAPSHOT:44,SLEEP:95},X={a:{scan:30,vk:x.KEY_A},b:{scan:48,vk:x.KEY_B},c:{scan:46,vk:x.KEY_C},d:{scan:32,vk:x.KEY_D},e:{scan:18,vk:x.KEY_E},f:{scan:33,vk:x.KEY_F},g:{scan:34,vk:x.KEY_G},h:{scan:35,vk:x.KEY_H},i:{scan:23,vk:x.KEY_I},j:{scan:36,vk:x.KEY_J},k:{scan:37,vk:x.KEY_K},l:{scan:38,vk:x.KEY_L},m:{scan:50,vk:x.KEY_M},n:{scan:49,vk:x.KEY_N},o:{scan:24,vk:x.KEY_O},p:{scan:25,vk:x.KEY_P},q:{scan:16,vk:x.KEY_Q},r:{scan:19,vk:x.KEY_R},s:{scan:31,vk:x.KEY_S},t:{scan:20,vk:x.KEY_T},u:{scan:22,vk:x.KEY_U},v:{scan:47,vk:x.KEY_V},w:{scan:17,vk:x.KEY_W},x:{scan:45,vk:x.KEY_X},y:{scan:21,vk:x.KEY_Y},z:{scan:44,vk:x.KEY_Z},"0":{scan:11,vk:x.KEY_0},"1":{scan:2,vk:x.KEY_1},"2":{scan:3,vk:x.KEY_2},"3":{scan:4,vk:x.KEY_3},"4":{scan:5,vk:x.KEY_4},"5":{scan:6,vk:x.KEY_5},"6":{scan:7,vk:x.KEY_6},"7":{scan:8,vk:x.KEY_7},"8":{scan:9,vk:x.KEY_8},"9":{scan:10,vk:x.KEY_9},f1:{scan:59,vk:x.F1},f2:{scan:60,vk:x.F2},f3:{scan:61,vk:x.F3},f4:{scan:62,vk:x.F4},f5:{scan:63,vk:x.F5},f6:{scan:64,vk:x.F6},f7:{scan:65,vk:x.F7},f8:{scan:66,vk:x.F8},f9:{scan:67,vk:x.F9},f10:{scan:68,vk:x.F10},f11:{scan:87,vk:x.F11},f12:{scan:88,vk:x.F12},f13:{scan:100,vk:x.F13},f14:{scan:101,vk:x.F14},f15:{scan:102,vk:x.F15},f16:{scan:103,vk:x.F16},f17:{scan:104,vk:x.F17},f18:{scan:105,vk:x.F18},f19:{scan:106,vk:x.F19},f20:{scan:107,vk:x.F20},f21:{scan:108,vk:x.F21},f22:{scan:109,vk:x.F22},f23:{scan:110,vk:x.F23},f24:{scan:118,vk:x.F24},"-":{scan:12,vk:x.OEM_MINUS},minus:{scan:12,vk:x.OEM_MINUS},"=":{scan:13,vk:x.OEM_PLUS},equal:{scan:13,vk:x.OEM_PLUS},equals:{scan:13,vk:x.OEM_PLUS},"[":{scan:26,vk:x.OEM_4},bracketleft:{scan:26,vk:x.OEM_4},"]":{scan:27,vk:x.OEM_6},bracketright:{scan:27,vk:x.OEM_6},"\\":{scan:43,vk:x.OEM_5},backslash:{scan:43,vk:x.OEM_5},";":{scan:39,vk:x.OEM_1},semicolon:{scan:39,vk:x.OEM_1},"'":{scan:40,vk:x.OEM_7},quote:{scan:40,vk:x.OEM_7},apostrophe:{scan:40,vk:x.OEM_7},"`":{scan:41,vk:x.OEM_3},grave:{scan:41,vk:x.OEM_3},backtick:{scan:41,vk:x.OEM_3},",":{scan:51,vk:x.OEM_COMMA},comma:{scan:51,vk:x.OEM_COMMA},".":{scan:52,vk:x.OEM_PERIOD},period:{scan:52,vk:x.OEM_PERIOD},dot:{scan:52,vk:x.OEM_PERIOD},"/":{scan:53,vk:x.OEM_2},slash:{scan:53,vk:x.OEM_2},forwardslash:{scan:53,vk:x.OEM_2},space:{scan:57,vk:x.SPACE},enter:{scan:28,vk:x.RETURN},return:{scan:28,vk:x.RETURN},tab:{scan:15,vk:x.TAB},backspace:{scan:14,vk:x.BACK},escape:{scan:1,vk:x.ESCAPE},esc:{scan:1,vk:x.ESCAPE},shift:{scan:42,vk:x.SHIFT},shiftleft:{scan:42,vk:x.LSHIFT},shiftright:{scan:54,vk:x.RSHIFT},ctrl:{scan:29,vk:x.CONTROL},control:{scan:29,vk:x.CONTROL},ctrlleft:{scan:29,vk:x.LCONTROL},controlleft:{scan:29,vk:x.LCONTROL},ctrlright:{scan:29,extended:!0,vk:x.RCONTROL},controlright:{scan:29,extended:!0,vk:x.RCONTROL},rctrl:{scan:29,extended:!0,vk:x.RCONTROL},alt:{scan:56,vk:x.MENU},altleft:{scan:56,vk:x.LMENU},altright:{scan:56,extended:!0,vk:x.RMENU},ralt:{scan:56,extended:!0,vk:x.RMENU},altgr:{scan:56,extended:!0,vk:x.RMENU},win:{scan:91,extended:!0,vk:x.LWIN},winleft:{scan:91,extended:!0,vk:x.LWIN},windows:{scan:91,extended:!0,vk:x.LWIN},winright:{scan:92,extended:!0,vk:x.RWIN},windowsright:{scan:92,extended:!0,vk:x.RWIN},apps:{scan:93,extended:!0,vk:x.APPS},menu:{scan:93,extended:!0,vk:x.APPS},contextmenu:{scan:93,extended:!0,vk:x.APPS},capslock:{scan:58,vk:x.CAPITAL},numlock:{scan:69,vk:x.NUMLOCK},scrolllock:{scan:70,vk:x.SCROLL},up:{scan:72,extended:!0,vk:x.UP},down:{scan:80,extended:!0,vk:x.DOWN},left:{scan:75,extended:!0,vk:x.LEFT},right:{scan:77,extended:!0,vk:x.RIGHT},home:{scan:71,extended:!0,vk:x.HOME},end:{scan:79,extended:!0,vk:x.END},pageup:{scan:73,extended:!0,vk:x.PRIOR},pagedown:{scan:81,extended:!0,vk:x.NEXT},insert:{scan:82,extended:!0,vk:x.INSERT},delete:{scan:83,extended:!0,vk:x.DELETE},del:{scan:83,extended:!0,vk:x.DELETE},numpad0:{scan:82,vk:x.NUMPAD0},numpad1:{scan:79,vk:x.NUMPAD1},numpad2:{scan:80,vk:x.NUMPAD2},numpad3:{scan:81,vk:x.NUMPAD3},numpad4:{scan:75,vk:x.NUMPAD4},numpad5:{scan:76,vk:x.NUMPAD5},numpad6:{scan:77,vk:x.NUMPAD6},numpad7:{scan:71,vk:x.NUMPAD7},numpad8:{scan:72,vk:x.NUMPAD8},numpad9:{scan:73,vk:x.NUMPAD9},numpaddecimal:{scan:83,vk:x.DECIMAL},numpadperiod:{scan:83,vk:x.DECIMAL},numpaddivide:{scan:53,extended:!0,vk:x.DIVIDE},numpadmultiply:{scan:55,vk:x.MULTIPLY},numpadsubtract:{scan:74,vk:x.SUBTRACT},numpadadd:{scan:78,vk:x.ADD},numpadenter:{scan:28,extended:!0,vk:x.RETURN},num0:{scan:82,vk:x.NUMPAD0},num1:{scan:79,vk:x.NUMPAD1},num2:{scan:80,vk:x.NUMPAD2},num3:{scan:81,vk:x.NUMPAD3},num4:{scan:75,vk:x.NUMPAD4},num5:{scan:76,vk:x.NUMPAD5},num6:{scan:77,vk:x.NUMPAD6},num7:{scan:71,vk:x.NUMPAD7},num8:{scan:72,vk:x.NUMPAD8},num9:{scan:73,vk:x.NUMPAD9},volumeup:{scan:0,vk:x.VOLUME_UP},volumedown:{scan:0,vk:x.VOLUME_DOWN},volumemute:{scan:0,vk:x.VOLUME_MUTE},mute:{scan:0,vk:x.VOLUME_MUTE},playpause:{scan:0,vk:x.MEDIA_PLAY_PAUSE},stop:{scan:0,vk:x.MEDIA_STOP},nexttrack:{scan:0,vk:x.MEDIA_NEXT_TRACK},previoustrack:{scan:0,vk:x.MEDIA_PREV_TRACK},medianext:{scan:0,vk:x.MEDIA_NEXT_TRACK},mediaprevious:{scan:0,vk:x.MEDIA_PREV_TRACK},mediaplaypause:{scan:0,vk:x.MEDIA_PLAY_PAUSE},mediastop:{scan:0,vk:x.MEDIA_STOP},browserhome:{scan:0,vk:x.BROWSER_HOME},browserback:{scan:0,vk:x.BROWSER_BACK},browserforward:{scan:0,vk:x.BROWSER_FORWARD},browserrefresh:{scan:0,vk:x.BROWSER_REFRESH},browserstop:{scan:0,vk:x.BROWSER_STOP},browsersearch:{scan:0,vk:x.BROWSER_SEARCH},browserfavorites:{scan:0,vk:x.BROWSER_FAVORITES},mail:{scan:0,vk:x.LAUNCH_MAIL},calculator:{scan:0,vk:x.LAUNCH_APP2},mycomputer:{scan:0,vk:x.LAUNCH_APP1},computer:{scan:0,vk:x.LAUNCH_APP1},printscreen:{scan:55,extended:!0,vk:x.SNAPSHOT},prtsc:{scan:55,extended:!0,vk:x.SNAPSHOT},pause:{scan:69,vk:x.PAUSE},break:{scan:70,vk:x.PAUSE},sleep:{scan:0,vk:x.SLEEP},intl1:{scan:115},intl2:{scan:112},intl3:{scan:125},intl4:{scan:121},intl5:{scan:123},intl6:{scan:92},lang1:{scan:114},lang2:{scan:113}},Kt=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]),z={};for(let[t,n]of Object.entries(X)){let e=n;if(e.vk&&!z[e.vk])z[e.vk]=t}var Mn={},bn={};for(let[t,n]of Object.entries(X)){let e=n;if(e.scan>0){if(e.extended){if(!bn[e.scan])bn[e.scan]=t}else if(!Mn[e.scan])Mn[e.scan]=t}}var Tt=1,ln=32768,Rt=2,yt=4;var gt=8,St=16;var Pt=32,Bt=64;var Ft=128,ht=256,_n=1,Un=2,kn=1,Yt=2,Lt=8;var Tr=0;function vn(t,n,e,a=0){let s=e|(n?kn:0),u=Nt(0,t,s,a,0n),o=J(1,u);M.symbols.SendInput(1,o,40)}function In(t,n,e=0){let s=Nt(t,0,n?Yt:Tr,e,0n),u=J(1,s);M.symbols.SendInput(1,u,40)}function at(t){let n=X[t];if(!n)throw Error(`Invalid key name: "${t}"`);return n}function G(t){let n=at(t);if(n.scan===0&&n.vk)In(n.vk,!1);else{let e=Lt;vn(n.scan,!!n.extended,e)}return B}function L(t){let n=at(t);if(n.scan===0&&n.vk)In(n.vk,!0);else{let e=Lt|Yt;vn(n.scan,!!n.extended,e)}return B}function j(t){return G(t),L(t),B}function dn(t,n=1,e=0){if(n<1)throw Error(`repeat must be >= 1, got: ${n}`);if(e<0)throw Error(`delay must be >= 0, got: ${e}`);for(let a=0;a<n;a++)if(G(t),L(t),e>0)Bun.sleepSync(e);return B}function An(t,n=0){if(n<0)throw Error(`delay must be >= 0, got: ${n}`);for(let e of t){if(e>="A"&&e<="Z"){let a=e.toLowerCase();G("shift"),j(a),L("shift")}else if(Kt.has(e)){let a=Kt.get(e);G("shift"),j(a),L("shift")}else j(e);if(n>0)Bun.sleepSync(n)}return B}function $(t){let n=at(t);if(n.vk)return(M.symbols.GetAsyncKeyState(n.vk)&32768)!==0;let e=M.symbols.MapVirtualKeyW(n.scan,1);return(M.symbols.GetAsyncKeyState(e)&32768)!==0}function On(t){return t.some((n)=>$(n))}function Dn(t){return t.every((n)=>$(n))}function Nn(t){for(let n of t)G(n);for(let n=t.length-1;n>=0;n--)L(t[n]);return B}function Kn(t,n){if(n<0)throw Error(`duration must be >= 0, got: ${n}`);return G(t),Bun.sleepSync(n),L(t),B}function Tn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if($(t)){clearInterval(u),e(!0);return}if(n){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}function Rn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(!$(t)){clearInterval(u),e(!0);return}if(n){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}function yn(t){return j(t),B}function gn(t){let n=at(t),e;if(n.vk)e=n.vk;else e=M.symbols.MapVirtualKeyW(n.scan,1);let a=M.symbols.GetAsyncKeyState(e),s=M.symbols.GetKeyState(e);return{isPressed:(a&32768)!==0,isToggled:(s&1)!==0}}function Sn(){let t=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],n="abcdefghijklmnopqrstuvwxyz".split("");t.push(...n);for(let e of t)if($(e))L(e);return B}class tt{listeners=new Map;isRunning=!1;startPromise=null;_onProxy=null;_offProxy=null;_onceProxy=null;_listenProxy=null;get on(){if(!this._onProxy)this._onProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._on(n,e)}}});return this._onProxy}get off(){if(!this._offProxy)this._offProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._off(n,e)}}});return this._offProxy}get once(){if(!this._onceProxy)this._onceProxy=new Proxy({},{get:(t,n)=>{return(e)=>{this._once(n,e)}}});return this._onceProxy}get listen(){if(!this._listenProxy)this._listenProxy=(t)=>{this._on("*",t)};return this._listenProxy}unlisten(t){this._off("*",t)}_on(t,n){if(!this.listeners.has(t))this.listeners.set(t,new Set);this.listeners.get(t).add(n)}_off(t,n){this.listeners.get(t)?.delete(n)}_once(t,n){let e=(a)=>{try{n(a)}finally{this._off(t,e)}};this._on(t,e)}async start(t=8){if(this.isRunning)return console.warn("Listener already running"),this.startPromise??Promise.resolve();return this.isRunning=!0,this.startPromise=(async()=>{try{await this.run(t)}catch(n){console.error("Listener run error:",n)}finally{this.isRunning=!1,this.startPromise=null}})(),this.startPromise}async stop(){if(this.isRunning=!1,this.startPromise)await this.startPromise}_emit(t,n){this.listeners.get(t)?.forEach((e)=>{try{e(n)}catch(a){console.error(`Listener error [${String(t)}]:`,a)}}),this.listeners.get("*")?.forEach((e)=>{try{e(n)}catch(a){console.error("Listener error [*]:",a)}})}}var yr=new Set([x.LBUTTON,x.RBUTTON,x.MBUTTON,x.XBUTTON1,x.XBUTTON2]);function gr(t){if(z[t])return z[t];if(t>=48&&t<=57)return String.fromCharCode(t);if(t>=65&&t<=90)return String.fromCharCode(t).toLowerCase();return}var Sr=Object.values(x);class Ct extends tt{async run(t=8){if(t<1||t>1000)console.warn(`Keyboard listener interval out of recommended range (1-1000ms): ${t}ms`);let n=new Map;while(this.isRunning){for(let e of Sr){if(yr.has(e))continue;let s=(M.symbols.GetAsyncKeyState(e)&32768)!==0,u=n.get(e);if(u!==s){if(n.set(e,s),u!==void 0){let o=gr(e);if(!o)continue;let c=X[o].scan,f={event:s?"down":"up",key:o,vk_code:e,scan_code:c};this._emit(s?"down":"up",f)}}}await Bun.sleep(t)}}}class Pn{press=G;release=L;tap=j;repeatTap=dn;write=An;isPressed=$;hotkey=Nn;hold=Kn;isAnyPressed=On;areAllPressed=Dn;waitForPress=Tn;waitForRelease=Rn;toggleKey=yn;getKeyState=gn;releaseAll=Sn;listener=new Ct}var B=new Pn;import{ptr as Pr}from"bun:ffi";function C(){if(Ot.FAILSAFE){let t=F();for(let n of Ot.FAILSAFE_POINTS)if(t[0]===n[0]&&t[1]===n[1])throw new Dt("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function Bn(t=0,n=0){let[e,a]=[M.symbols.GetSystemMetrics(0),M.symbols.GetSystemMetrics(1)],s=Math.round(t*65535/(e-1)),u=Math.round(n*65535/(a-1)),o=Math.max(0,Math.min(65535,s)),c=Math.max(0,Math.min(65535,u));return[o,c]}function F(t,n){let e=new ArrayBuffer(8),a=new DataView(e);M.symbols.GetCursorPos(Pr(e));let s=a.getInt32(0,!0),u=a.getInt32(4,!0);return[t??s,n??u]}var S="left",ut="right",nt="middle",Gt="x1",Vt="x2";var Br=2048,Fr=4096,hr=120,Yr={[S]:{down:Rt,up:yt,data:0},[nt]:{down:Pt,up:Bt,data:0},[ut]:{down:gt,up:St,data:0},[Gt]:{down:Ft,up:ht,data:_n},[Vt]:{down:Ft,up:ht,data:Un}};function Fn(t,n){let e=Yr[t];if(!e)throw Error(`Invalid button: ${t}`);return{event:e[n],mouseData:e.data}}function Lr(t,n){if(t!==void 0){if(!Number.isFinite(t))throw Error(`Invalid x coordinate: ${t}`);if(t<0)throw Error(`x coordinate must be non-negative: ${t}`)}if(n!==void 0){if(!Number.isFinite(n))throw Error(`Invalid y coordinate: ${n}`);if(n<0)throw Error(`y coordinate must be non-negative: ${n}`)}}function H(t,n,e,a,s=0){let u=mn(t,n,e,a,s,0n),o=J(0,u);M.symbols.SendInput(1,o,40)}function ct(t=S){try{let{event:n,mouseData:e}=Fn(t,"down");return H(0,0,e,n,0),y}catch(n){throw console.error("[Mouse Press Error]",n),n}}function xt(t=S){try{let{event:n,mouseData:e}=Fn(t,"up");return H(0,0,e,n,0),y}catch(n){throw console.error("[Mouse Release Error]",n),n}}function wt(t=S,n=1,e=0){if(n<1)throw Error(`repeat must be >= 1, got: ${n}`);if(e<0)throw Error(`delay must be >= 0, got: ${e}`);if([S,nt,ut].includes(t)){let a=0,s=0;if(t===S)a=Rt,s=yt;else if(t===nt)a=Pt,s=Bt;else a=gt,s=St;for(let u=0;u<n;u++)if(C(),H(0,0,0,a,0),H(0,0,0,s,0),e>0)Bun.sleepSync(Math.round(e*1000))}return y}function V(t,n,e=!1){try{if(C(),Lr(t,n),!e){let[a,s]=F(t,n),[u,o]=Bn(a,s);H(u,o,0,Tt|ln,0)}else Xt(t??0,n??0,!0);return y}catch(a){throw console.error("[Mouse MoveTo Error]",a),a}}function Xt(t=0,n=0,e=!1){if(C(),!e){let[a,s]=F();V(a+t,s+n,!1)}else H(t,n,0,Tt,0);return y}function ft(t){let n;if(t===S)n=1;else if(t===ut)n=2;else if(t===nt)n=4;else if(t===Gt)n=5;else if(t===Vt)n=6;else throw Error(`Invalid button: ${t}`);return(M.symbols.GetAsyncKeyState(n)&32768)!==0}function $t(t,n,e=S,a=0.5){if(a<0)throw Error(`duration must be >= 0, got: ${a}`);C();let[s,u]=F();if(ct(e),a<=0)V(t,n,!1);else{let o=Math.max(10,Math.floor(a*100)),c=a/o;for(let f=1;f<=o;f++){let i=f/o,E=Math.round(s+(t-s)*i),b=Math.round(u+(n-u)*i);V(E,b,!1),Bun.sleepSync(Math.round(c*1000))}}return xt(e),y}function hn(t,n,e=S,a=0.5){let[s,u]=F();return $t(s+t,u+n,e,a)}function Yn(t,n="vertical"){C();let e=t*hr;return H(0,0,e,n==="vertical"?Br:Fr,0),y}var Cr={linear:(t)=>t,easeInQuad:(t)=>t*t,easeOutQuad:(t)=>t*(2-t),easeInOutQuad:(t)=>t<0.5?2*t*t:-1+(4-2*t)*t,easeInCubic:(t)=>t*t*t,easeOutCubic:(t)=>--t*t*t+1,easeInOutCubic:(t)=>t<0.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1};async function Ln(t,n,e=0.5,a="easeOutQuad"){if(e<0)throw Error(`duration must be >= 0, got: ${e}`);C();let[s,u]=F(),o=Cr[a];if(e<=0)return V(t,n,!1),y;let c=Math.max(10,Math.floor(e*100)),f=e/c;for(let i=1;i<=c;i++){let E=i/c,b=o(E),_=Math.round(s+(t-s)*b),p=Math.round(u+(n-u)*b);V(_,p,!1),Bun.sleepSync(Math.round(f*1000))}return y}function Cn(t,n){if(n<0)throw Error(`duration must be >= 0, got: ${n}`);return C(),ct(t),Bun.sleepSync(Math.round(n*1000)),xt(t),y}function Gn(t,n,e=S){return C(),V(t,n,!1),wt(e,1,0),y}function Ht(t,n,e=0){if(e<0)throw Error(`tolerance must be >= 0, got: ${e}`);let[a,s]=F(),u=Math.abs(a-t),o=Math.abs(s-n);return u<=e&&o<=e}function Vn(t,n,e,a=0){if(e!==void 0&&e<0)throw Error(`timeout must be >= 0, got: ${e}`);if(a<0)throw Error(`tolerance must be >= 0, got: ${a}`);return new Promise((s)=>{let o=0,c=setInterval(()=>{if(Ht(t,n,a)){clearInterval(c),s(!0);return}if(e!==void 0){if(o+=8,o>=e)clearInterval(c),s(!1)}},8)})}async function wn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(ft(t)){clearInterval(u),e(!0);return}if(n!==void 0){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}async function Xn(t,n){if(n!==void 0&&n<0)throw Error(`timeout must be >= 0, got: ${n}`);return new Promise((e)=>{let s=0,u=setInterval(()=>{if(!ft(t)){clearInterval(u),e(!0);return}if(n!==void 0){if(s+=8,s>=n)clearInterval(u),e(!1)}},8)})}import{ptr as Vr}from"bun:ffi";class Wt extends tt{async run(t=8){if(t<1||t>1000)console.warn(`Mouse listener interval out of recommended range (1-1000ms): ${t}ms`);let n=new ArrayBuffer(8),e=new DataView(n),a={x:0,y:0},s={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){M.symbols.GetCursorPos(Vr(n));let u=e.getInt32(0,!0),o=e.getInt32(4,!0);if(u!==a.x||o!==a.y){let i={event:"move",x:u,y:o,lastX:a.x,lastY:a.y,deltaX:u-a.x,deltaY:o-a.y};this._emit("move",i),a.x=u,a.y=o}let c={left:M.symbols.GetAsyncKeyState(1),right:M.symbols.GetAsyncKeyState(2),middle:M.symbols.GetAsyncKeyState(4),x1:M.symbols.GetAsyncKeyState(5),x2:M.symbols.GetAsyncKeyState(6)},f=Object.fromEntries(Object.entries(c).map(([i,E])=>[i,(E&32768)!==0]));for(let i of Object.keys(s))if(f[i]!==s[i]){s[i]=f[i];let E={event:f[i]?"down":"up",button:i,x:a.x,y:a.y};this._emit(f[i]?"down":"up",E)}await Bun.sleep(t)}}}class $n{get position(){let t=F();return{x:t[0],y:t[1]}}press=ct;release=xt;click=wt;moveTo=V;moveRel=Xt;isPressed=ft;dragTo=$t;dragRel=hn;scroll=Yn;smoothMoveTo=Ln;hold=Cn;clickAt=Gn;isAtPosition=Ht;waitForPosition=Vn;waitForPress=wn;waitForRelease=Xn;listener=new Wt}var y=new $n;import{ptr as T}from"bun:ffi";var jt;((p)=>{p[p.png=0]="png";p[p.jpg=1]="jpg";p[p.jpeg=2]="jpeg";p[p.bmp=3]="bmp";p[p.webp=4]="webp";p[p.gif=5]="gif";p[p.tiff=6]="tiff";p[p.ico=7]="ico";p[p.heic=8]="heic";p[p.heif=9]="heif";p[p.avif=10]="avif";p[p.svg=11]="svg";p[p.raw=12]="raw"})(jt||={});import{extname as Hn}from"path";var Wn=null;function jn(){if(Wn)return;let t=new Uint8Array(24);new DataView(t.buffer).setUint32(0,1,!0);let e=new BigUint64Array(1),a=g.symbols.GdiplusStartup(T(e),T(t),null);if(a!==0)throw Error(`GDI+ Startup failed: ${a}`);Wn=e[0]}async function it(t){try{jn();let n=Buffer.from(t+"\x00","utf16le"),e=new BigUint64Array(1),a=g.symbols.GdipCreateBitmapFromFile(T(n),T(e));if(a!==0)return console.error(`GDI+ Load Image failed: ${a} for ${t}`),null;let s=e[0];try{let u=new Uint32Array(1),o=new Uint32Array(1);g.symbols.GdipGetImageWidth(s,T(u)),g.symbols.GdipGetImageHeight(s,T(o));let c=u[0],f=o[0],i=2498570,E=new Uint32Array([0,0,c,f]),b=new Uint8Array(40),_=g.symbols.GdipBitmapLockBits(s,T(E),1,i,T(b));if(_!==0)return console.error(`GDI+ Load Image LockBits failed: ${_}`),null;try{let p=new DataView(b.buffer),l=p.getBigUint64(16,!0),m=p.getInt32(8,!0),U=c*f*4,k=new Uint8Array(U);if(m===c*4)P.symbols.RtlMoveMemory(T(k),l,BigInt(U));else for(let d=0;d<f;d++){let v=l+BigInt(d*m),I=T(k)+d*c*4;P.symbols.RtlMoveMemory(I,v,BigInt(c*4))}return new w({path:t,width:c,height:f,buffer:k})}finally{g.symbols.GdipBitmapUnlockBits(s,T(b))}}finally{g.symbols.GdipDisposeImage(s)}}catch(n){return console.error(`GDI+ Load Image Error: ${n}`),null}}function wr(t){let n=new Uint8Array(16),e=new DataView(n.buffer);switch(t){case"png":e.setUint32(0,1434252294,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"jpg":e.setUint32(0,1434252289,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"jpeg":e.setUint32(0,1434252289,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"bmp":e.setUint32(0,1434252288,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"webp":e.setUint32(0,1434252290,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"gif":e.setUint32(0,1434252291,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"tiff":e.setUint32(0,1434252292,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"ico":e.setUint32(0,1434252293,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"heic":e.setUint32(0,1434252294,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"heif":e.setUint32(0,1434252295,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"avif":e.setUint32(0,1434252296,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"svg":e.setUint32(0,1434252297,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;case"raw":e.setUint32(0,1434252298,!0),e.setUint16(4,6660,!0),e.setUint16(6,4563,!0),n.set([154,115,0,0,248,30,243,46],8);break;default:throw Error(`Unsupported format: ${t}`)}return n}async function qt(t,n){try{jn();let{width:e,height:a,buffer:s}=t,u=e*4,o=2498570,c=new BigUint64Array(1),f=g.symbols.GdipCreateBitmapFromScan0(e,a,u,o,T(s),T(c));if(f!==0)return console.error(`GDI+ Create Bitmap From Scan0 failed: ${f}`),!1;let i=c[0];try{let E=n||t?.path||`screen_${Date.now()}.png`;if(!Hn(E))return console.error(`Invalid path: "${E}" required file extension: ${Object.keys(jt).join(", ")}`),!1;let b=wr(Hn(E).replace(".","")),_=Buffer.from(E+"\x00","utf16le"),p=g.symbols.GdipSaveImageToFile(i,T(_),T(b),null);if(p!==0)return console.error(`GDI+ Save Image To File failed: ${p}`),!1;return!0}finally{g.symbols.GdipDisposeImage(i)}}catch(e){return console.error(`GDI+ Save Image Error: ${e}`),!1}}function qn(t){let n=(e)=>e.toString(16).padStart(2,"0");return`#${n(t.r)}${n(t.g)}${n(t.b)}`.toUpperCase()}function Qn(t){let n=t.replace("#","");return{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16)}}function Qt(t,n){return Math.sqrt(Math.pow(t.r-n.r,2)+Math.pow(t.g-n.g,2)+Math.pow(t.b-n.b,2))}function Zn(t,n,e){return Qt(t,n)<=e}function Jn(t,n){return t.x>=n.left&&t.x<=n.right&&t.y>=n.top&&t.y<=n.bottom}function zn(t,n,e){t/=255,n/=255,e/=255;let a=Math.max(t,n,e),s=Math.min(t,n,e),u=a-s,o=0;if(u!==0){if(a===t)o=(n-e)/u%6;else if(a===n)o=(e-t)/u+2;else o=(t-n)/u+4;if(o*=60,o<0)o+=360}let c=a===0?0:u/a;return[o,c,a]}function te(t,n,e){let a=e*n,s=a*(1-Math.abs(t/60%2-1)),u=e-a,o=0,c=0,f=0;if(t<60)o=a,c=s,f=0;else if(t<120)o=s,c=a,f=0;else if(t<180)o=0,c=a,f=s;else if(t<240)o=0,c=s,f=a;else if(t<300)o=s,c=0,f=a;else o=a,c=0,f=s;return[Math.round((o+u)*255),Math.round((c+u)*255),Math.round((f+u)*255)]}class ne{rgbToHex=qn;hexToRgb=Qn;rgbToHsv=zn;hsvToRgb=te;colorDistance=Qt;isColorSimilar=Zn;pointInRect=Jn}var h=new ne;function ee(t){return{path:t.path,width:t.width,height:t.height,buffer:new Uint8Array(t.buffer)}}function et(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4){let c=s[o],f=s[o+1],i=s[o+2],E=s[o+3],b=0.2126*i+0.7152*f+0.0722*c,_=Math.min(255,Math.max(0,b));u[o]=_,u[o+1]=_,u[o+2]=_,u[o+3]=E}return{path:n,width:e,height:a,buffer:u}}function re(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length),c=n*255;for(let f=0;f<u.length;f+=4){for(let i=0;i<3;i++)o[f+i]=Math.min(255,Math.max(0,u[f+i]+c));o[f+3]=u[f+3]}return{path:e,width:a,height:s,buffer:o}}function se(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let c=0;c<u.length;c+=4){for(let f=0;f<3;f++){let i=u[c+f],E=n*(i-128)+128;o[c+f]=Math.min(255,Math.max(0,E))}o[c+3]=u[c+3]}return{path:e,width:a,height:s,buffer:o}}function Zt(t,n,e){let{path:a,width:s,height:u,buffer:o}=t,c=new Uint8Array(o.length),f=Math.floor(e/2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0,p=0;for(let m=0;m<e;m++)for(let U=0;U<e;U++){let k=Math.min(s-1,Math.max(0,E+U-f)),v=(Math.min(u-1,Math.max(0,i+m-f))*s+k)*4,I=n[m*e+U];p+=o[v]*I,_+=o[v+1]*I,b+=o[v+2]*I}let l=(i*s+E)*4;c[l]=Math.min(255,Math.max(0,p)),c[l+1]=Math.min(255,Math.max(0,_)),c[l+2]=Math.min(255,Math.max(0,b)),c[l+3]=o[l+3]}return{path:a,width:s,height:u,buffer:c}}function oe(t,n=1){if(n===1)return Zt(t,[0.0625,0.125,0.0625,0.125,0.25,0.125,0.0625,0.125,0.0625],3);let e=[1,4,7,4,1,4,16,26,16,4,7,26,41,26,7,4,16,26,16,4,1,4,7,4,1].map((a)=>a/273);return Zt(t,e,5)}function ae(t){return Zt(t,[0,-1,0,-1,5,-1,0,-1,0],3)}function ue(t){let n=et(t),{path:e,width:a,height:s,buffer:u}=n,o=new Uint8Array(u.length),c=[-1,0,1,-2,0,2,-1,0,1],f=[-1,-2,-1,0,0,0,1,2,1];for(let i=1;i<s-1;i++)for(let E=1;E<a-1;E++){let b=0,_=0;for(let U=-1;U<=1;U++)for(let k=-1;k<=1;k++){let d=((i+U)*a+(E+k))*4,v=u[d+1];b+=v*c[(U+1)*3+(k+1)],_+=v*f[(U+1)*3+(k+1)]}let p=Math.sqrt(b*b+_*_),l=Math.min(255,Math.max(0,p)),m=(i*a+E)*4;o[m]=l,o[m+1]=l,o[m+2]=l,o[m+3]=255}return{path:e,width:a,height:s,buffer:o}}function Et(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let c=3;c<u.length;c+=4)o[c]=u[c];for(let c=0;c<s;c++)for(let f=0;f<a;f++){let i=0,E=0,b=0;for(let p=-n;p<=n;p++)for(let l=-n;l<=n;l++){let m=c+p,U=f+l;if(m>=0&&m<s&&U>=0&&U<a){let k=(m*a+U)*4;b=Math.max(b,u[k]),E=Math.max(E,u[k+1]),i=Math.max(i,u[k+2])}}let _=(c*a+f)*4;o[_]=b,o[_+1]=E,o[_+2]=i}return{path:e,width:a,height:s,buffer:o}}function pt(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let c=3;c<u.length;c+=4)o[c]=u[c];for(let c=0;c<s;c++)for(let f=0;f<a;f++){let i=255,E=255,b=255;for(let p=-n;p<=n;p++)for(let l=-n;l<=n;l++){let m=c+p,U=f+l;if(m>=0&&m<s&&U>=0&&U<a){let k=(m*a+U)*4;b=Math.min(b,u[k]),E=Math.min(E,u[k+1]),i=Math.min(i,u[k+2])}}let _=(c*a+f)*4;o[_]=b,o[_+1]=E,o[_+2]=i}return{path:e,width:a,height:s,buffer:o}}function ce(t,n=1){return Et(pt(t,n),n)}function xe(t,n=1){return pt(Et(t,n),n)}function fe(t){let{buffer:n}=t,e=[];for(let a=0;a<n.length;a+=4)e.push([n[a+2],n[a+1],n[a],n[a+3]]);return e}function ie(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4)u[o]=255-s[o],u[o+1]=255-s[o+1],u[o+2]=255-s[o+2],u[o+3]=s[o+3];return{path:n,width:e,height:a,buffer:u}}function Ee(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length);for(let o=0;o<s.length;o+=4){let c=s[o],f=s[o+1],i=s[o+2];u[o]=Math.min(255,i*0.272+f*0.534+c*0.131),u[o+1]=Math.min(255,i*0.349+f*0.686+c*0.168),u[o+2]=Math.min(255,i*0.393+f*0.769+c*0.189),u[o+3]=s[o+3]}return{path:n,width:e,height:a,buffer:u}}function pe(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let c=0;c<u.length;c+=4){let f=u[c],i=u[c+1],E=u[c+2],[b,_,p]=h.rgbToHsv(E,i,f),l=(b+n)%360,[m,U,k]=h.hsvToRgb(l<0?l+360:l,_,p);o[c]=k,o[c+1]=U,o[c+2]=m,o[c+3]=u[c+3]}return{path:e,width:a,height:s,buffer:o}}function me(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length);for(let c=0;c<u.length;c+=4){let f=u[c],i=u[c+1],E=u[c+2],[b,_,p]=h.rgbToHsv(E,i,f),l=Math.min(1,Math.max(0,_*n)),[m,U,k]=h.hsvToRgb(b,l,p);o[c]=k,o[c+1]=U,o[c+2]=m,o[c+3]=u[c+3]}return{path:e,width:a,height:s,buffer:o}}function Me(t,n){let{path:e,width:a,height:s,buffer:u}=t,o=n*Math.PI/180,c=Math.cos(o),f=Math.sin(o),i=Math.ceil(Math.abs(a*c)+Math.abs(s*f)),E=Math.ceil(Math.abs(a*f)+Math.abs(s*c)),b=new Uint8Array(i*E*4),_=a/2,p=s/2,l=i/2,m=E/2;for(let U=0;U<E;U++)for(let k=0;k<i;k++){let d=(k-l)*c+(U-m)*f+_,v=-(k-l)*f+(U-m)*c+p;if(d>=0&&d<a&&v>=0&&v<s){let I=(Math.floor(v)*a+Math.floor(d))*4,A=(U*i+k)*4;b[A]=u[I],b[A+1]=u[I+1],b[A+2]=u[I+2],b[A+3]=u[I+3]}}return{path:e,width:i,height:E,buffer:b}}function be(t,n=!1,e=!1){let{path:a,width:s,height:u,buffer:o}=t,c=new Uint8Array(o.length);for(let f=0;f<u;f++)for(let i=0;i<s;i++){let E=n?s-1-i:i,_=((e?u-1-f:f)*s+E)*4,p=(f*s+i)*4;c[p]=o[_],c[p+1]=o[_+1],c[p+2]=o[_+2],c[p+3]=o[_+3]}return{path:a,width:s,height:u,buffer:c}}function le(t,n,e,a,s){let{path:u,width:o,height:c,buffer:f}=t,i=Math.max(0,Math.min(o,n)),E=Math.max(0,Math.min(c,e)),b=Math.max(0,Math.min(o,n+a)),_=Math.max(0,Math.min(c,e+s)),p=b-i,l=_-E,m=new Uint8Array(p*l*4);for(let U=0;U<l;U++)for(let k=0;k<p;k++){let d=((E+U)*o+(i+k))*4,v=(U*p+k)*4;m[v]=f[d],m[v+1]=f[d+1],m[v+2]=f[d+2],m[v+3]=f[d+3]}return{path:u,width:p,height:l,buffer:m}}function _e(t,n,e,a="bilinear"){let{path:s,width:u,height:o,buffer:c}=t,f=new Uint8Array(n*e*4);if(a==="nearest"){let i=u/n,E=o/e;for(let b=0;b<e;b++)for(let _=0;_<n;_++){let p=Math.floor(_*i),m=(Math.floor(b*E)*u+p)*4,U=(b*n+_)*4;f[U]=c[m],f[U+1]=c[m+1],f[U+2]=c[m+2],f[U+3]=c[m+3]}}else{let i=(u-1)/n,E=(o-1)/e;for(let b=0;b<e;b++)for(let _=0;_<n;_++){let p=_*i,l=b*E,m=Math.floor(p),U=Math.floor(l),k=Math.min(u-1,m+1),d=Math.min(o-1,U+1),v=p-m,I=l-U;for(let A=0;A<4;A++){let N=c[(U*u+m)*4+A],K=c[(U*u+k)*4+A],R=c[(d*u+m)*4+A],Y=c[(d*u+k)*4+A],W=N*(1-v)*(1-I)+K*v*(1-I)+R*(1-v)*I+Y*v*I;f[(b*n+_)*4+A]=Math.round(W)}}}return{path:s,width:n,height:e,buffer:f}}function Ue(t,n=128){let e=et(t),{path:a,width:s,height:u,buffer:o}=e,c=new Uint8Array(o.length);for(let f=0;f<o.length;f+=4){let i=o[f+1]>=n?255:0;c[f]=i,c[f+1]=i,c[f+2]=i,c[f+3]=o[f+3]}return{path:a,width:s,height:u,buffer:c}}function ke(t,n=11){let e=et(t),{path:a,width:s,height:u,buffer:o}=e,c=new Uint8Array(o.length),f=Math.floor(n/2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0;for(let U=-f;U<=f;U++)for(let k=-f;k<=f;k++){let d=Math.min(s-1,Math.max(0,E+k)),v=Math.min(u-1,Math.max(0,i+U));b+=o[(v*s+d)*4+1],_++}let p=b/_,l=(i*s+E)*4,m=o[l+1]>=p?255:0;c[l]=m,c[l+1]=m,c[l+2]=m,c[l+3]=o[l+3]}return{path:a,width:s,height:u,buffer:c}}function ve(t,n=1){let{path:e,width:a,height:s,buffer:u}=t,o=new Uint8Array(u.length),c=n*2+1;for(let f=0;f<s;f++)for(let i=0;i<a;i++){let E=[[],[],[]];for(let p=-n;p<=n;p++)for(let l=-n;l<=n;l++){let m=Math.min(a-1,Math.max(0,i+l)),k=(Math.min(s-1,Math.max(0,f+p))*a+m)*4;E[0].push(u[k]),E[1].push(u[k+1]),E[2].push(u[k+2])}for(let p=0;p<3;p++)E[p].sort((l,m)=>l-m);let b=Math.floor(c*c/2),_=(f*a+i)*4;o[_]=E[0][b],o[_+1]=E[1][b],o[_+2]=E[2][b],o[_+3]=u[_+3]}return{path:e,width:a,height:s,buffer:o}}function Ie(t,n=3,e=50){let{path:a,width:s,height:u,buffer:o}=t,c=new Uint8Array(o.length),f=Math.ceil(n*2);for(let i=0;i<u;i++)for(let E=0;E<s;E++){let b=0,_=0,p=0,l=0,m=(i*s+E)*4,U=o[m],k=o[m+1],d=o[m+2];for(let v=-f;v<=f;v++)for(let I=-f;I<=f;I++){let A=Math.min(s-1,Math.max(0,E+I)),K=(Math.min(u-1,Math.max(0,i+v))*s+A)*4,R=I*I+v*v,Y=Math.pow(o[K]-U,2)+Math.pow(o[K+1]-k,2)+Math.pow(o[K+2]-d,2),W=Math.exp(-R/(2*n*n)-Y/(2*e*e));b+=o[K]*W,_+=o[K+1]*W,p+=o[K+2]*W,l+=W}c[m]=Math.round(b/l),c[m+1]=Math.round(_/l),c[m+2]=Math.round(p/l),c[m+3]=o[m+3]}return{path:a,width:s,height:u,buffer:c}}function de(t){let{buffer:n}=t,e=Array(256).fill(0),a=Array(256).fill(0),s=Array(256).fill(0);for(let u=0;u<n.length;u+=4)s[n[u]]++,a[n[u+1]]++,e[n[u+2]]++;return{r:e,g:a,b:s}}function Ae(t){let{path:n,width:e,height:a,buffer:s}=t,u=new Uint8Array(s.length),o=255,c=0,f=255,i=0,E=255,b=0;for(let m=0;m<s.length;m+=4)E=Math.min(E,s[m]),b=Math.max(b,s[m]),f=Math.min(f,s[m+1]),i=Math.max(i,s[m+1]),o=Math.min(o,s[m+2]),c=Math.max(c,s[m+2]);let _=b-E||1,p=i-f||1,l=c-o||1;for(let m=0;m<s.length;m+=4)u[m]=(s[m]-E)*255/_,u[m+1]=(s[m+1]-f)*255/p,u[m+2]=(s[m+2]-o)*255/l,u[m+3]=s[m+3];return{path:n,width:e,height:a,buffer:u}}function Oe(t,n,e=0,a=0,s=1){let{path:u,width:o,height:c,buffer:f}=t,i=new Uint8Array(f);for(let E=0;E<n.height;E++)for(let b=0;b<n.width;b++){let _=e+b,p=a+E;if(_>=0&&_<o&&p>=0&&p<c){let l=(E*n.width+b)*4,m=(p*o+_)*4,U=n.buffer[l+3]/255*s;for(let k=0;k<3;k++)i[m+k]=Math.round(n.buffer[l+k]*U+i[m+k]*(1-U))}}return{path:u,width:o,height:c,buffer:i}}function De(t,n,e="multiply"){let{path:a,width:s,height:u,buffer:o}=t,c=new Uint8Array(o.length),f=Math.min(s,n.width),i=Math.min(u,n.height);for(let E=0;E<i;E++)for(let b=0;b<f;b++){let _=(E*s+b)*4,p=(E*n.width+b)*4;for(let l=0;l<3;l++){let m=o[_+l]/255,U=n.buffer[p+l]/255,k=0;switch(e){case"multiply":k=m*U;break;case"screen":k=1-(1-m)*(1-U);break;case"overlay":k=m<0.5?2*m*U:1-2*(1-m)*(1-U);break;case"add":k=Math.min(1,m+U);break;case"subtract":k=Math.max(0,m-U);break}c[_+l]=Math.round(k*255)}c[_+3]=o[_+3]}for(let E=i*s*4;E<o.length;E++)c[E]=o[E];return{path:a,width:s,height:u,buffer:c}}class w{img;path;width;height;buffer;constructor(t){this.img=t;this.path=t.path,this.width=t.width,this.height=t.height,this.buffer=t.buffer}sync(){this.path=this.img.path,this.width=this.img.width,this.height=this.img.height,this.buffer=this.img.buffer}clone(){return new w(ee(this.img))}grayscale(){return this.img=et(this.img),this.sync(),this}brightness(t){return this.img=re(this.img,t),this.sync(),this}contrast(t){return this.img=se(this.img,t),this.sync(),this}blur(t=1){return this.img=oe(this.img,t),this.sync(),this}sharpen(){return this.img=ae(this.img),this.sync(),this}edges(){return this.img=ue(this.img),this.sync(),this}dilate(t=1){return this.img=Et(this.img,t),this.sync(),this}erode(t=1){return this.img=pt(this.img,t),this.sync(),this}erode2dilate(t=1){return this.img=ce(this.img,t),this.sync(),this}dilate2erode(t=1){return this.img=xe(this.img,t),this.sync(),this}async save(t){return qt(this,t)}toPixels(){return fe(this.img)}invert(){return this.img=ie(this.img),this.sync(),this}sepia(){return this.img=Ee(this.img),this.sync(),this}hue(t){return this.img=pe(this.img,t),this.sync(),this}saturate(t){return this.img=me(this.img,t),this.sync(),this}rotate(t){return this.img=Me(this.img,t),this.sync(),this}flip(t=!1,n=!1){return this.img=be(this.img,t,n),this.sync(),this}crop(t,n,e,a){return this.img=le(this.img,t,n,e,a),this.sync(),this}resize(t,n,e="bilinear"){return this.img=_e(this.img,t,n,e),this.sync(),this}threshold(t=128){return this.img=Ue(this.img,t),this.sync(),this}adaptiveThreshold(t=11){return this.img=ke(this.img,t),this.sync(),this}medianFilter(t=1){return this.img=ve(this.img,t),this.sync(),this}bilateralFilter(t=3,n=50){return this.img=Ie(this.img,t,n),this.sync(),this}histogram(){return de(this.img)}autoLevel(){return this.img=Ae(this.img),this.sync(),this}overlay(t,n=0,e=0,a=1){return this.img=Oe(this.img,t,n,e,a),this.sync(),this}blend(t,n="multiply"){return this.img=De(this.img,t,n),this.sync(),this}}class Ne{load=it;save=qt;process(t){if(t instanceof w)return t;return new w(t)}}var lo=new Ne;import{ptr as O,JSCallback as zt}from"bun:ffi";import{ptr as Jt,JSCallback as Wr}from"bun:ffi";class mt{r;g;b;x;y;constructor(t,n,e){this.x=t,this.y=n,this.r=e.r,this.g=e.g,this.b=e.b}isEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}isSimilar(t,n=0){return h.isColorSimilar({r:this.r,g:this.g,b:this.b},t,n)}toRGB(){return{r:this.r,g:this.g,b:this.b}}toHex(){return h.rgbToHex({r:this.r,g:this.g,b:this.b})}toNumber(){return this.r<<16|this.g<<8|this.b}toString(){return`Pixel(${this.x}, ${this.y}) RGB(${this.r}, ${this.g}, ${this.b})`}}var q=null,Ke=0;function jr(){if(q&&Date.now()-Ke<1000)return q;if(q)M.symbols.ReleaseDC(null,q);return q=M.symbols.GetDC(null),Ke=Date.now(),q}function Q(){return{width:M.symbols.GetSystemMetrics(0),height:M.symbols.GetSystemMetrics(1)}}function Mt(t,n){let e=jr();if(!e)return null;let a=D.symbols.GetPixel(e,t,n),s={r:a&255,g:a>>8&255,b:a>>16&255};return new mt(t,n,s)}function rt(t,n,e,a=0){let s=Mt(t,n);if(!s)return!1;return s.isSimilar(e,a)}function Te(t,n,e,a=0,s,u){return new Promise((o)=>{let c=0,f=setInterval(()=>{if(rt(t,n,e,a)){clearInterval(f),o(!0);return}if(s&&(c+=u??50)>=s)clearInterval(f),o(!1)},u??50)})}function Re(t){return t.map((n)=>{let e=Mt(n.x,n.y);return e?e.toRGB():null})}function ye(t){return t.every((n)=>rt(n.x,n.y,n.target,n.tolerance??0))}function ge(t,n,e){return new Promise((a)=>{let s=0,u=setInterval(()=>{for(let o=0;o<t.length;o++){let c=t[o];if(rt(c.x,c.y,c.target,c.tolerance??0)){clearInterval(u),a(o);return}}if(n&&(s+=e??50)>=n)clearInterval(u),a(-1)},e??50)})}function Se(t,n,e,a,s,u=0){let o=Math.min(t,e),c=Math.min(n,a),f=Math.max(t,e),i=Math.max(n,a),E=f-o+1,b=i-c+1,_=bt(o,c,E,b);if(!_)return null;let p;if(typeof s==="string")p=h.hexToRgb(s);else if(typeof s==="number")p={r:s>>16&255,g:s>>8&255,b:s&255};else p=s;for(let l=0;l<b;l++)for(let m=0;m<E;m++){let U=(l*E+m)*4,k=_.buffer[U],d=_.buffer[U+1],v=_.buffer[U+2];if(u===0){if(v===p.r&&d===p.g&&k===p.b)return{x:o+m,y:c+l}}else if(Math.abs(v-p.r)<=u&&Math.abs(d-p.g)<=u&&Math.abs(k-p.b)<=u)return{x:o+m,y:c+l}}return null}async function Pe(t,n,e,a,s,u=0){let o;if(typeof s==="string"){let v=await it(s);if(!v)return null;o=v}else o=s;let c=Math.min(t,e),f=Math.min(n,a),i=Math.max(t,e),E=Math.max(n,a),b=i-c+1,_=E-f+1,p=bt(c,f,b,_);if(!p)return null;let{width:l,height:m}=o,U=b,k=_;if(l>U||m>k)return null;let d=(v,I,A,N,K,R)=>{if(u===0)return v===N&&I===K&&A===R;return Math.abs(v-N)<=u&&Math.abs(I-K)<=u&&Math.abs(A-R)<=u};for(let v=0;v<=k-m;v++)for(let I=0;I<=U-l;I++){let A=(v*U+I)*4,N=0;if(!d(p.buffer[A+2],p.buffer[A+1],p.buffer[A],o.buffer[N+2],o.buffer[N+1],o.buffer[N]))continue;let K=!0;for(let R=0;R<m;R++){for(let Y=0;Y<l;Y++){if(R===0&&Y===0)continue;if(A=((v+R)*U+(I+Y))*4,N=(R*l+Y)*4,!d(p.buffer[A+2],p.buffer[A+1],p.buffer[A],o.buffer[N+2],o.buffer[N+1],o.buffer[N])){K=!1;break}}if(!K)break}if(K)return{x:c+I,y:f+v}}return null}function bt(t=0,n=0,e,a){let s=e||M.symbols.GetSystemMetrics(0),u=a||M.symbols.GetSystemMetrics(1),o=M.symbols.GetDC(null);if(!o)return null;let c=D.symbols.CreateCompatibleDC(o);if(!c)return M.symbols.ReleaseDC(null,o),null;let f=D.symbols.CreateCompatibleBitmap(o,s,u);if(!f)return M.symbols.ReleaseDC(null,o),D.symbols.DeleteDC(c),null;let i=D.symbols.SelectObject(c,f),E=D.symbols.BitBlt(c,0,0,s,u,o,t,n,13369376),b=null;if(E){let _=s*u*4;b=new Uint8Array(_);let p=new Uint8Array(40),l=new DataView(p.buffer);if(l.setInt32(0,40,!0),l.setInt32(4,s,!0),l.setInt32(8,-u,!0),l.setInt16(12,1,!0),l.setInt16(14,32,!0),l.setInt32(16,0,!0),D.symbols.GetDIBits(c,f,0,u,Jt(b),Jt(p),0)===0)b=null}if(i)D.symbols.SelectObject(c,i);if(D.symbols.DeleteObject(f),D.symbols.DeleteDC(c),M.symbols.ReleaseDC(null,o),!b)return null;return new w({width:s,height:u,buffer:b})}function Be(){let t=[],n=1,e=32,a=new Wr((s,u,o,c)=>{let i=new Uint8Array(104),E=new DataView(i.buffer);if(E.setUint32(0,104,!0),M.symbols.GetMonitorInfoW(s,Jt(i))){let b=E.getInt32(4,!0),_=E.getInt32(8,!0),p=E.getInt32(12,!0),l=E.getInt32(16,!0),m=E.getInt32(20,!0),U=E.getInt32(24,!0),k=E.getInt32(28,!0),d=E.getInt32(32,!0),I=(E.getUint32(36,!0)&1)!==0,A=i.slice(40,104),N=new TextDecoder("utf-16le").decode(A).replace(/\0.*$/,"");t.push({handle:s,rect:{left:b,top:_,right:p,bottom:l},workArea:{left:m,top:U,right:k,bottom:d},isPrimary:I,deviceName:N})}return!0},{args:["ptr","ptr","ptr","ptr"],returns:"bool"});return M.symbols.EnumDisplayMonitors(null,null,a.ptr,0),a.close(),t}var Fe=6,Qr=1,Zr=0,Jr=1,zr=4,ts=256,ns=4096,es=3,rs=9,ss=0,os=5,as=16,tn=-16,lt=-20,us=524288;var cs=2,xs=-1,fs=-2,nn=2,en=1;var Ut=new TextDecoder("utf-16le"),he=new TextDecoder("ascii");function st(){let t=M.symbols.GetForegroundWindow();if(!t)return null;let n=new Uint16Array(256),e=M.symbols.GetWindowTextW(t,O(n),256),a=e>0?Ut.decode(n.subarray(0,e)):"",s=new Int32Array(4);if(!M.symbols.GetWindowRect(t,O(s)))return null;let u={left:s[0],top:s[1],right:s[2],bottom:s[3]},o=Q(),c=u.left===0&&u.top===0&&u.right-u.left===o.width&&u.bottom-u.top===o.height&&(M.symbols.GetWindowLongW(t,-16)&12845056)===0;return{hwnd:t,title:a,rect:u,isFullscreen:c}}function _t(t){let n=t!==void 0?BigInt(t):M.symbols.GetForegroundWindow();if(!n)return"";let e=new Uint16Array(256),a=M.symbols.GetWindowTextW(n,O(e),256);return a>0?Ut.decode(e.subarray(0,a)):""}function kt(t){let n=new Int32Array(4);if(!M.symbols.GetWindowRect(BigInt(t),O(n)))return null;return{left:n[0],top:n[1],right:n[2],bottom:n[3]}}function Ye(t){return M.symbols.IsWindowVisible(BigInt(t))}function vt(t){return M.symbols.SetForegroundWindow(BigInt(t))}function rn(t){let n=new TextEncoder().encode(t+"\x00"),e=M.symbols.FindWindowA(null,O(n));return e?e:null}function Le(t,n){return new Promise((e)=>{let a=0,s=setInterval(()=>{let u=rn(t);if(u){clearInterval(s),e(u);return}if(n&&(a+=100)>=n)clearInterval(s),e(null)},100)})}function It(t){let n=new Uint32Array(1);return M.symbols.GetWindowThreadProcessId(BigInt(t),O(n)),n[0]}function Ce(t){let n=new Uint8Array(256),e=M.symbols.GetClassNameA(BigInt(t),O(n),256);return e>0?he.decode(n.subarray(0,e)):""}function sn(t){return M.symbols.IsIconic(BigInt(t))}function Ge(t){return M.symbols.IsZoomed(BigInt(t))}function Ve(t){return M.symbols.ShowWindow(BigInt(t),Fe)}function we(t){return M.symbols.ShowWindow(BigInt(t),es)}function on(t){return M.symbols.ShowWindow(BigInt(t),rs)}function Xe(t){return M.symbols.ShowWindow(BigInt(t),os)}function $e(t){return M.symbols.ShowWindow(BigInt(t),ss)}function He(t){return M.symbols.PostMessageA(BigInt(t),as,null,null)}function an(t,n,e,a,s,u=!0){return M.symbols.MoveWindow(BigInt(t),n,e,a,s,u)}function We(t){let n=kt(t);if(!n)return!1;let e=n.right-n.left,a=n.bottom-n.top,s=Q(),u=Math.floor((s.width-e)/2),o=Math.floor((s.height-a)/2);return an(t,u,o,e,a,!0)}function un(t){let n=new Int32Array(4);if(!M.symbols.GetClientRect(BigInt(t),O(n)))return null;return{left:n[0],top:n[1],right:n[2],bottom:n[3]}}function je(t){let n=kt(t);if(!n)return null;return{width:n.right-n.left,height:n.bottom-n.top}}function qe(t){let n=un(t);if(!n)return null;return{width:n.right-n.left,height:n.bottom-n.top}}function dt(t){return M.symbols.IsWindow(BigInt(t))}function cn(t){if(!dt(t))return null;let n=BigInt(t),e=new Uint16Array(256),a=M.symbols.GetWindowTextW(n,O(e),256),s=a>0?Ut.decode(e.subarray(0,a)):"",u=new Int32Array(4);if(!M.symbols.GetWindowRect(n,O(u)))return null;let o={left:u[0],top:u[1],right:u[2],bottom:u[3]},c=Q(),f=o.left===0&&o.top===0&&o.right-o.left===c.width&&o.bottom-o.top===c.height&&(M.symbols.GetWindowLongW(n,tn)&12845056)===0,i=new Uint32Array(1);M.symbols.GetWindowThreadProcessId(n,O(i));let E=new Uint8Array(256),b=M.symbols.GetClassNameA(n,O(E),256),_=b>0?he.decode(E.subarray(0,b)):"";return{hwnd:n,title:s,rect:o,isFullscreen:f,processId:i[0],isVisible:M.symbols.IsWindowVisible(n),isMinimized:M.symbols.IsIconic(n),isMaximized:M.symbols.IsZoomed(n),className:_}}function Qe(t,n){return new Promise((e)=>{let a=0,s=setInterval(()=>{if(!dt(t)){clearInterval(s),e(!0);return}if(n&&(a+=100)>=n)clearInterval(s),e(!1)},100)})}async function Ze(t,n=1000){vt(t);let e=0;while(e<n){let a=st();if(a&&a.hwnd===BigInt(t))return!0;await Bun.sleep(50),e+=50}return!1}function Je(){let t=[],n=new zt((e,a)=>{let s=cn(e);if(s&&s.isVisible&&s.title)t.push(s);return!0},{args:["u64","i64"],returns:"bool"});return M.symbols.EnumWindows(n.ptr,0),n.close(),t}function xn(t){let n=[],e=new zt((a,s)=>{return n.push(a),!0},{args:["u64","i64"],returns:"bool"});return M.symbols.EnumChildWindows(BigInt(t),e.ptr,0),e.close(),n}function ze(t,n=!0){return M.symbols.FlashWindow(BigInt(t),n)}function tr(t,n){let e=BigInt(t),a=M.symbols.GetWindowLongW(e,lt);M.symbols.SetWindowLongW(e,lt,a|us);let s=Math.max(0,Math.min(255,Math.floor(n*255)));return M.symbols.SetLayeredWindowAttributes(e,0,s,cs)}function nr(t,n){return M.symbols.SetWindowPos(BigInt(t),BigInt(n?xs:fs),0,0,0,0,nn|en)}function er(t,n){let e=new Uint16Array(n.length+1),a=new TextEncoder().encodeInto(n,new Uint8Array(e.buffer)),s=Buffer.from(n+"\x00","utf16le");return M.symbols.SetWindowTextW(BigInt(t),O(s))}function rr(t,n){return M.symbols.EnableWindow(BigInt(t),n)}function sr(t){return M.symbols.RedrawWindow(BigInt(t),null,0n,Jr|zr|ts)}function or(t){return M.symbols.SetWindowPos(BigInt(t),BigInt(Qr),0,0,0,0,nn|en)}function ar(t){return M.symbols.SetWindowPos(BigInt(t),BigInt(Zr),0,0,0,0,nn|en)}function fn(t){let n=It(t);if(!n)return"";let e=P.symbols.OpenProcess(ns,!1,n);if(!e)return"";try{let a=new Uint16Array(1024),s=new Uint32Array([1024]);if(P.symbols.QueryFullProcessImageNameW(e,0,O(a),O(s)))return Ut.decode(a.subarray(0,s[0]));return""}finally{P.symbols.CloseHandle(e)}}function ur(t,n,e){let a=new Int32Array([n,e]);if(M.symbols.ClientToScreen(BigInt(t),O(a)))return{x:a[0],y:a[1]};return null}function cr(t,n,e){let a=new Int32Array([n,e]);if(M.symbols.ScreenToClient(BigInt(t),O(a)))return{x:a[0],y:a[1]};return null}function xr(t){let n=BigInt(t);if(sn(n))on(n);return vt(n)}async function fr(t,n){let e=BigInt(t);return new Promise((a)=>{let s=0,u=setInterval(()=>{let o=st();if(o&&o.hwnd===e){clearInterval(u),a(!0);return}if(n&&(s+=100)>=n)clearInterval(u),a(!1)},100)})}async function ir(t,n){let e=BigInt(t);return new Promise((a)=>{let s=0,u=setInterval(()=>{let o=st();if(!o||o.hwnd!==e){clearInterval(u),a(!0);return}if(n&&(s+=100)>=n)clearInterval(u),a(!1)},100)})}function Er(t){let n=BigInt(t),e=It(n);if(!e)return!1;let a=1,s=P.symbols.OpenProcess(a,!1,e);if(!s)return!1;try{return P.symbols.TerminateProcess(s,1)}finally{P.symbols.CloseHandle(s)}}var is={WS_OVERLAPPED:0,WS_POPUP:2147483648,WS_CHILD:1073741824,WS_MINIMIZE:536870912,WS_VISIBLE:268435456,WS_DISABLED:134217728,WS_CLIPSIBLINGS:67108864,WS_CLIPCHILDREN:33554432,WS_MAXIMIZE:16777216,WS_CAPTION:12582912,WS_BORDER:8388608,WS_DLGFRAME:4194304,WS_VSCROLL:2097152,WS_HSCROLL:1048576,WS_SYSMENU:524288,WS_THICKFRAME:262144,WS_GROUP:131072,WS_TABSTOP:65536,WS_MINIMIZEBOX:131072,WS_MAXIMIZEBOX:65536};function pr(t){return M.symbols.GetWindowLongW(BigInt(t),tn)}function mr(t,n){return M.symbols.SetWindowLongW(BigInt(t),tn,is[n])}var Es={WS_EX_DLGMODALFRAME:1,WS_EX_NOPARENTNOTIFY:4,WS_EX_TOPMOST:8,WS_EX_ACCEPTFILES:16,WS_EX_TRANSPARENT:32,WS_EX_MDICHILD:64,WS_EX_TOOLWINDOW:128,WS_EX_WINDOWEDGE:256,WS_EX_CLIENTEDGE:512,WS_EX_CONTEXTHELP:1024,WS_EX_RIGHT:4096,WS_EX_LEFT:0,WS_EX_RTLREADING:8192,WS_EX_LTRREADING:0,WS_EX_LEFTSCROLLBAR:16384,WS_EX_RIGHTSCROLLBAR:0,WS_EX_CONTROLPARENT:65536,WS_EX_STATICEDGE:131072,WS_EX_APPWINDOW:262144,WS_EX_LAYERED:524288,WS_EX_NOINHERITLAYOUT:1048576,WS_EX_NOREDIRECTIONBITMAP:2097152,WS_EX_LAYOUTRTL:4194304,WS_EX_COMPOSITED:33554432,WS_EX_NOACTIVATE:134217728};function Mr(t){return M.symbols.GetWindowLongW(BigInt(t),lt)}function br(t,n){return M.symbols.SetWindowLongW(BigInt(t),lt,Es[n])}function lr(t){let n=BigInt(t);if(M.symbols.IsIconic(n))return-1;if(M.symbols.IsZoomed(n))return 1;return 0}function At(){let t=[],n=new zt((e,a)=>{if(M.symbols.IsWindowVisible(e))t.push(e);return!0},{args:["u64","i64"],returns:"bool"});return M.symbols.EnumWindows(n.ptr,0),n.close(),t}function _r(){return At().length}function Ur(){let t=At();for(let n of t)M.symbols.ShowWindow(n,Fe)}function kr(t){let n=fn(t);if(!n)return"";let e=n.split("\\");return e[e.length-1]}function vr(t){let n=_t(t),e=xn(t);for(let a of e){let s=_t(a);if(s)n+=`\r
`+s}return n}function Ir(t,n,e,a,s,u=!0){let o=D.symbols.CreateRectRgn(n,e,n+a,e+s);if(!o)return!1;return M.symbols.SetWindowRgn(BigInt(t),o,u)!==0}function dr(t,n,e,a,s,u=!0){let o=D.symbols.CreateEllipticRgn(n,e,n+a,e+s);if(!o)return!1;return M.symbols.SetWindowRgn(BigInt(t),o,u)!==0}function Ar(t,n,e,a,s,u,o,c=!0){let f=D.symbols.CreateRoundRectRgn(n,e,n+a,e+s,u,o);if(!f)return!1;return M.symbols.SetWindowRgn(BigInt(t),f,c)!==0}function Or(t,n,e=1,a=!0){let s=new Int32Array(n.length*2);for(let o=0;o<n.length;o++)s[o*2]=n[o].x,s[o*2+1]=n[o].y;let u=D.symbols.CreatePolygonRgn(O(s),n.length,e);if(!u)return!1;return M.symbols.SetWindowRgn(BigInt(t),u,a)!==0}function Dr(t,n=!0){return M.symbols.SetWindowRgn(BigInt(t),0,n)!==0}class Nr{getActiveWindow=st;getWindowTitle=_t;getWindowRect=kt;getClientRect=un;getWindowSize=je;getClientSize=qe;isWindowVisible=Ye;isWindowMinimized=sn;isWindowMaximized=Ge;isWindow=dt;setForeground=vt;focusWindow=Ze;findWindow=rn;waitForWindow=Le;waitForWindowClose=Qe;getWindowProcessId=It;getClassName=Ce;getExtendedWindowInfo=cn;minimizeWindow=Ve;maximizeWindow=we;restoreWindow=on;showWindow=Xe;hideWindow=$e;closeWindow=He;moveWindow=an;enumWindows=Je;enumChildWindows=xn;flashWindow=ze;setOpacity=tr;setTopmost=nr;center=We;setTitle=er;setEnabled=rr;redraw=sr;moveToBottom=or;moveToTop=ar;getProcessPath=fn;clientToScreen=ur;screenToClient=cr;activate=xr;waitActive=fr;waitNotActive=ir;kill=Er;getStyle=pr;setStyle=mr;getExStyle=Mr;setExStyle=br;getMinMax=lr;getList=At;getCount=_r;minimizeAll=Ur;getProcessName=kr;getText=vr;setRegion={rect:Ir,ellipse:dr,round:Ar,polygon:Or,reset:Dr}}var Po=new Nr;class Kr{getScreenSize=Q;getMonitors=Be;capture=bt;getPixel=Mt;checkPixel=rt;waitForPixel=Te;getMultiplePixels=Re;checkMultiplePixels=ye;waitForAnyPixel=ge;pixelSearch=Se;imageSearch=Pe}var Yo=new Kr;export{Po as window,h as utils,Yo as screen,y as mouse,B as keyboard,lo as image,Ot as config,x as VK_CODES,mt as Pixel,X as KEYBOARD_MAPPING,w as Image};
