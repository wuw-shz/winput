// @bun
var c={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]],PAUSE:!1,PAUSE_DELAY:10};import{dlopen as Fe,FFIType as f,suffix as we}from"bun:ffi";var a=Fe(`user32.${we}`,{SendInput:{args:[f.u32,f.ptr,f.i32],returns:f.u32},MapVirtualKeyW:{args:[f.u32,f.u32],returns:f.u32},GetCursorPos:{args:[f.ptr],returns:f.bool},GetSystemMetrics:{args:[f.i32],returns:f.i32},GetKeyState:{args:[f.i32],returns:f.i16},GetAsyncKeyState:{args:[f.i32],returns:f.i16},SetWindowsHookExW:{args:[f.i32,f.ptr,f.ptr,f.u32],returns:f.ptr},UnhookWindowsHookEx:{args:[f.ptr],returns:f.bool},CallNextHookEx:{args:[f.ptr,f.i32,f.ptr,f.ptr],returns:f.ptr}});var O=process.arch==="x64"||process.arch==="arm64";class L extends Error{constructor(e){super(e);this.name="FailSafeException"}}var re=O?8:4;function se(e=0,t=0,n=0,o=0,r=0,s=0n){let i=20+re,u=Buffer.alloc(i);if(u.writeInt32LE(e,0),u.writeInt32LE(t,4),u.writeUInt32LE(n>>>0,8),u.writeUInt32LE(o>>>0,12),u.writeUInt32LE(r>>>0,16),O)u.writeBigUInt64LE(BigInt(s),20);else u.writeUInt32LE(Number(s)>>>0,20);return u}function ie(e=0,t=0,n=0,o=0,r=0n){let s=12+re,i=Buffer.alloc(s);if(i.writeUInt16LE(e&65535,0),i.writeUInt16LE(t&65535,2),i.writeUInt32LE(n>>>0,4),i.writeUInt32LE(o>>>0,8),O)i.writeBigUInt64LE(BigInt(r),12);else i.writeUInt32LE(Number(r)>>>0,12);return O?Buffer.concat([i,Buffer.alloc(32-i.length)]):i}function g(e,t){let n=O?40:36,o=Buffer.alloc(n);return o.writeUInt32LE(e>>>0,0),t.copy(o,8,0,Math.min(32,t.length)),o}import{ptr as _e}from"bun:ffi";function P(){if(c.FAILSAFE){let e=d();for(let t of c.FAILSAFE_POINTS)if(e[0]===t[0]&&e[1]===t[1])throw new L("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function p(e){if(e&&c.PAUSE_DELAY>0)Bun.sleepSync(c.PAUSE_DELAY)}function ae(e=0,t=0){let[n,o]=Le(),r=Math.round(e*65535/(n-1)),s=Math.round(t*65535/(o-1)),i=Math.max(0,Math.min(65535,r)),u=Math.max(0,Math.min(65535,s));return[i,u]}function d(e,t){let n=new ArrayBuffer(8),o=new DataView(n);a.symbols.GetCursorPos(_e(n));let r=o.getInt32(0,!0),s=o.getInt32(4,!0);return[e??r,t??s]}function Le(){let e=a.symbols.GetSystemMetrics(0),t=a.symbols.GetSystemMetrics(1);return[e,t]}var b={a:{scan:30},b:{scan:48},c:{scan:46},d:{scan:32},e:{scan:18},f:{scan:33},g:{scan:34},h:{scan:35},i:{scan:23},j:{scan:36},k:{scan:37},l:{scan:38},m:{scan:50},n:{scan:49},o:{scan:24},p:{scan:25},q:{scan:16},r:{scan:19},s:{scan:31},t:{scan:20},u:{scan:22},v:{scan:47},w:{scan:17},x:{scan:45},y:{scan:21},z:{scan:44},"0":{scan:11},"1":{scan:2},"2":{scan:3},"3":{scan:4},"4":{scan:5},"5":{scan:6},"6":{scan:7},"7":{scan:8},"8":{scan:9},"9":{scan:10},f1:{scan:59},f2:{scan:60},f3:{scan:61},f4:{scan:62},f5:{scan:63},f6:{scan:64},f7:{scan:65},f8:{scan:66},f9:{scan:67},f10:{scan:68},f11:{scan:87},f12:{scan:88},f13:{scan:100},f14:{scan:101},f15:{scan:102},f16:{scan:103},f17:{scan:104},f18:{scan:105},f19:{scan:106},f20:{scan:107},f21:{scan:108},f22:{scan:109},f23:{scan:110},f24:{scan:118},"-":{scan:12},minus:{scan:12},"=":{scan:13},equal:{scan:13},equals:{scan:13},"[":{scan:26},bracketleft:{scan:26},"]":{scan:27},bracketright:{scan:27},"\\":{scan:43},backslash:{scan:43},";":{scan:39},semicolon:{scan:39},"'":{scan:40},quote:{scan:40},apostrophe:{scan:40},"`":{scan:41},grave:{scan:41},backtick:{scan:41},",":{scan:51},comma:{scan:51},".":{scan:52},period:{scan:52},dot:{scan:52},"/":{scan:53},slash:{scan:53},forwardslash:{scan:53},space:{scan:57},enter:{scan:28},return:{scan:28},tab:{scan:15},backspace:{scan:14},escape:{scan:1},esc:{scan:1},shift:{scan:42},shiftleft:{scan:42},shiftright:{scan:54},ctrl:{scan:29},control:{scan:29},ctrlleft:{scan:29},controlleft:{scan:29},ctrlright:{scan:29,extended:!0},controlright:{scan:29,extended:!0},rctrl:{scan:29,extended:!0},alt:{scan:56},altleft:{scan:56},altright:{scan:56,extended:!0},ralt:{scan:56,extended:!0},altgr:{scan:56,extended:!0},win:{scan:91,extended:!0},winleft:{scan:91,extended:!0},windows:{scan:91,extended:!0},winright:{scan:92,extended:!0},windowsright:{scan:92,extended:!0},apps:{scan:93,extended:!0},menu:{scan:93,extended:!0},contextmenu:{scan:93,extended:!0},capslock:{scan:58},numlock:{scan:69},scrolllock:{scan:70},up:{scan:72,extended:!0},down:{scan:80,extended:!0},left:{scan:75,extended:!0},right:{scan:77,extended:!0},home:{scan:71,extended:!0},end:{scan:79,extended:!0},pageup:{scan:73,extended:!0},pagedown:{scan:81,extended:!0},insert:{scan:82,extended:!0},delete:{scan:83,extended:!0},del:{scan:83,extended:!0},numpad0:{scan:82},numpad1:{scan:79},numpad2:{scan:80},numpad3:{scan:81},numpad4:{scan:75},numpad5:{scan:76},numpad6:{scan:77},numpad7:{scan:71},numpad8:{scan:72},numpad9:{scan:73},numpaddecimal:{scan:83},numpadperiod:{scan:83},numpaddivide:{scan:53,extended:!0},numpadmultiply:{scan:55},numpadsubtract:{scan:74},numpadadd:{scan:78},numpadenter:{scan:28,extended:!0},volumeup:{scan:48,extended:!0},volumedown:{scan:46,extended:!0},volumemute:{scan:32,extended:!0},mute:{scan:32,extended:!0},playpause:{scan:34,extended:!0},stop:{scan:36,extended:!0},nexttrack:{scan:25,extended:!0},previoustrack:{scan:16,extended:!0},medianext:{scan:25,extended:!0},mediaprevious:{scan:16,extended:!0},mediaplaypause:{scan:34,extended:!0},mediastop:{scan:36,extended:!0},browserhome:{scan:50,extended:!0},browserback:{scan:106,extended:!0},browserforward:{scan:105,extended:!0},browserrefresh:{scan:103,extended:!0},browserstop:{scan:104,extended:!0},browsersearch:{scan:101,extended:!0},browserfavorites:{scan:102,extended:!0},mail:{scan:108,extended:!0},calculator:{scan:33,extended:!0},mycomputer:{scan:107,extended:!0},computer:{scan:107,extended:!0},printscreen:{scan:55,extended:!0},prtsc:{scan:55,extended:!0},pause:{scan:69,extended:!0},break:{scan:70},intl1:{scan:115},intl2:{scan:112},intl3:{scan:125},intl4:{scan:121},intl5:{scan:123},intl6:{scan:92},lang1:{scan:114},lang2:{scan:113},power:{scan:94,extended:!0},sleep:{scan:95,extended:!0},wake:{scan:99,extended:!0},help:{scan:59,extended:!0},undo:{scan:8,extended:!0},redo:{scan:7,extended:!0},cut:{scan:45,extended:!0},copy:{scan:46,extended:!0},paste:{scan:47,extended:!0},find:{scan:33,extended:!0},select:{scan:41,extended:!0},clear:{scan:76},num0:{scan:82},num1:{scan:79},num2:{scan:80},num3:{scan:81},num4:{scan:75},num5:{scan:76},num6:{scan:77},num7:{scan:71},num8:{scan:72},num9:{scan:73}},V=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]);var R=1,ce=32768,G=2,Y=4;var C=8,X=16;var W=32,H=64;var $=128,j=256,Q=1,z=2,fe=1,le=2,Z=8;function ue(e,t,n,o=0){let r=n|(t?fe:0),s=ie(0,e,r,o,0n),i=g(1,s);a.symbols.SendInput(1,i,40)}function v(e,t=c.PAUSE){let{scan:n,extended:o}=b[e];if(ue(n,!!o,Z),t)p(t);return M}function I(e,t=c.PAUSE){let{scan:n,extended:o}=b[e],r=Z|le;if(ue(n,!!o,r),t)p(t);return M}function T(e,t=c.PAUSE){if(v(e),I(e),t)p(t);return M}function Ee(e,t=1,n=0,o=c.PAUSE){for(let r=0;r<t;r++)if(v(e),I(e),n>0)Bun.sleepSync(n);if(o)p(o);return M}function pe(e,t=0,n=c.PAUSE){for(let o of e){if(o>="A"&&o<="Z"){let r=o.toLowerCase();v("shift"),T(r),I("shift")}else if(V.has(o)){let r=V.get(o);v("shift"),T(r),I("shift")}else T(o);if(t>0)Bun.sleepSync(Math.round(t*1000))}if(n)p(n);return M}function S(e){let{scan:t}=b[e],n;if(t>1024){let r=t-1024;n=a.symbols.MapVirtualKeyW(r,1)}else n=a.symbols.MapVirtualKeyW(t,1);return(a.symbols.GetAsyncKeyState(n)&32768)!==0}function me(e){return e.some((t)=>S(t))}function xe(e){return e.every((t)=>S(t))}function ye(e,t=c.PAUSE){for(let n of e)v(n);for(let n=e.length-1;n>=0;n--)I(e[n]);if(t)p(t);return M}function de(e,t,n=c.PAUSE){if(v(e,!1),Bun.sleepSync(t),I(e,!1),n)p(n);return M}function Me(e,t){return new Promise((n)=>{let r=0,s=setInterval(()=>{if(S(e)){clearInterval(s),n(!0);return}if(t){if(r+=8,r>=t)clearInterval(s),n(!1)}},8)})}function Pe(e,t){return new Promise((n)=>{let r=0,s=setInterval(()=>{if(!S(e)){clearInterval(s),n(!0);return}if(t){if(r+=8,r>=t)clearInterval(s),n(!1)}},8)})}function Ie(e,t=c.PAUSE){if(T(e,!1),t)p(t);return M}function ve(e){let{scan:t}=b[e],n;if(t>1024){let s=t-1024;n=a.symbols.MapVirtualKeyW(s,1)}else n=a.symbols.MapVirtualKeyW(t,1);let o=a.symbols.GetAsyncKeyState(n),r=a.symbols.GetKeyState(n);return{isPressed:(o&32768)!==0,isToggled:(r&1)!==0}}function Ae(e=c.PAUSE){let t=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],n="abcdefghijklmnopqrstuvwxyz".split("");t.push(...n);for(let o of t)if(S(o))I(o,!1);if(e)p(e);return M}class N{listeners=new Map;isRunning=!1;on(e,t){if(!this.listeners.has(e))this.listeners.set(e,new Set);this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}once(e,t){let n=(o)=>{try{t(o)}finally{this.off(e,n)}};this.on(e,n)}_emit(e,t){this.listeners.get(e)?.forEach((n)=>{try{n(t)}catch(o){console.error(`Listener error [${String(e)}]:`,o)}})}async start(e=8){if(this.isRunning)return;this.isRunning=!0;try{await this.run(e)}catch(t){console.error("Listener run error:",t)}finally{this.isRunning=!1}}stop(){this.isRunning=!1}}var be={};for(let[e,t]of Object.entries(b))be[t.scan&4095]=e;var Re=new Set([1,2,4,5,6]);class q extends N{async run(e=8){console.log("Keyboard listener started.");let t=Array(256).fill(!1),n=Array.from({length:256},(o,r)=>r);while(this.isRunning){for(let o of n){if(Re.has(o))continue;let r=a.symbols.GetAsyncKeyState(o),s=(r&32768)!==0,i=(r&1)!==0,u=a.symbols.MapVirtualKeyW(o,0),l=be[u];if(!l)if(o>=48&&o<=57)l=String.fromCharCode(o);else if(o>=65&&o<=90)l=String.fromCharCode(o).toLowerCase();else if(o===13)l="enter";else if(o===16)l="shift";else if(o===17)l="ctrl";else if(o===18)l="alt";else if(o===9)l="tab";else if(o===20)l="capslock";else if(o===27)l="escape";else if(o===32)l="space";else if(o>=112&&o<=123)l=`f${o-111}`;else continue;if(s!==t[o]){t[o]=s;let E={event:s?"down":"up",name:l,vk_code:o,isKeyDown:s};this._emit(s?"down":"up",E)}else if(!s&&i&&!t[o]){let E={event:"down",name:l,vk_code:o,isKeyDown:!0},m={event:"up",name:l,vk_code:o,isKeyDown:!1};this._emit("down",E),this._emit("up",m)}}await Bun.sleep(e)}console.log("Keyboard listener stopped.")}}class Se{press=v;release=I;tap=T;repeatTap=Ee;write=pe;isPressed=S;hotkey=ye;hold=de;isAnyPressed=me;areAllPressed=xe;waitForPress=Me;waitForRelease=Pe;toggleKey=Ie;getKeyState=ve;releaseAll=Ae;listener=new q}var M=new Se;var x="left",U="right",h="middle",k="x1",D="x2";var Ge=2048,Ye=4096,Ce=120;function K(e,t,n,o,r=0){let s=se(e,t,n,o,r,0n),i=g(0,s);a.symbols.SendInput(1,i,40)}function F(e=x,t=c.PAUSE){let n,o=0;if(e===x)n=G;else if(e===h)n=W;else if(e===U)n=C;else if(e===k)n=$,o=Q;else if(e===D)n=$,o=z;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);if(K(0,0,o,n,0),t)p(t);return y}function w(e=x,t=c.PAUSE){let n,o=0;if(e===x)n=Y;else if(e===h)n=H;else if(e===U)n=X;else if(e===k)n=j,o=Q;else if(e===D)n=j,o=z;else throw Error(`button must be "left", "middle", "right", "x1", or "x2", not ${e}`);if(K(0,0,o,n,0),t)p(t);return y}function J(e=x,t=1,n=0,o=c.PAUSE){if([x,h,U].includes(e)){let r=0,s=0;if(e===x)r=G,s=Y;else if(e===h)r=W,s=H;else r=C,s=X;for(let i=0;i<t;i++)if(P(),K(0,0,0,r,0),K(0,0,0,s,0),n>0)Bun.sleepSync(Math.round(n*1000))}if(o)p(o);return y}function A(e,t,n=!1,o=c.PAUSE){if(P(),e!==void 0&&!Number.isFinite(e))throw Error(`Invalid x coordinate: ${e}`);if(t!==void 0&&!Number.isFinite(t))throw Error(`Invalid y coordinate: ${t}`);if(!n){let[r,s]=d(e,t),[i,u]=ae(r,s);K(i,u,0,R|ce,0)}else ee(e??0,t??0,!0,o);if(o)p(o);return y}function ee(e=0,t=0,n=!1,o=c.PAUSE){if(P(),!n){let[r,s]=d();A(r+e,s+t,!1,o)}else if(K(e,t,0,R,0),o)p(o);return y}function Ke(e){let t;if(e===x)t=1;else if(e===U)t=2;else if(e===h)t=4;else if(e===k)t=5;else if(e===D)t=6;else throw Error(`Invalid button: ${e}`);return(a.symbols.GetAsyncKeyState(t)&32768)!==0}function te(e,t,n=x,o=0.5,r=c.PAUSE){P();let[s,i]=d();if(F(n,!1),o<=0)A(e,t,!1,!1);else{let u=Math.max(10,Math.floor(o*100)),l=o/u;for(let E=1;E<=u;E++){let m=E/u,_=Math.round(s+(e-s)*m),B=Math.round(i+(t-i)*m);A(_,B,!1,!1),Bun.sleepSync(Math.round(l*1000))}}if(w(n,!1),r)p(r);return y}function Te(e,t,n=x,o=0.5,r=c.PAUSE){let[s,i]=d();return te(s+e,i+t,n,o,r)}function he(e,t="vertical",n=c.PAUSE){P();let o=e*Ce;if(K(0,0,o,t==="vertical"?Ge:Ye,0),n)p(n);return y}var Xe={linear:(e)=>e,easeInQuad:(e)=>e*e,easeOutQuad:(e)=>e*(2-e),easeInOutQuad:(e)=>e<0.5?2*e*e:-1+(4-2*e)*e,easeInCubic:(e)=>e*e*e,easeOutCubic:(e)=>--e*e*e+1,easeInOutCubic:(e)=>e<0.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};async function Oe(e,t,n=0.5,o="easeOutQuad",r=c.PAUSE){P();let[s,i]=d(),u=Xe[o];if(n<=0)return A(e,t,!1,r),y;let l=Math.max(10,Math.floor(n*100)),E=n/l;for(let m=1;m<=l;m++){let _=m/l,B=u(_),ke=Math.round(s+(e-s)*B),De=Math.round(i+(t-i)*B);A(ke,De,!1,!1),Bun.sleepSync(Math.round(E*1000))}if(r)p(r);return y}function Ne(e,t,n=c.PAUSE){if(P(),F(e,!1),Bun.sleepSync(Math.round(t*1000)),w(e,!1),n)p(n);return y}function Ue(e,t,n=x,o=c.PAUSE){if(P(),A(e,t,!1,!0),J(n,1,0,!1),o)p(o);return y}function oe(e,t,n=0){let[o,r]=d(),s=Math.abs(o-e),i=Math.abs(r-t);return s<=n&&i<=n}function Be(e,t,n,o=0){return new Promise((r)=>{let i=0,u=setInterval(()=>{if(oe(e,t,o)){clearInterval(u),r(!0);return}if(n!==void 0){if(i+=8,i>=n)clearInterval(u),r(!1)}},8)})}import{ptr as He}from"bun:ffi";class ne extends N{async run(e=8){console.log("Mouse listener started.");let t=new ArrayBuffer(8),n=new DataView(t),o={x:0,y:0},r={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){a.symbols.GetCursorPos(He(t));let s=n.getInt32(0,!0),i=n.getInt32(4,!0);if(s!==o.x||i!==o.y){let E={event:"move",x:s,y:i,lastX:o.x,lastY:o.y,deltaX:s-o.x,deltaY:i-o.y};this._emit("move",E),o.x=s,o.y=i}let u={left:a.symbols.GetAsyncKeyState(1),right:a.symbols.GetAsyncKeyState(2),middle:a.symbols.GetAsyncKeyState(4),x1:a.symbols.GetAsyncKeyState(5),x2:a.symbols.GetAsyncKeyState(6)},l=Object.fromEntries(Object.entries(u).map(([E,m])=>[E,(m&32768)!==0]));for(let E of Object.keys(r))if(l[E]!==r[E]){r[E]=l[E];let m={event:l[E]?"down":"up",button:E,x:o.x,y:o.y};this._emit(l[E]?"down":"up",m)}await Bun.sleep(e)}console.log("Mouse listener stopped.")}}class ge{get position(){let e=d();return{x:e[0],y:e[1]}}press=F;release=w;click=J;moveTo=A;moveRel=ee;isPressed=Ke;dragTo=te;dragRel=Te;scroll=he;smoothMoveTo=Oe;hold=Ne;clickAt=Ue;isAtPosition=oe;waitForPosition=Be;listener=new ne}var y=new ge;export{y as mouse,M as keyboard,c as config};
