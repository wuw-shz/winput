// @bun
var f={FAILSAFE:!1,FAILSAFE_POINTS:[[0,0]],PAUSE:!0,PAUSE_DELAY:0};import{dlopen as Fe,FFIType as l,suffix as _e}from"bun:ffi";var c=Fe(`user32.${_e}`,{SendInput:{args:[l.u32,l.ptr,l.i32],returns:l.u32},MapVirtualKeyW:{args:[l.u32,l.u32],returns:l.u32},GetCursorPos:{args:[l.ptr],returns:l.bool},GetSystemMetrics:{args:[l.i32],returns:l.i32},GetKeyState:{args:[l.i32],returns:l.i16},GetAsyncKeyState:{args:[l.i32],returns:l.i16},SetWindowsHookExW:{args:[l.i32,l.ptr,l.ptr,l.u32],returns:l.ptr},UnhookWindowsHookEx:{args:[l.ptr],returns:l.bool},CallNextHookEx:{args:[l.ptr,l.i32,l.ptr,l.ptr],returns:l.ptr}});var T=process.arch==="x64"||process.arch==="arm64";class F extends Error{constructor(e){super(e);this.name="FailSafeException"}}var oe=T?8:4;function ne(e=0,t=0,o=0,n=0,r=0,s=0n){let i=20+oe,a=Buffer.alloc(i);if(a.writeInt32LE(e,0),a.writeInt32LE(t,4),a.writeUInt32LE(o>>>0,8),a.writeUInt32LE(n>>>0,12),a.writeUInt32LE(r>>>0,16),T)a.writeBigUInt64LE(BigInt(s),20);else a.writeUInt32LE(Number(s)>>>0,20);return a}function re(e=0,t=0,o=0,n=0,r=0n){let s=12+oe,i=Buffer.alloc(s);if(i.writeUInt16LE(e&65535,0),i.writeUInt16LE(t&65535,2),i.writeUInt32LE(o>>>0,4),i.writeUInt32LE(n>>>0,8),T)i.writeBigUInt64LE(BigInt(r),12);else i.writeUInt32LE(Number(r)>>>0,12);return T?Buffer.concat([i,Buffer.alloc(32-i.length)]):i}function w(e,t){let o=T?40:36,n=Buffer.alloc(o);return n.writeUInt32LE(e>>>0,0),t.copy(n,8,0,Math.min(32,t.length)),n}import{ptr as Re}from"bun:ffi";function P(){if(f.FAILSAFE){let e=d();for(let t of f.FAILSAFE_POINTS)if(e[0]===t[0]&&e[1]===t[1])throw new F("fail-safe triggered from mouse moving to a corner of the screen. To disable this fail-safe, set config.FAILSAFE to false. DISABLING FAIL-SAFE IS NOT RECOMMENDED.")}}function p(e){if(e&&f.PAUSE_DELAY>0)Bun.sleepSync(f.PAUSE_DELAY)}function se(e=0,t=0){let[o,n]=Ve(),r=Math.round(e*65535/(o-1)),s=Math.round(t*65535/(n-1)),i=Math.max(0,Math.min(65535,r)),a=Math.max(0,Math.min(65535,s));return[i,a]}function d(e,t){let o=new ArrayBuffer(8),n=new DataView(o);c.symbols.GetCursorPos(Re(o));let r=n.getInt32(0,!0),s=n.getInt32(4,!0);return[e??r,t??s]}function Ve(){let e=c.symbols.GetSystemMetrics(0),t=c.symbols.GetSystemMetrics(1);return[e,t]}var A={a:{scan:30},b:{scan:48},c:{scan:46},d:{scan:32},e:{scan:18},f:{scan:33},g:{scan:34},h:{scan:35},i:{scan:23},j:{scan:36},k:{scan:37},l:{scan:38},m:{scan:50},n:{scan:49},o:{scan:24},p:{scan:25},q:{scan:16},r:{scan:19},s:{scan:31},t:{scan:20},u:{scan:22},v:{scan:47},w:{scan:17},x:{scan:45},y:{scan:21},z:{scan:44},"0":{scan:11},"1":{scan:2},"2":{scan:3},"3":{scan:4},"4":{scan:5},"5":{scan:6},"6":{scan:7},"7":{scan:8},"8":{scan:9},"9":{scan:10},f1:{scan:59},f2:{scan:60},f3:{scan:61},f4:{scan:62},f5:{scan:63},f6:{scan:64},f7:{scan:65},f8:{scan:66},f9:{scan:67},f10:{scan:68},f11:{scan:87},f12:{scan:88},f13:{scan:100},f14:{scan:101},f15:{scan:102},f16:{scan:103},f17:{scan:104},f18:{scan:105},f19:{scan:106},f20:{scan:107},f21:{scan:108},f22:{scan:109},f23:{scan:110},f24:{scan:118},"-":{scan:12},minus:{scan:12},"=":{scan:13},equal:{scan:13},equals:{scan:13},"[":{scan:26},bracketleft:{scan:26},"]":{scan:27},bracketright:{scan:27},"\\":{scan:43},backslash:{scan:43},";":{scan:39},semicolon:{scan:39},"'":{scan:40},quote:{scan:40},apostrophe:{scan:40},"`":{scan:41},grave:{scan:41},backtick:{scan:41},",":{scan:51},comma:{scan:51},".":{scan:52},period:{scan:52},dot:{scan:52},"/":{scan:53},slash:{scan:53},forwardslash:{scan:53},space:{scan:57},enter:{scan:28},return:{scan:28},tab:{scan:15},backspace:{scan:14},escape:{scan:1},esc:{scan:1},shift:{scan:42},shiftleft:{scan:42},shiftright:{scan:54},ctrl:{scan:29},control:{scan:29},ctrlleft:{scan:29},controlleft:{scan:29},ctrlright:{scan:29,extended:!0},controlright:{scan:29,extended:!0},rctrl:{scan:29,extended:!0},alt:{scan:56},altleft:{scan:56},altright:{scan:56,extended:!0},ralt:{scan:56,extended:!0},altgr:{scan:56,extended:!0},win:{scan:91,extended:!0},winleft:{scan:91,extended:!0},windows:{scan:91,extended:!0},winright:{scan:92,extended:!0},windowsright:{scan:92,extended:!0},apps:{scan:93,extended:!0},menu:{scan:93,extended:!0},contextmenu:{scan:93,extended:!0},capslock:{scan:58},numlock:{scan:69},scrolllock:{scan:70},up:{scan:72,extended:!0},down:{scan:80,extended:!0},left:{scan:75,extended:!0},right:{scan:77,extended:!0},home:{scan:71,extended:!0},end:{scan:79,extended:!0},pageup:{scan:73,extended:!0},pagedown:{scan:81,extended:!0},insert:{scan:82,extended:!0},delete:{scan:83,extended:!0},del:{scan:83,extended:!0},numpad0:{scan:82},numpad1:{scan:79},numpad2:{scan:80},numpad3:{scan:81},numpad4:{scan:75},numpad5:{scan:76},numpad6:{scan:77},numpad7:{scan:71},numpad8:{scan:72},numpad9:{scan:73},numpaddecimal:{scan:83},numpadperiod:{scan:83},numpaddivide:{scan:53,extended:!0},numpadmultiply:{scan:55},numpadsubtract:{scan:74},numpadadd:{scan:78},numpadenter:{scan:28,extended:!0},volumeup:{scan:48,extended:!0},volumedown:{scan:46,extended:!0},volumemute:{scan:32,extended:!0},mute:{scan:32,extended:!0},playpause:{scan:34,extended:!0},stop:{scan:36,extended:!0},nexttrack:{scan:25,extended:!0},previoustrack:{scan:16,extended:!0},medianext:{scan:25,extended:!0},mediaprevious:{scan:16,extended:!0},mediaplaypause:{scan:34,extended:!0},mediastop:{scan:36,extended:!0},browserhome:{scan:50,extended:!0},browserback:{scan:106,extended:!0},browserforward:{scan:105,extended:!0},browserrefresh:{scan:103,extended:!0},browserstop:{scan:104,extended:!0},browsersearch:{scan:101,extended:!0},browserfavorites:{scan:102,extended:!0},mail:{scan:108,extended:!0},calculator:{scan:33,extended:!0},mycomputer:{scan:107,extended:!0},computer:{scan:107,extended:!0},printscreen:{scan:55,extended:!0},prtsc:{scan:55,extended:!0},pause:{scan:69,extended:!0},break:{scan:70},intl1:{scan:115},intl2:{scan:112},intl3:{scan:125},intl4:{scan:121},intl5:{scan:123},intl6:{scan:92},lang1:{scan:114},lang2:{scan:113},power:{scan:94,extended:!0},sleep:{scan:95,extended:!0},wake:{scan:99,extended:!0},help:{scan:59,extended:!0},undo:{scan:8,extended:!0},redo:{scan:7,extended:!0},cut:{scan:45,extended:!0},copy:{scan:46,extended:!0},paste:{scan:47,extended:!0},find:{scan:33,extended:!0},select:{scan:41,extended:!0},clear:{scan:76},num0:{scan:82},num1:{scan:79},num2:{scan:80},num3:{scan:81},num4:{scan:75},num5:{scan:76},num6:{scan:77},num7:{scan:71},num8:{scan:72},num9:{scan:73}},_=new Map([["!","1"],["@","2"],["#","3"],["$","4"],["%","5"],["^","6"],["&","7"],["*","8"],["(","9"],[")","0"],["_","-"],["+","="],["{","["],["}","]"],["|","\\"],[":",";"],['"',"'"],["<",","],[">","."],["?","/"],["~","`"]]);var R=1,ie=32768,V=2,L=4;var G=8,Y=16;var C=32,X=64;var W=128,H=256,ae=1,ce=2,fe=1,le=2,$=8;function ue(e,t,o,n=0){let r=o|(t?fe:0),s=re(0,e,r,n,0n),i=w(1,s);c.symbols.SendInput(1,i,40)}function I(e,t=f.PAUSE){let{scan:o,extended:n}=A[e];if(ue(o,!!n,$),t)p(t);return M}function v(e,t=f.PAUSE){let{scan:o,extended:n}=A[e],r=$|le;if(ue(o,!!n,r),t)p(t);return M}function K(e,t=f.PAUSE){return I(e,t),v(e,t),M}function Ee(e,t=1,o=0,n=f.PAUSE){for(let r=0;r<t;r++)if(I(e,n),v(e,n),o>0)Bun.sleepSync(o);return M}function pe(e,t=0,o=f.PAUSE){for(let n of e){if(n>="A"&&n<="Z"){let r=n.toLowerCase();I("shift",o),K(r,o),v("shift",o)}else if(_.has(n)){let r=_.get(n);I("shift",o),K(r,o),v("shift",o)}else K(n,o);if(t>0)Bun.sleepSync(t)}return M}function S(e){let{scan:t}=A[e],o;if(t>1024){let r=t-1024;o=c.symbols.MapVirtualKeyW(r,1)}else o=c.symbols.MapVirtualKeyW(t,1);return(c.symbols.GetAsyncKeyState(o)&32768)!==0}function me(e){return e.some((t)=>S(t))}function xe(e){return e.every((t)=>S(t))}function ye(e,t=f.PAUSE){for(let o of e)I(o,t);for(let o=e.length-1;o>=0;o--)v(e[o],t);return M}function de(e,t,o=f.PAUSE){if(I(e,!1),Bun.sleepSync(t),v(e,!1),o)p(o);return M}function Me(e,t){return new Promise((o)=>{let r=0,s=setInterval(()=>{if(S(e)){clearInterval(s),o(!0);return}if(t){if(r+=8,r>=t)clearInterval(s),o(!1)}},8)})}function Pe(e,t){return new Promise((o)=>{let r=0,s=setInterval(()=>{if(!S(e)){clearInterval(s),o(!0);return}if(t){if(r+=8,r>=t)clearInterval(s),o(!1)}},8)})}function ve(e,t=f.PAUSE){return K(e,t),M}function Ie(e){let{scan:t}=A[e],o;if(t>1024){let s=t-1024;o=c.symbols.MapVirtualKeyW(s,1)}else o=c.symbols.MapVirtualKeyW(t,1);let n=c.symbols.GetAsyncKeyState(o),r=c.symbols.GetKeyState(o);return{isPressed:(n&32768)!==0,isToggled:(r&1)!==0}}function be(e=f.PAUSE){let t=["shift","shiftleft","shiftright","ctrl","ctrlleft","ctrlright","alt","altleft","altright","win","winleft","winright"],o="abcdefghijklmnopqrstuvwxyz".split("");t.push(...o);for(let n of t)if(S(n))v(n,e);return M}class O{listeners=new Map;isRunning=!1;startPromise=null;on(e,t){if(!this.listeners.has(e))this.listeners.set(e,new Set);this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}once(e,t){let o=(n)=>{try{t(n)}finally{this.off(e,o)}};this.on(e,o)}_emit(e,t){this.listeners.get(e)?.forEach((o)=>{try{o(t)}catch(n){console.error(`Listener error [${String(e)}]:`,n)}})}async start(e=8){if(this.isRunning)return console.warn("Listener already running"),this.startPromise??Promise.resolve();return this.isRunning=!0,this.startPromise=(async()=>{try{await this.run(e)}catch(t){console.error("Listener run error:",t)}finally{this.isRunning=!1,this.startPromise=null}})(),this.startPromise}async stop(){if(this.isRunning=!1,this.startPromise)await this.startPromise}}var Ae={};for(let[e,t]of Object.entries(A))Ae[t.scan&4095]=e;var Ge=new Set([1,2,4,5,6]),Ye={112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",13:"enter",16:"shift",17:"ctrl",18:"alt",9:"tab",20:"capslock",27:"escape",32:"space"};class j extends O{async run(e=8){console.log("Keyboard listener started.");let t=Array(256).fill(!1),o=Array.from({length:256},(n,r)=>r);while(this.isRunning){for(let n of o){if(Ge.has(n))continue;let r=c.symbols.GetAsyncKeyState(n),s=(r&32768)!==0,i=(r&1)!==0,a=Ye[n];if(!a){let E=c.symbols.MapVirtualKeyW(n,0);a=Ae[E]}if(!a)if(n>=48&&n<=57)a=String.fromCharCode(n);else if(n>=65&&n<=90)a=String.fromCharCode(n).toLowerCase();else continue;if(s!==t[n]){t[n]=s;let E={event:s?"down":"up",name:a,vk_code:n,isKeyDown:s};this._emit(s?"down":"up",E)}else if(!s&&i&&!t[n]){let E={event:"down",name:a,vk_code:n,isKeyDown:!0},u={event:"up",name:a,vk_code:n,isKeyDown:!1};this._emit("down",E),this._emit("up",u)}}await Bun.sleep(e)}console.log("Keyboard listener stopped.")}}class Se{press=I;release=v;tap=K;repeatTap=Ee;write=pe;isPressed=S;hotkey=ye;hold=de;isAnyPressed=me;areAllPressed=xe;waitForPress=Me;waitForRelease=Pe;toggleKey=ve;getKeyState=Ie;releaseAll=be;listener=new j}var M=new Se;var x="left",B="right",N="middle",Q="x1",z="x2";var Ce=2048,Xe=4096,We=120,He={[x]:{down:V,up:L,data:0},[N]:{down:C,up:X,data:0},[B]:{down:G,up:Y,data:0},[Q]:{down:W,up:H,data:ae},[z]:{down:W,up:H,data:ce}};function he(e,t){let o=He[e];if(!o)throw Error(`Invalid button: ${e}`);return{event:o[t],mouseData:o.data}}function $e(e,t){if(e!==void 0){if(!Number.isFinite(e))throw Error(`Invalid x coordinate: ${e}`);if(e<0)throw Error(`x coordinate must be non-negative: ${e}`)}if(t!==void 0){if(!Number.isFinite(t))throw Error(`Invalid y coordinate: ${t}`);if(t<0)throw Error(`y coordinate must be non-negative: ${t}`)}}function h(e,t,o,n,r=0){let s=ne(e,t,o,n,r,0n),i=w(0,s);c.symbols.SendInput(1,i,40)}function g(e=x,t=f.PAUSE){try{let{event:o,mouseData:n}=he(e,"down");if(h(0,0,n,o,0),t)p(t);return m}catch(o){throw console.error("[Mouse Press Error]",o),o}}function D(e=x,t=f.PAUSE){try{let{event:o,mouseData:n}=he(e,"up");if(h(0,0,n,o,0),t)p(t);return m}catch(o){throw console.error("[Mouse Release Error]",o),o}}function Z(e=x,t=1,o=0,n=f.PAUSE){if([x,N,B].includes(e)){let r=0,s=0;if(e===x)r=V,s=L;else if(e===N)r=C,s=X;else r=G,s=Y;for(let i=0;i<t;i++)if(P(),h(0,0,0,r,0),h(0,0,0,s,0),o>0)Bun.sleepSync(Math.round(o*1000))}if(n)p(n);return m}function b(e,t,o=!1,n=f.PAUSE){try{if(P(),$e(e,t),!o){let[r,s]=d(e,t),[i,a]=se(r,s);if(h(i,a,0,R|ie,0),n)p(n)}else q(e??0,t??0,!0,n);return m}catch(r){throw console.error("[Mouse MoveTo Error]",r),r}}function q(e=0,t=0,o=!1,n=f.PAUSE){if(P(),!o){let[r,s]=d();b(r+e,s+t,!1,n)}else if(h(e,t,0,R,0),n)p(n);return m}function Ke(e){let t;if(e===x)t=1;else if(e===B)t=2;else if(e===N)t=4;else if(e===Q)t=5;else if(e===z)t=6;else throw Error(`Invalid button: ${e}`);return(c.symbols.GetAsyncKeyState(t)&32768)!==0}function J(e,t,o=x,n=0.5,r=f.PAUSE){P();let[s,i]=d();if(g(o,r),n<=0)b(e,t,!1,r);else{let a=Math.max(10,Math.floor(n*100)),E=n/a;for(let u=1;u<=a;u++){let y=u/a,k=Math.round(s+(e-s)*y),U=Math.round(i+(t-i)*y);b(k,U,!1,!1),Bun.sleepSync(Math.round(E*1000))}}return D(o,r),m}function Te(e,t,o=x,n=0.5,r=f.PAUSE){let[s,i]=d();return J(s+e,i+t,o,n,r)}function Oe(e,t="vertical",o=f.PAUSE){P();let n=e*We;if(h(0,0,n,t==="vertical"?Ce:Xe,0),o)p(o);return m}var je={linear:(e)=>e,easeInQuad:(e)=>e*e,easeOutQuad:(e)=>e*(2-e),easeInOutQuad:(e)=>e<0.5?2*e*e:-1+(4-2*e)*e,easeInCubic:(e)=>e*e*e,easeOutCubic:(e)=>--e*e*e+1,easeInOutCubic:(e)=>e<0.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1};async function Ne(e,t,o=0.5,n="easeOutQuad",r=f.PAUSE){P();let[s,i]=d(),a=je[n];if(o<=0)return b(e,t,!1,r),m;let E=Math.max(10,Math.floor(o*100)),u=o/E;for(let y=1;y<=E;y++){let k=y/E,U=a(k),De=Math.round(s+(e-s)*U),ke=Math.round(i+(t-i)*U);b(De,ke,!1,!1),Bun.sleepSync(Math.round(u*1000))}if(r)p(r);return m}function Ue(e,t,o=f.PAUSE){if(P(),g(e,!1),Bun.sleepSync(Math.round(t*1000)),D(e,!1),o)p(o);return m}function we(e,t,o=x,n=f.PAUSE){return P(),b(e,t,!1,n),Z(o,1,0,n),m}function ee(e,t,o=0){let[n,r]=d(),s=Math.abs(n-e),i=Math.abs(r-t);return s<=o&&i<=o}function Be(e,t,o,n=0){return new Promise((r)=>{let i=0,a=setInterval(()=>{if(ee(e,t,n)){clearInterval(a),r(!0);return}if(o!==void 0){if(i+=8,i>=o)clearInterval(a),r(!1)}},8)})}import{ptr as ze}from"bun:ffi";class te extends O{async run(e=8){console.log("Mouse listener started.");let t=new ArrayBuffer(8),o=new DataView(t),n={x:0,y:0},r={left:!1,right:!1,middle:!1,x1:!1,x2:!1};while(this.isRunning){c.symbols.GetCursorPos(ze(t));let s=o.getInt32(0,!0),i=o.getInt32(4,!0);if(s!==n.x||i!==n.y){let u={event:"move",x:s,y:i,lastX:n.x,lastY:n.y,deltaX:s-n.x,deltaY:i-n.y};this._emit("move",u),n.x=s,n.y=i}let a={left:c.symbols.GetAsyncKeyState(1),right:c.symbols.GetAsyncKeyState(2),middle:c.symbols.GetAsyncKeyState(4),x1:c.symbols.GetAsyncKeyState(5),x2:c.symbols.GetAsyncKeyState(6)},E=Object.fromEntries(Object.entries(a).map(([u,y])=>[u,(y&32768)!==0]));for(let u of Object.keys(r))if(E[u]!==r[u]){r[u]=E[u];let y={event:E[u]?"down":"up",button:u,x:n.x,y:n.y};this._emit(E[u]?"down":"up",y)}await Bun.sleep(e)}console.log("Mouse listener stopped.")}}class ge{get position(){let e=d();return{x:e[0],y:e[1]}}press=g;release=D;click=Z;moveTo=b;moveRel=q;isPressed=Ke;dragTo=J;dragRel=Te;scroll=Oe;smoothMoveTo=Ne;hold=Ue;clickAt=we;isAtPosition=ee;waitForPosition=Be;listener=new te}var m=new ge;export{m as mouse,M as keyboard,f as config};
